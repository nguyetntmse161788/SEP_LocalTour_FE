import{r as s,j as t,k as b,y as ee,B as te,f as ae,I as se,S as oe,H as ne}from"./index-BCEoXUgR.js";import{C as le}from"./config-global-BwHnWRtc.js";import{a as F}from"./index-Br0q4W-C.js";import{M as re,a as ie,g as ce,P as de,b as pe,c as ue,T as ge,e as me,d as he}from"./place-table-toolbar-ChhY3a9s.js";import{D as B,a as V,b as z,c as fe}from"./DialogTitle-DLFL-6md.js";import{A as v}from"./Autocomplete-Db5_biKL.js";import{T as g}from"./TextField-DWe7D0BL.js";import{G as $}from"./Grid-ClQYLn49.js";import{C as Ce}from"./Card-CnlOfLcQ.js";import{b as Pe,c as xe,d as je,e as ye}from"./TableSortLabel-D4yi4Kr4.js";import"./Checkbox-B8ndejfx.js";import"./Select-BESDqWty.js";import"./InputLabel-b21gl_J5.js";import"./LastPage-CTy_b4eb.js";function Te({open:C,onClose:m,onPlaceCreated:P}){const[n,r]=s.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),[x,d]=s.useState([]),[I,j]=s.useState(!1),[W,y]=s.useState(""),[T,h]=s.useState(""),[w,M]=s.useState([]),[L,p]=s.useState([]),[l,D]=s.useState([]),[E,O]=s.useState(""),[i,f]=s.useState(""),k=(a,e)=>{y(a),h(e),r(o=>({...o,longitude:a,latitude:e}))},N=()=>{j(!0)},A=()=>{j(!1)};s.useEffect(()=>{(async()=>{try{const e=await F.get("https://api.localtour.space/api/Tag/getAll?Size=1000");d(e.data.items)}catch(e){console.error("Error fetching tags:",e)}})()},[]);const S=(a,e)=>{const{name:o,value:u}=a.target;r(e!==void 0?c=>{const R=[...c.placeTranslations];return R[e]={...R[e],[o]:u},{...c,placeTranslations:R}}:c=>({...c,[o]:u}))},H=a=>{const e=a.target.files;e&&e[0]&&r(o=>({...o,photoDisplay:e[0]}))},_=(a,e)=>{const o=a.target.files;o&&o.length>0?r(u=>{const c=[...u.placeMedia];return c[e]=o[0],{...u,placeMedia:c}}):r(u=>{const c=[...u.placeMedia];return c[e]=null,{...u,placeMedia:c}})},q=()=>{r(a=>({...a,placeTranslations:[...a.placeTranslations,{languageCode:"",name:"",description:"",address:"",contact:""}]}))},J=a=>{r(e=>{const o=e.placeTranslations.filter((u,c)=>c!==a);return{...e,placeTranslations:o}})},Q=()=>{r(a=>({...a,placeMedia:[...a.placeMedia,null]}))},U=a=>{r(e=>{const o=e.placeMedia.filter((u,c)=>c!==a);return{...e,placeMedia:o}})},K=(a,e)=>{r(o=>({...o,tags:e.map(u=>u.id)}))},X=async()=>{try{const a=localStorage.getItem("accessToken"),e=new FormData;if(!n.wardId){alert("Please select a ward.");return}e.append("WardId",n.wardId),e.append("TimeOpen",n.timeOpen),e.append("TimeClose",n.timeClose),e.append("Longitude",parseFloat(n.longitude).toFixed(6)),e.append("Latitude",parseFloat(n.latitude).toFixed(6)),e.append("ContactLink",n.contactLink),console.log("longitude",n.longitude),console.log("latitude",n.latitude),n.tags.forEach(c=>{e.append("Tags",c)}),e.append("PlaceTranslation",JSON.stringify(n.placeTranslations)),n.photoDisplay&&e.append("PhotoDisplay",n.photoDisplay),n.placeMedia.forEach((c,R)=>{c&&e.append("PlaceMedia",c)});const u=(await F.post("https://api.localtour.space/api/Place/create",e,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}})).data;console.log("newPlace",u),alert("Place created successfully!"),P(u),m()}catch(a){console.error("Error creating place:",a),alert("Failed to create place.")}};s.useEffect(()=>{(async()=>{try{const e=await F.get("https://api.localtour.space/api/Address/Province");M(e.data)}catch(e){console.error("Error fetching provinces:",e)}})()},[]);const Y=async a=>{try{const e=await F.get(`https://api.localtour.space/api/Address/District?provinceI=${a}`);p(e.data)}catch(e){console.error("Error fetching districts:",e)}},Z=async a=>{try{const e=await F.get(`https://api.localtour.space/api/Address/Ward?cityId=${a}`);console.log("Wards Response:",e.data),D(e.data)}catch(e){console.error("Error fetching wards:",e)}};return t.jsxs(B,{open:C,onClose:m,maxWidth:"sm",fullWidth:!0,children:[t.jsx(V,{children:"New Place"}),t.jsxs(z,{children:[t.jsx(v,{fullWidth:!0,options:w,getOptionLabel:a=>a.name,onChange:(a,e)=>{O((e==null?void 0:e.id)||""),f(""),D([]),Y(e==null?void 0:e.id)},renderInput:a=>t.jsx(g,{...a,label:"Province"})}),t.jsx(v,{fullWidth:!0,options:L,getOptionLabel:a=>a.name,onChange:(a,e)=>{f((e==null?void 0:e.id)||""),Z(e==null?void 0:e.id)},renderInput:a=>t.jsx(g,{...a,label:"District"})}),t.jsx(v,{fullWidth:!0,options:l,getOptionLabel:a=>a.wardName||"",value:l.find(a=>a.id===n.wardId)||null,onChange:(a,e)=>{r(o=>({...o,wardId:(e==null?void 0:e.id)||""}))},renderInput:a=>t.jsx(g,{...a,label:"Ward"}),isOptionEqualToValue:(a,e)=>a.id===(e==null?void 0:e.id)}),t.jsx(g,{fullWidth:!0,label:"Time Open",name:"timeOpen",type:"time",value:n.timeOpen,onChange:S,margin:"normal",inputProps:{step:300}}),t.jsx(g,{fullWidth:!0,label:"Time Close",name:"timeClose",type:"time",value:n.timeClose,onChange:S,margin:"normal",inputProps:{step:300}}),t.jsx(g,{fullWidth:!0,label:"Longitude",name:"longitude",value:n.longitude,onChange:a=>y(a.target.value),margin:"normal"}),t.jsx(g,{fullWidth:!0,label:"Latitude",name:"latitude",value:n.latitude,onChange:a=>h(a.target.value),margin:"normal"}),t.jsx(b,{onClick:N,variant:"outlined",children:"Choose on Map"}),t.jsxs(B,{open:I,onClose:()=>j(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(V,{children:"Select Location on Map"}),t.jsx(z,{children:t.jsx(re,{latitude:parseFloat(T)||10.762622,longitude:parseFloat(W)||106.827153,onLocationSelect:k,onCloseMap:A})})]}),t.jsx(g,{fullWidth:!0,label:"Contact Link",name:"contactLink",value:n.contactLink,onChange:S,margin:"normal"}),t.jsx(v,{multiple:!0,id:"tags",options:x,getOptionLabel:a=>a.tagName,onChange:K,renderInput:a=>t.jsx(g,{...a,label:"Tags"})}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("div",{style:{fontWeight:"bold"},children:"Photo Display"}),t.jsx("input",{type:"file",accept:"image/*",id:"photoDisplay",onChange:H})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(b,{variant:"outlined",onClick:Q,children:"Add Place Media"}),n.placeMedia.map((a,e)=>t.jsxs($,{container:!0,spacing:2,alignItems:"center",style:{marginTop:"10px"},children:[t.jsxs($,{item:!0,children:[t.jsxs("label",{htmlFor:`placeMedia-${e}`,children:["Media ",e+1]}),t.jsx("input",{type:"file",accept:"image/*",id:`placeMedia-${e}`,onChange:o=>_(o,e)})]}),t.jsx($,{item:!0,children:t.jsx(b,{variant:"contained",color:"error",onClick:()=>U(e),children:"Remove"})})]},e))]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(b,{variant:"outlined",onClick:q,children:"Add Place Translation"}),n.placeTranslations.map((a,e)=>t.jsxs("div",{style:{marginTop:"15px"},children:[t.jsx(g,{fullWidth:!0,label:`Language Code ${e+1}`,name:"languageCode",value:a.languageCode,onChange:o=>S(o,e),margin:"normal"}),t.jsx(g,{fullWidth:!0,label:`Name ${e+1}`,name:"name",value:a.name,onChange:o=>S(o,e),margin:"normal"}),t.jsx(g,{fullWidth:!0,label:`Description ${e+1}`,name:"description",value:a.description,onChange:o=>S(o,e),margin:"normal"}),t.jsx(g,{fullWidth:!0,label:`Address ${e+1}`,name:"address",value:a.address,onChange:o=>S(o,e),margin:"normal"}),t.jsx(g,{fullWidth:!0,label:`Contact ${e+1}`,name:"contact",value:a.contact,onChange:o=>S(o,e),margin:"normal"}),t.jsx(b,{variant:"outlined",color:"error",onClick:()=>J(e),style:{marginTop:"10px"},children:"Remove Translation"})]},e))]})]}),t.jsxs(fe,{children:[t.jsx(b,{onClick:m,color:"secondary",children:"Cancel"}),t.jsx(b,{onClick:X,color:"primary",children:"Submit"})]})]})}const G=async(C=1,m=5,P="vi",n="",r="")=>{const x=localStorage.getItem("accessToken");if(console.log("Access Token:",x),!x)return console.error("No access token found"),{items:[],totalCount:0};try{const d=await F.get(`https://api.localtour.space/api/Place/getAllByRole?LanguageCode=${P}&Page=${C}&Size=${m}&SearchTerm=${encodeURIComponent(n)}&Status=${r}`,{headers:{Authorization:`Bearer ${x}`}});return console.log("API Response:",d.data),{items:d.data.items,totalCount:d.data.totalCount}}catch(d){return console.error("Error fetching places",d),{items:[],totalCount:0}}};function Se(){const[C,m]=s.useState([]),[P,n]=s.useState(0),[r,x]=s.useState(""),[d,I]=s.useState("vi"),[j,W]=s.useState(!1),[y,T]=s.useState(1),[h,w]=s.useState(5),[M,L]=s.useState("");s.useEffect(()=>{(async()=>{const{items:f,totalCount:k}=await G(y,h,d,r,M);m(f),n(k)})()},[y,h,d,r,M]);const p=async i=>{const f={...i,status:i.status??"0",isVerified:i.isVerified??!1,photoDisplay:i.photoDisplay};m(A=>[...A,f]),n(A=>A+1);const{items:k,totalCount:N}=await G(y,h,d);m(k),n(N)},l=be(),D=ie({inputData:C,comparator:ce(l.order,l.orderBy),filterName:r,filterStatus:M}),E=i=>{m(f=>f.filter(k=>k.id!==i))},O=!D.length&&!!r;return t.jsxs(ee,{children:[t.jsxs(te,{display:"flex",alignItems:"center",mb:5,children:[t.jsx(ae,{variant:"h4",flexGrow:1,children:"Places"}),t.jsx(b,{variant:"contained",color:"inherit",startIcon:t.jsx(se,{icon:"mingcute:add-line"}),onClick:()=>W(!0),children:"New place"})]}),t.jsxs(Ce,{children:[t.jsx(de,{numSelected:l.selected.length,filterName:r,onFilterName:i=>{x(i.target.value),T(1)},onFilterStatus:i=>{L(i||""),T(1)}}),t.jsx(oe,{children:t.jsx(Pe,{sx:{overflow:"unset"},children:t.jsxs(xe,{sx:{minWidth:800},children:[t.jsx(pe,{order:l.order,orderBy:l.orderBy,rowCount:C.length,numSelected:l.selected.length,onSort:l.onSort,onSelectAllRows:i=>l.onSelectAllRows(i,C.map(f=>f.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),t.jsxs(je,{children:[D.slice(l.page*h,l.page*h+h).map(i=>t.jsx(ue,{row:i,selected:l.selected.includes(i.id),onSelectRow:()=>l.onSelectRow(i.id),onDeletePlace:E},i.id)),t.jsx(ge,{height:68,emptyRows:me(l.page,l.rowsPerPage,C.length)}),O&&t.jsx(he,{searchQuery:r})]})]})})}),t.jsx(ye,{component:"div",page:y-1,count:P,rowsPerPage:h,onPageChange:(i,f)=>T(f+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:i=>{w(parseInt(i.target.value,10)),T(1)}})]}),t.jsx(Te,{open:j,onClose:()=>W(!1),onPlaceCreated:p})]})}function be(){const[C,m]=s.useState(0),[P,n]=s.useState("name"),[r,x]=s.useState(5),[d,I]=s.useState([]),[j,W]=s.useState("asc"),y=s.useCallback(p=>{W(P===p&&j==="asc"?"desc":"asc"),n(p)},[j,P]),T=s.useCallback((p,l)=>{if(p){I(l);return}I([])},[]),h=s.useCallback(p=>{const l=d.includes(p)?d.filter(D=>D!==p):[...d,p];I(l)},[d]),w=s.useCallback(()=>{m(0)},[]),M=s.useCallback((p,l)=>{m(l)},[]),L=s.useCallback(p=>{x(parseInt(p.target.value,10)),w()},[w]);return{page:C,order:j,onSort:y,orderBy:P,selected:d,rowsPerPage:r,onSelectRow:h,onResetPage:w,onChangePage:M,onSelectAllRows:T,onChangeRowsPerPage:L}}function Ee(){return t.jsxs(t.Fragment,{children:[t.jsx(ne,{children:t.jsxs("title",{children:[" ",`Places Created - ${le.appName}`]})}),t.jsx(Se,{})]})}export{Ee as default};
