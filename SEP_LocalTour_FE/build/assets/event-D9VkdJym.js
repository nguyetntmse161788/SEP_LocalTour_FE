import{r as l,K as z,j as e,m as y,n as x,Z as I,B as C,A as $,$ as B,h as k,R as w,I as f,y as F,M as H,z as R,E,l as M,a0 as W,N as G,T as A,O as Q,F as K,Q as Y,D as Z,C as q,W as J,i as U,k as X,o as _,Y as V,H as ee}from"./index-H6gA5qqD.js";import{C as te}from"./config-global-BwHnWRtc.js";import{a as O}from"./axiosInstance-DIgiEC3g.js";function ne({row:t,selected:s,onSelectRow:n,onUpdateStatus:o}){const[a,u]=l.useState(null),h=z(),i=l.useCallback(p=>{p.stopPropagation(),u(p.currentTarget)},[]),j=l.useCallback(()=>{u(null)},[]),v=p=>{p.target instanceof HTMLButtonElement||p.target instanceof HTMLInputElement||h(`/event/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsxs(y,{hover:!0,tabIndex:-1,role:"checkbox",selected:s,onClick:v,children:[e.jsx(x,{padding:"checkbox",children:e.jsx(I,{disableRipple:!0,checked:s,onChange:n})}),e.jsx(x,{component:"th",scope:"row",children:e.jsxs(C,{gap:2,display:"flex",alignItems:"center",children:[e.jsx($,{alt:t.eventName||"N/A",src:`/static/mock-images/events/event-${t.id}.jpg`}),t.eventName||"N/A"]})}),e.jsx(x,{children:t.description||"N/A"}),e.jsx(x,{children:t.placeName||"N/A"}),e.jsxs(x,{children:[new Date(t.startDate).toLocaleDateString()," -"," ",new Date(t.endDate).toLocaleDateString()]}),e.jsx(x,{align:"center",children:e.jsx(B,{color:t.eventStatus==="Pending"?"warning":t.eventStatus==="Approved"?"success":t.eventStatus==="Rejected"?"error":"default",children:t.eventStatus})}),e.jsxs(x,{align:"center",children:[e.jsx(k,{variant:"contained",color:"success",size:"small",disabled:t.eventStatus==="Approved",onClick:()=>o("Approved"),children:"Approve"}),e.jsx(k,{variant:"contained",color:"error",size:"small",sx:{ml:1},disabled:t.eventStatus==="Rejected",onClick:()=>o("Rejected"),children:"Reject"})]}),e.jsx(x,{align:"right",children:e.jsx(w,{onClick:i,children:e.jsx(f,{icon:"eva:more-vertical-fill",width:22})})})]}),e.jsx(F,{open:!!a,anchorEl:a,onClose:j,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(H,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${E.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${E.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(R,{onClick:j,children:[e.jsx(f,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(R,{onClick:j,sx:{color:"error.main"},children:[e.jsx(f,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}const se={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function ae(t,s,n){return t?Math.max(0,(1+t)*s-n):0}function D(t,s,n){return s[n]<t[n]?-1:s[n]>t[n]?1:0}function oe(t,s){return t==="desc"?(n,o)=>D(n,o,s):(n,o)=>-D(n,o,s)}function re({inputData:t,comparator:s,filterName:n,filterStatus:o}){let a=[...t];return n&&(a=a.filter(u=>u.eventName.toLowerCase().includes(n.toLowerCase()))),o&&(a=a.filter(u=>u.eventStatus===o)),a.sort(s),a}function le({order:t,onSort:s,orderBy:n,rowCount:o,headLabel:a,numSelected:u,onSelectAllRows:h}){return e.jsx(M,{children:e.jsxs(y,{children:[e.jsx(x,{padding:"checkbox",children:e.jsx(I,{indeterminate:u>0&&u<o,checked:o>0&&u===o,onChange:i=>h(i.target.checked)})}),a.map(i=>e.jsx(x,{align:i.align||"left",sortDirection:n===i.id?t:!1,sx:{width:i.width,minWidth:i.minWidth},children:e.jsxs(W,{hideSortIcon:!0,active:n===i.id,direction:n===i.id?t:"asc",onClick:()=>s(i.id),children:[i.label,n===i.id?e.jsx(C,{sx:{...se},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},i.id))]})})}function ie({numSelected:t,filterName:s,onFilterName:n,onFilterStatus:o}){const[a,u]=l.useState(null),[h,i]=l.useState(null),j=c=>{i(c),o(c),u(null)},v=c=>{u(c.currentTarget)},p=()=>{u(null)},b=!!a;return e.jsxs(G,{sx:{height:96,display:"flex",justifyContent:"space-between",p:c=>c.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(A,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(Q,{fullWidth:!0,value:s,onChange:n,placeholder:"Search event...",startAdornment:e.jsx(K,{position:"start",children:e.jsx(f,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),t>0?e.jsx(w,{children:e.jsx(f,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Filter list",children:e.jsx(w,{onClick:v,children:e.jsx(f,{icon:"ic:round-filter-list"})})}),e.jsx(F,{open:b,anchorEl:a,onClose:p,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(C,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(c=>e.jsx(k,{variant:h===(c==="All"?null:c)?"contained":"outlined",onClick:()=>j(c==="All"?null:c),sx:{color:h===(c==="All"?null:c)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:c},c))})})]})]})}function ce({emptyRows:t,height:s,sx:n,...o}){return t?e.jsx(y,{sx:{...s&&{height:s*t},...n},...o,children:e.jsx(x,{colSpan:9})}):null}function de({searchQuery:t,...s}){return e.jsx(y,{...s,children:e.jsx(x,{align:"center",colSpan:7,children:e.jsxs(C,{sx:{py:15,textAlign:"center"},children:[e.jsx(A,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(A,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const ue=async(t=1,s=5,n="vi")=>{const o=localStorage.getItem("accessToken");if(console.log("Access Token:",o),!o)return console.error("No access token found"),{items:[],totalCount:0};try{const a=await O.get("https://api.localtour.space/api/Event/getallevent",{headers:{Authorization:`Bearer ${o}`},params:{LanguageCode:n,Page:t,Size:s}});return console.log("API Response:",a.data),{items:a.data.items,totalCount:a.data.totalCount}}catch(a){return console.error("Error fetching events",a),{items:[],totalCount:0}}},he=async(t,s,n)=>{const o=localStorage.getItem("accessToken");if(!o)return console.error("No access token found"),null;try{return(await O.put("https://api.localtour.space/api/Event/changeStatusEvent",null,{headers:{Authorization:`Bearer ${o}`},params:{placeid:t,eventid:s,status:n}})).data}catch(a){return console.error("Error updating event status:",a),null}};function pe(){const[t,s]=l.useState([]),[n,o]=l.useState(0),[a,u]=l.useState(""),[h,i]=l.useState("vi"),[j,v]=l.useState(null),[p,b]=l.useState(1),[c,S]=l.useState(5);l.useEffect(()=>{(async()=>{const{items:m,totalCount:N}=await ue(p,c,h);s(m),o(N)})()},[p,c,h,n]);const d=ge(),P=re({inputData:t,comparator:oe(d.order,d.orderBy),filterName:a,filterStatus:j}),g=!P.length&&!!a;return e.jsxs(Z,{children:[e.jsxs(C,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(A,{variant:"h4",flexGrow:1,children:"Events"}),e.jsx(k,{variant:"contained",color:"inherit",startIcon:e.jsx(f,{icon:"mingcute:add-line"}),children:"New event"})]}),e.jsxs(q,{children:[e.jsx(ie,{numSelected:d.selected.length,filterName:a,onFilterName:r=>{u(r.target.value),d.onResetPage()},onFilterStatus:r=>v(r)}),e.jsx(J,{children:e.jsx(U,{sx:{overflow:"unset"},children:e.jsxs(X,{sx:{minWidth:800},children:[e.jsx(le,{order:d.order,orderBy:d.orderBy,rowCount:t.length,numSelected:d.selected.length,onSort:d.onSort,onSelectAllRows:r=>d.onSelectAllRows(r,t.map(m=>m.id.toString())),headLabel:[{id:"eventName",label:"Event Name"},{id:"description",label:"Description"},{id:"placeName",label:"Place Name"},{id:"startDate - endDate",label:"Start Date - End Date"},{id:"status",label:"Status"},{id:"actions",label:"Actions"},{id:""}]}),e.jsxs(_,{children:[P.slice(d.page*d.rowsPerPage,d.page*d.rowsPerPage+d.rowsPerPage).map(r=>e.jsx(ne,{row:r,selected:d.selected.includes(r.id.toString()),onSelectRow:()=>d.onSelectRow(r.id.toString()),onUpdateStatus:async m=>{await he(r.placeId,r.id,m)&&s(L=>L.map(T=>T.id===r.id?{...T,eventStatus:m}:T))}},r.id)),e.jsx(ce,{height:68,emptyRows:ae(d.page,d.rowsPerPage,t.length)}),g&&e.jsx(de,{searchQuery:a})]})]})})}),e.jsx(V,{component:"div",page:p-1,count:n,rowsPerPage:c,onPageChange:(r,m)=>b(m+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:r=>{S(parseInt(r.target.value,10)),b(1)}})]})]})}function ge(){const[t,s]=l.useState(0),[n,o]=l.useState("eventName"),[a,u]=l.useState(5),[h,i]=l.useState([]),[j,v]=l.useState("asc"),p=l.useCallback(g=>{v(n===g&&j==="asc"?"desc":"asc"),o(g)},[j,n]),b=l.useCallback((g,r)=>{if(g){i(r);return}i([])},[]),c=l.useCallback(g=>{const r=h.includes(g)?h.filter(m=>m!==g):[...h,g];i(r)},[h]),S=l.useCallback(()=>{s(0)},[]),d=l.useCallback((g,r)=>{s(r)},[]),P=l.useCallback(g=>{u(parseInt(g.target.value,10)),S()},[S]);return{page:t,order:j,onSort:p,orderBy:n,selected:h,rowsPerPage:a,onSelectRow:c,onResetPage:S,onChangePage:d,onSelectAllRows:b,onChangeRowsPerPage:P}}function ve(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsxs("title",{children:[" ",`Places - ${te.appName}`]})}),e.jsx(pe,{})]})}export{ve as default};
