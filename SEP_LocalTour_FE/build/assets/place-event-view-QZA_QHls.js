import{r as i,j as e,h as m,aa as q,R as K,p as V,aF as J,K as Q,D as A,B as y,q as X,T as c,I as F,G as g,C as B,H as Z}from"./index-JURld8WI.js";import{C as _}from"./config-global-BwHnWRtc.js";import{a as $}from"./axiosInstance-CjnSQzAP.js";import{D as z,a as R,b as O,c as W}from"./DialogTitle-CQRIIkos.js";import{T as b}from"./TextField-BAa1lkAG.js";import"./InputLabel-CrY5KikR.js";function ee({open:d,onClose:a,onEventCreated:v,placeId:w}){const[D,S]=i.useState(""),[t,h]=i.useState(""),[I,E]=i.useState(""),[C,f]=i.useState(""),[j,P]=i.useState(null);i.useEffect(()=>{d||(S(""),h(""),E(""),f(""),P(null))},[d]);const r=o=>{o.target.files&&o.target.files.length>0&&P(o.target.files[0])},n=async()=>{const o=localStorage.getItem("accessToken");if(!o){console.error("No access token found");return}const T=new Date(I).toISOString(),k=new Date(C).toISOString(),u=new FormData;u.append("placeid",w),u.append("eventName",D),u.append("description",t),u.append("startDate",T),u.append("endDate",k),j&&u.append("eventPhoto",j),console.log("Data being sent to API:",u);try{const N=await $.post("https://api.localtour.space/api/Event/create",u,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}});console.log("Event created response:",N.data),v(N.data),a(),p()}catch(N){console.error("Error creating event",N)}},p=()=>{S(""),h(""),E(""),f(""),P(null)};return e.jsxs(z,{open:d,onClose:a,children:[e.jsx(R,{children:"Create Event"}),e.jsxs(O,{children:[e.jsx(b,{label:"Event Name",fullWidth:!0,value:D,onChange:o=>S(o.target.value),margin:"normal"}),e.jsx(b,{label:"Description",fullWidth:!0,value:t,onChange:o=>h(o.target.value),margin:"normal"}),e.jsx(b,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:I,onChange:o=>E(o.target.value),margin:"normal"}),e.jsx(b,{label:"End Date",type:"datetime-local",fullWidth:!0,value:C,onChange:o=>f(o.target.value),margin:"normal"}),e.jsx("input",{id:"event-photo",type:"file",accept:"image/*",onChange:r,style:{marginTop:"1rem"}})]}),e.jsxs(W,{children:[e.jsx(m,{onClick:a,color:"primary",children:"Cancel"}),e.jsx(m,{onClick:n,color:"primary",children:"Create"})]})]})}const te=q(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");function ae({open:d,onClose:a,initialData:v,onEventUpdated:w,placeId:D,eventId:S}){const[t,h]=i.useState({eventName:"",startDate:"",endDate:"",description:"",eventPhotoDisplay:"",eventPhotoFile:null}),[I,E]=i.useState(!1);i.useEffect(()=>{v&&h({...v,startDate:C(v.startDate),endDate:C(v.endDate)})},[v]);const C=r=>{if(!r)return"";const n=new Date(r),p=n.getFullYear(),o=(n.getMonth()+1).toString().padStart(2,"0"),T=n.getDate().toString().padStart(2,"0"),k=n.getHours().toString().padStart(2,"0"),u=n.getMinutes().toString().padStart(2,"0");return`${p}-${o}-${T}T${k}:${u}`},f=()=>{h({...t,eventPhotoDisplay:"",eventPhotoFile:null}),E(!0)},j=r=>{if(r.target.files&&r.target.files[0]){const n=r.target.files[0],p=URL.createObjectURL(n);h({...t,eventPhotoDisplay:p,eventPhotoFile:n}),E(!1)}},P=async()=>{const r=localStorage.getItem("accessToken");if(!r){console.error("No access token found");return}const n=new FormData;n.append("placeid",D),n.append("eventid",S),n.append("EventName",t.eventName),n.append("Description",t.description),n.append("StartDate",t.startDate),n.append("EndDate",t.endDate),t.eventPhotoFile&&n.append("EventPhoto",t.eventPhotoFile);try{const p=await V.put("https://api.localtour.space/api/Event/update",n,{headers:{accept:"text/plain","Content-Type":"multipart/form-data",Authorization:`Bearer ${r}`}});w(p.data.data),a()}catch(p){console.error("Error submitting event data:",p)}};return e.jsxs(z,{open:d,onClose:a,children:[e.jsx(R,{children:"Edit Event"}),e.jsxs(O,{children:[e.jsx(b,{label:"Event Name",value:t.eventName,onChange:r=>h({...t,eventName:r.target.value}),fullWidth:!0,margin:"normal"}),e.jsx(b,{label:"Start Date & Time",type:"datetime-local",value:t.startDate,onChange:r=>h({...t,startDate:r.target.value}),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(b,{label:"End Date & Time",type:"datetime-local",value:t.endDate,onChange:r=>h({...t,endDate:r.target.value}),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(b,{label:"Description",value:t.description,onChange:r=>h({...t,description:r.target.value}),fullWidth:!0,margin:"normal",multiline:!0,rows:4}),t.eventPhotoDisplay&&!I?e.jsxs("div",{style:{position:"relative",margin:"10px 0"},children:[e.jsx("img",{src:t.eventPhotoDisplay,alt:"Event",style:{width:"150px",height:"auto",borderRadius:"8px"}}),e.jsx(K,{style:{position:"absolute",top:"-5px",right:"-5px",backgroundColor:"white",padding:"3px",zIndex:1},onClick:f,children:e.jsx(te,{})})]}):e.jsx("input",{type:"file",accept:"image/*",onChange:j,style:{margin:"10px 0"}})]}),e.jsxs(W,{children:[e.jsx(m,{onClick:a,children:"Cancel"}),e.jsx(m,{onClick:P,color:"primary",children:"Save Changes"})]})]})}function ne(){var U,H,G,M;const{id:d}=J(),[a,v]=i.useState(null),[w,D]=i.useState([]),[S,t]=i.useState(!0),[h,I]=i.useState(!1),E=Q(),[C,f]=i.useState(!1),[j,P]=i.useState(null),[r,n]=i.useState(!1),[p,o]=i.useState(null),T=async s=>{await k()};i.useEffect(()=>{(async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{const x=await $.get(`https://api.localtour.space/api/Place/getPlaceById?languageCode=vi&placeid=${d}`,{headers:{Authorization:`Bearer ${l}`}});v(x.data),t(!1)}catch(x){console.error("Error fetching place details",x),t(!1)}})()},[d]),i.useEffect(()=>{d&&(async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{const x=await $.get(`https://api.localtour.space/api/Event/getall?placeid=${d}&languageCode=vi`,{headers:{Authorization:`Bearer ${l}`}});console.log("Place events data:",x.data.items),D(x.data.items)}catch(x){console.error("Error fetching place events",x)}})()},[d]);const k=async()=>{const s=localStorage.getItem("accessToken");if(!s){console.error("No access token found");return}try{const l=await $.get(`https://api.localtour.space/api/Event/getall?placeid=${d}&languageCode=vi`,{headers:{Authorization:`Bearer ${s}`}});console.log("Updated place events data:",l.data.items),D(l.data.items)}catch(l){console.error("Error fetching place events",l)}},u=async s=>{await k(),f(!1)},N=async()=>{if(!p)return;const s=localStorage.getItem("accessToken");if(!s){console.error("No access token found");return}try{await V.delete(`https://api.localtour.space/api/Event/delete?placeid=${d}&eventid=${p.id}`,{headers:{Authorization:`Bearer ${s}`}}),D(l=>l.filter(x=>x.id!==p.id)),n(!1)}catch(l){console.error("Error deleting event",l)}},Y=s=>{o(s),n(!0)},L=()=>{n(!1),o(null)};return S?e.jsx(A,{children:e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(X,{})})}):a?(a.status,a.status,a.status,e.jsxs(A,{children:[e.jsxs(y,{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(m,{variant:"outlined",color:"primary",startIcon:e.jsx(F,{icon:"eva:arrow-back-fill"}),onClick:()=>E("/owner/event"),children:"Back to List"}),e.jsx(c,{variant:"h4",children:"Place Detail"}),e.jsx(m,{variant:"contained",color:"secondary",startIcon:e.jsx(F,{icon:"mingcute:edit-line"}),children:"Edit"})]}),e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,md:4,children:e.jsx(B,{sx:{p:2,boxShadow:3},children:e.jsx(y,{mb:2,display:"flex",justifyContent:"center",children:e.jsx("img",{src:a.photoDisplay,alt:(U=a.placeTranslations[0])==null?void 0:U.name,style:{width:"100%",height:"auto",maxHeight:"400px",objectFit:"cover"}})})})}),e.jsx(g,{item:!0,xs:12,md:8,children:e.jsxs(B,{sx:{p:3,boxShadow:3},children:[e.jsx(c,{variant:"h5",mb:2,children:(H=a.placeTranslations[0])==null?void 0:H.name}),e.jsxs(c,{variant:"body1",mb:2,children:["Address: ",(G=a.placeTranslations[0])==null?void 0:G.address]}),e.jsxs(c,{variant:"body1",mb:2,children:["Description: ",(M=a.placeTranslations[0])==null?void 0:M.description]}),e.jsxs(g,{container:!0,spacing:2,children:[e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Opening Time: ",a.timeOpen]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Closing Time: ",a.timeClose]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Longitude: ",a.longitude]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Latitude: ",a.latitude]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Status: ",a.status==="Approved"?"Approved":a.status==="Rejected"?"Rejected":"Pending"]})})]})]})})]}),e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(c,{variant:"h5",children:"Place Events"}),e.jsx(m,{variant:"contained",color:"primary",startIcon:e.jsx(F,{icon:"mingcute:add-line"}),onClick:()=>I(!0),children:"Create Event"})]}),w.length>0?e.jsx(y,{mt:4,children:e.jsx(g,{container:!0,spacing:3,children:w.map(s=>{var l;return e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(B,{sx:{p:2,boxShadow:2,borderRadius:2,height:"100%"},children:[e.jsx(y,{position:"relative",mb:2,children:s.eventPhotoDisplay?e.jsx("img",{src:s.eventPhotoDisplay,alt:s.eventName||"Event",style:{width:"100%",height:"200px",borderRadius:"8px",objectFit:"cover"}}):e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",sx:{width:"100%",height:"200px",borderRadius:"8px",backgroundColor:"#f0f0f0",fontSize:"3rem",fontWeight:"bold",color:"#888"},children:(l=s.eventName)==null?void 0:l.charAt(0)})}),e.jsx(c,{variant:"h6",fontWeight:"bold",textAlign:"center",mb:1,children:s.eventName}),e.jsxs(c,{variant:"body2",color:"text.secondary",mb:1,children:["Start Date: ",s.startDate]}),e.jsxs(c,{variant:"body2",color:"text.secondary",mb:1,children:["End Date: ",s.endDate]}),e.jsxs(y,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(m,{variant:"outlined",size:"small",color:"primary",children:"View"}),e.jsx(m,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx(F,{icon:"eva:edit-outline"}),onClick:()=>{P(s),f(!0),console.log(s)},children:"Edit"}),e.jsx(m,{variant:"outlined",color:"error",onClick:()=>Y(s),children:e.jsx(F,{icon:"eva:trash-2-outline"})})]})]})},s.id)})})}):e.jsx(c,{variant:"body1",color:"text.secondary",mt:3,children:"No events found for this place."}),e.jsxs(z,{open:r,onClose:L,children:[e.jsx(R,{children:"Are you sure you want to delete this item?"}),e.jsx(O,{children:e.jsx(c,{variant:"body2",children:"This action cannot be undone."})}),e.jsxs(W,{children:[e.jsx(m,{onClick:L,color:"primary",children:"No"}),e.jsx(m,{onClick:N,color:"error",children:"Yes, Delete"})]})]}),C&&e.jsx(ae,{open:C,onClose:()=>f(!1),initialData:j,onEventUpdated:u,placeId:d||"",eventId:(j==null?void 0:j.id)||""}),e.jsx(ee,{open:h,onClose:()=>I(!1),onEventCreated:T,placeId:d||""})]})):e.jsx(A,{children:e.jsx(y,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(c,{variant:"h5",children:"Place not found"})})})}function de(){return e.jsxs(e.Fragment,{children:[e.jsx(Z,{children:e.jsxs("title",{children:[" ",`Place Details - ${_.appName}`]})}),e.jsx(ne,{})]})}export{de as default};
