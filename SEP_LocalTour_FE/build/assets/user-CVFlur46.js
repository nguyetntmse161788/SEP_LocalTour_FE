import{j as e,B as k,f as C,K as R,A as U,k as y,N as I,J as A,I as S,O as v,l as B,r as o,S as F,H as O}from"./index-BCEoXUgR.js";import{C as D}from"./config-global-BwHnWRtc.js";import{a as N}from"./index-Br0q4W-C.js";import{T as P,a as i,b as E,c as $,d as J,e as L}from"./TableSortLabel-D4yi4Kr4.js";import{a as z,g as H,U as M,e as W}from"./user-table-head-CRMRvCeL.js";import{O as G}from"./Select-BESDqWty.js";import{C as K}from"./Card-CnlOfLcQ.js";import"./LastPage-CTy_b4eb.js";function Q({searchQuery:a,...t}){return e.jsx(P,{...t,children:e.jsx(i,{align:"center",colSpan:7,children:e.jsxs(k,{sx:{py:15,textAlign:"center"},children:[e.jsx(C,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(C,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',a,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function _({row:a,selected:t,onSelectRow:u}){const n=R(),x=async(c,l,h)=>{try{const s=localStorage.getItem("accessToken");if(!s){alert("No token found. Please log in."),n("/sign-in");return}const f=JSON.parse(atob(s.split(".")[1])),g=Math.floor(Date.now()/1e3);if(f.exp<g){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),n("/login");return}const r=(await N.get(`https://api.localtour.space/api/User/getProfile?userId=${c}`,{headers:{Authorization:`Bearer ${s}`}})).data;n("/admin/role",{state:{user:r,userId:c,userName:l,role:h}})}catch(s){console.error("Failed to fetch user profile:",s),alert("Error fetching user profile. Please try again.")}},j=async(c,l,h)=>{try{const s=localStorage.getItem("accessToken");if(!s){alert("No token found. Please log in."),n("/sign-in");return}const f=JSON.parse(atob(s.split(".")[1])),g=Math.floor(Date.now()/1e3);if(f.exp<g){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),n("/sign-in");return}const m=await N.get(`https://api.localtour.space/api/User/getProfile?userId=${c}`,{headers:{Authorization:`Bearer ${s}`}});if(m.status===200){const r=m.data;n("/admin/ban",{state:{user:r,userId:c,userName:l,endDate:h}})}else alert("User profile not found. Please try again.")}catch(s){console.error("Failed to fetch user profile:",s),alert("Error fetching user profile. Please try again.")}};return e.jsxs(P,{hover:!0,tabIndex:-1,role:"checkbox",selected:t,children:[e.jsx(i,{children:e.jsx(U,{alt:a.fullName,src:a.profilePictureUrl})}),e.jsx(i,{children:a.userName}),e.jsx(i,{children:a.email}),e.jsx(i,{children:a.fullName}),e.jsx(i,{children:a.phoneNumber}),e.jsx(i,{children:a.dateOfBirth}),e.jsx(i,{children:a.address}),e.jsxs(i,{children:[e.jsx(y,{variant:"outlined",color:"primary",sx:{margin:"0 5px"},onClick:()=>n("/admin/updateUser",{state:{user:a}}),children:"Update Profile"}),e.jsx(y,{variant:"outlined",color:"primary",sx:{margin:"0 5px"},onClick:()=>x(a.id,a.userName,a.role),children:"Set Role"}),e.jsx(y,{variant:"outlined",color:"error",sx:{margin:"0 5px"},onClick:()=>j(a.id,a.userName,a.endDate),children:"Ban"})]})]})}function q({emptyRows:a,height:t,sx:u,...n}){return a?e.jsx(P,{sx:{...t&&{height:t*a},...u},...n,children:e.jsx(i,{colSpan:9})}):null}function X({numSelected:a,filterName:t,onFilterName:u}){return e.jsxs(I,{sx:{height:96,display:"flex",justifyContent:"space-between",p:n=>n.spacing(0,1,0,3),...a>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[a>0?e.jsxs(C,{component:"div",variant:"subtitle1",children:[a," selected"]}):e.jsx(G,{fullWidth:!0,value:t,onChange:u,placeholder:"Search user...",startAdornment:e.jsx(A,{position:"start",children:e.jsx(S,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),a>0?e.jsx(v,{title:"Delete",children:e.jsx(B,{children:e.jsx(S,{icon:"solar:trash-bin-trash-bold"})})}):e.jsx(v,{title:"Filter list",children:e.jsx(B,{children:e.jsx(S,{icon:"ic:round-filter-list"})})})]})}function Y(){const a=R(),[t,u]=o.useState([]),[n,x]=o.useState(!0),[j,c]=o.useState(""),[l,h]=o.useState(""),s=Z();o.useEffect(()=>{const r=localStorage.getItem("accessToken");if(!r){c("No access token found. Please log in."),x(!1),a("/login");return}const b=JSON.parse(atob(r.split(".")[1])),T=Math.floor(Date.now()/1e3);if(b.exp<T){c("Token has expired. Please log in again."),x(!1),a("/sign-in");return}f(r)},[a]);const f=async r=>{try{const b=await N.get("https://api.localtour.space/api/User",{headers:{Authorization:`Bearer ${r}`}});u(b.data)}catch{c("Failed to fetch users")}finally{x(!1)}},g=z({inputData:t,comparator:H(s.order,s.orderBy),filterName:l}),m=!g.length&&!!l;return n?e.jsx("div",{children:"Loading..."}):e.jsxs(k,{sx:{p:3},children:[e.jsx(k,{display:"flex",alignItems:"center",mb:5,children:e.jsx(y,{variant:"contained",color:"inherit",startIcon:e.jsx(S,{icon:"mingcute:add-line"}),onClick:()=>a("/admin/register"),children:"New user"})}),e.jsxs(K,{children:[e.jsx(X,{filterName:l,onFilterName:r=>{h(r.target.value),s.onResetPage()},numSelected:0}),e.jsx(F,{children:e.jsx(E,{sx:{overflow:"unset"},children:e.jsxs($,{sx:{minWidth:800},children:[e.jsx(M,{order:s.order,orderBy:s.orderBy,rowCount:t.length,numSelected:s.selected.length,onSort:s.onSort,headLabel:[{id:"avatar",label:"Avatar"},{id:"username",label:"Username"},{id:"email",label:"Email"},{id:"fullname",label:"Full Name"},{id:"phone",label:"Phone"},{id:"DoB",label:"Date of Birth"},{id:"address",label:"Address"},{id:"button",label:"Action"}]}),e.jsxs(J,{children:[n&&e.jsxs(P,{children:[e.jsx(i,{colSpan:8,align:"center",children:"Loading..."}),"  "]}),j&&e.jsx(P,{children:e.jsx(i,{colSpan:8,align:"center",sx:{color:"error.main"},children:j})}),g.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(r=>e.jsx(_,{row:r,selected:s.selected.includes(r.id),onSelectRow:()=>s.onSelectRow(r.id)},r.id)),e.jsx(q,{height:68,emptyRows:W(s.page,s.rowsPerPage,t.length)}),m&&e.jsx(Q,{searchQuery:l})]})]})})}),e.jsx(L,{component:"div",page:s.page,count:t.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage})]})]})}function Z(){const[a,t]=o.useState(0),[u,n]=o.useState("username"),[x,j]=o.useState(5),[c,l]=o.useState([]),[h,s]=o.useState("asc"),f=o.useCallback(d=>{s(u===d&&h==="asc"?"desc":"asc"),n(d)},[h,u]),g=o.useCallback((d,p)=>{if(d){l(p);return}l([])},[]),m=o.useCallback(d=>{l(p=>p.includes(d)?p.filter(w=>w!==d):[...p,d])},[]),r=o.useCallback(()=>t(0),[]),b=o.useCallback((d,p)=>{t(p)},[]),T=o.useCallback(d=>{j(parseInt(d.target.value,10)),r()},[r]);return{page:a,order:h,orderBy:u,rowsPerPage:x,selected:c,onSort:f,onSelectRow:m,onSelectAllRows:g,onResetPage:r,onChangePage:b,onChangeRowsPerPage:T}}function le(){return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsxs("title",{children:[" ",`Users - ${D.appName}`]})}),e.jsx(Y,{})]})}export{le as default};
