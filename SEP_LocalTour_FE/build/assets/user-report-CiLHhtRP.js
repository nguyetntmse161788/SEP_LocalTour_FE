import{j as e,B as S,T as P,x as N,I as b,y as T,w,h as I,l as v,r,z as D,H as B}from"./index-D4PwaD5N.js";import{C as U}from"./config-global-DYC5wpSI.js";import{c as R,d as h,T as F,a as E,e as O}from"./TableRow-B7nkHKsf.js";import{U as z}from"./user-table-head-_jQga8ae.js";import{O as $}from"./Select-545m9gIo.js";import{I as L}from"./InputAdornment-BfKJzYYN.js";import{T as k,a as H}from"./TableSortLabel-CWuwd1kD.js";import{b as W,g as G,e as J}from"./utils-C5x2pCfd.js";import{a as M}from"./axiosInstance-Q6XP8Ys3.js";import{C as Q}from"./Card-CkOvGVvy.js";import"./useFormControl-BxpVqGaN.js";import"./Popper-ChwOFtB3.js";import"./LastPage-B1ewK7Uw.js";function _({emptyRows:t,height:n,sx:i,...l}){return t?e.jsx(R,{sx:{...n&&{height:n*t},...i},...l,children:e.jsx(h,{colSpan:9})}):null}function q({searchQuery:t,...n}){return e.jsx(R,{...n,children:e.jsx(h,{align:"center",colSpan:7,children:e.jsxs(S,{sx:{py:15,textAlign:"center"},children:[e.jsx(P,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(P,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function K({numSelected:t,filterName:n,onFilterName:i}){return e.jsxs(N,{sx:{height:96,display:"flex",justifyContent:"space-between",p:l=>l.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(P,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx($,{fullWidth:!0,value:n,onChange:i,placeholder:"Search user...",startAdornment:e.jsx(L,{position:"start",children:e.jsx(b,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),t>0?e.jsx(k,{title:"Delete",children:e.jsx(T,{children:e.jsx(b,{icon:"solar:trash-bin-trash-bold"})})}):e.jsx(k,{title:"Filter list",children:e.jsx(T,{children:e.jsx(b,{icon:"ic:round-filter-list"})})})]})}function X({row:t,selected:n,onSelectRow:i}){w();const l=async(m,g)=>{var x,s,d;const u=localStorage.getItem("accessToken");if(!u){alert("No access token found. Please log in.");return}try{const c={id:t.id,userReportId:t.userReportId,userId:t.userId,content:t.content,reportDate:t.reportDate,status:g};await M.put(`https://api.localtour.space/api/UserReport/${m}`,c,{headers:{Authorization:`Bearer ${u}`}}),alert(`Report has been updated to: ${g}`)}catch(c){v.isAxiosError(c)?(console.error("Error message:",c.message),console.error("Response data:",(x=c.response)==null?void 0:x.data),alert(`Failed to update report: ${((d=(s=c.response)==null?void 0:s.data)==null?void 0:d.message)||c.message}`)):(console.error("Unexpected error",c),alert("An unexpected error occurred."))}};return e.jsxs(R,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[e.jsx(h,{children:t.id}),e.jsx(h,{children:t.userId}),e.jsx(h,{children:t.content}),e.jsx(h,{children:new Date(t.reportDate).toLocaleString()}),e.jsx(h,{children:t.status}),e.jsxs(h,{children:[e.jsx(I,{variant:"outlined",color:"success",size:"small",onClick:()=>l(t.id,"Accepted"),children:"Accept"}),e.jsx(I,{variant:"outlined",color:"error",size:"small",onClick:()=>l(t.id,"Rejected"),style:{marginLeft:"8px"},children:"Reject"})]})]})}function Y(){const[t,n]=r.useState([]),[i,l]=r.useState(!0),[m,g]=r.useState(""),[u,x]=r.useState(""),s=Z(),d=w(),c=r.useCallback(()=>d("/some-path"),[d]),f=r.useCallback(a=>{g(a),l(!1),d("/sign-in")},[d]);r.useEffect(()=>{const a=localStorage.getItem("accessToken");if(!a){f("No access token found. Please log in.");return}const o=JSON.parse(atob(a.split(".")[1])),p=Math.floor(Date.now()/1e3);if(o.exp<p){f("Token has expired. Please log in again.");return}y(a)},[c,f]);const y=async a=>{l(!0);try{const o=await v.get("https://api.localtour.space/api/UserReport",{headers:{Authorization:`Bearer ${a}`}});n(o.data)}catch{g("Failed to fetch user reports")}finally{l(!1)}},j=W({reportData:t,comparator:G(s.order,s.orderBy),filterName:u}),C=!j.length&&!!u;return i?e.jsx("div",{children:"Loading..."}):e.jsxs(S,{sx:{p:3},children:[e.jsxs(S,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(P,{variant:"h4",sx:{flexGrow:1},children:"User Reports"}),e.jsx(I,{variant:"contained",color:"inherit",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),onClick:()=>d("/create-report"),children:"New Report"})]}),e.jsxs(Q,{children:[e.jsx(K,{filterName:u,onFilterName:a=>{x(a.target.value),s.onResetPage()},numSelected:0}),e.jsx(D,{children:e.jsx(F,{sx:{overflow:"unset"},children:e.jsxs(E,{sx:{minWidth:800},children:[e.jsx(z,{order:s.order,orderBy:s.orderBy,rowCount:t.length,numSelected:s.selected.length,onSort:s.onSort,headLabel:[{id:"id",label:"ID"},{id:"userId",label:"User ID"},{id:"content",label:"Content"},{id:"reportDate",label:"Report Date"},{id:"status",label:"Status"},{id:"action",label:"Action"}]}),e.jsxs(O,{children:[m&&e.jsx(R,{children:e.jsx(h,{colSpan:6,align:"center",sx:{color:"error.main"},children:m})}),j.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(a=>e.jsx(X,{row:a,selected:s.selected.includes(a.userId),onSelectRow:()=>s.onSelectRow(a.userId)},a.userId)),e.jsx(_,{height:68,emptyRows:J(s.page,s.rowsPerPage,t.length)}),C&&e.jsx(q,{searchQuery:u})]})]})})}),e.jsx(H,{component:"div",page:s.page,count:t.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage})]})]})}function Z(){const[t,n]=r.useState(0),[i,l]=r.useState("userReportId"),[m,g]=r.useState(5),[u,x]=r.useState([]),[s,d]=r.useState("asc"),c=r.useCallback(o=>{d(i===o&&s==="asc"?"desc":"asc"),l(o)},[s,i]),f=r.useCallback((o,p)=>{if(o){x(p);return}x([])},[]),y=r.useCallback(o=>{x(p=>p.includes(o)?p.filter(A=>A!==o):[...p,o])},[]),j=r.useCallback(()=>n(0),[]),C=r.useCallback((o,p)=>{n(p)},[]),a=r.useCallback(o=>{g(parseInt(o.target.value,10)),j()},[j]);return{page:t,order:s,orderBy:i,rowsPerPage:m,selected:u,onSort:c,onSelectRow:y,onSelectAllRows:f,onResetPage:j,onChangePage:C,onChangeRowsPerPage:a}}function ue(){return e.jsxs(e.Fragment,{children:[e.jsx(B,{children:e.jsxs("title",{children:[" ",`Report User - ${U.appName}`]})}),e.jsx(Y,{})]})}export{ue as default};
