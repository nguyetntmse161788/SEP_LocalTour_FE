import{r as i,j as a,k as T,y as M,B as R,f as I,I as A,S as D,H as N}from"./index-B2v2_DKC.js";import{C as W}from"./config-global-BwHnWRtc.js";import{a as k}from"./index-Br0q4W-C.js";import{a as F,g as L,P as O,b as $,c as B,T as E,e as V,d as G}from"./place-table-toolbar-Bghj7UMr.js";import{D as z,a as H,b as _,c as J}from"./DialogTitle-CBWEPAMj.js";import{T as p}from"./TextField-D6uFeavD.js";import{A as Q}from"./Autocomplete-D-ehp4fC.js";import{G as v}from"./Grid-DvJR57Hl.js";import{C as q}from"./Card-DGcZmdxA.js";import{d as K,e as U,f as X,g as Y}from"./TableSortLabel-BwsI00UK.js";import"./Checkbox-uchoM3R5.js";import"./Select-TXDlS2nK.js";import"./LastPage-CE1CEipW.js";function Z({open:m,onClose:u,onPlaceCreated:f}){const[n,o]=i.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),[b,g]=i.useState([]);i.useEffect(()=>{(async()=>{try{const e=await k.get("https://api.localtour.space/api/Tag/getAll");g(e.data.items)}catch(e){console.error("Error fetching tags:",e)}})()},[]);const d=(t,e)=>{const{name:s,value:r}=t.target;o(e!==void 0?l=>{const w=[...l.placeTranslations];return w[e]={...w[e],[s]:r},{...l,placeTranslations:w}}:l=>({...l,[s]:r}))},C=t=>{const e=t.target.files;e&&e[0]&&o(s=>({...s,photoDisplay:e[0]}))},x=(t,e)=>{const s=t.target.files;s&&s.length>0?o(r=>{const l=[...r.placeMedia];return l[e]=s[0],{...r,placeMedia:l}}):o(r=>{const l=[...r.placeMedia];return l[e]=null,{...r,placeMedia:l}})},P=()=>{o(t=>({...t,placeTranslations:[...t.placeTranslations,{languageCode:"",name:"",description:"",address:"",contact:""}]}))},y=t=>{o(e=>{const s=e.placeTranslations.filter((r,l)=>l!==t);return{...e,placeTranslations:s}})},h=()=>{o(t=>({...t,placeMedia:[...t.placeMedia,null]}))},j=t=>{o(e=>{const s=e.placeMedia.filter((r,l)=>l!==t);return{...e,placeMedia:s}})},S=(t,e)=>{o(s=>({...s,tags:e.map(r=>r.id)}))},c=async()=>{try{const t=localStorage.getItem("accessToken"),e=new FormData;e.append("WardId",n.wardId),e.append("TimeOpen",n.timeOpen),e.append("TimeClose",n.timeClose),e.append("Longitude",n.longitude),e.append("Latitude",n.latitude),e.append("ContactLink",n.contactLink),n.tags.forEach(l=>{e.append("Tags",l)}),n.placeTranslations.forEach(l=>{e.append("PlaceTranslation",JSON.stringify(l))}),n.photoDisplay&&e.append("PhotoDisplay",n.photoDisplay),n.placeMedia.forEach((l,w)=>{l&&e.append("PlaceMedia",l)});const r=(await k.post("https://api.localtour.space/api/Place/create",e,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"multipart/form-data"}})).data;console.log("newPlace",r),alert("Place created successfully!"),f(r),u()}catch(t){console.error("Error creating place:",t),alert("Failed to create place.")}};return a.jsxs(z,{open:m,onClose:u,maxWidth:"sm",fullWidth:!0,children:[a.jsx(H,{children:"New Place"}),a.jsxs(_,{children:[a.jsx(p,{fullWidth:!0,label:"Ward ID",name:"wardId",value:n.wardId,onChange:d,margin:"normal"}),a.jsx(p,{fullWidth:!0,label:"Time Open",name:"timeOpen",type:"time",value:n.timeOpen,onChange:d,margin:"normal",inputProps:{step:300}}),a.jsx(p,{fullWidth:!0,label:"Time Close",name:"timeClose",type:"time",value:n.timeClose,onChange:d,margin:"normal",inputProps:{step:300}}),a.jsx(p,{fullWidth:!0,label:"Longitude",name:"longitude",value:n.longitude,onChange:d,margin:"normal"}),a.jsx(p,{fullWidth:!0,label:"Latitude",name:"latitude",value:n.latitude,onChange:d,margin:"normal"}),a.jsx(p,{fullWidth:!0,label:"Contact Link",name:"contactLink",value:n.contactLink,onChange:d,margin:"normal"}),a.jsx(Q,{multiple:!0,id:"tags",options:b,getOptionLabel:t=>t.tagName,onChange:S,renderInput:t=>a.jsx(p,{...t,label:"Tags"})}),a.jsxs("div",{style:{marginTop:"20px"},children:[a.jsx("div",{style:{fontWeight:"bold"},children:"Photo Display"}),a.jsx("input",{type:"file",accept:"image/*",id:"photoDisplay",onChange:C})]}),a.jsxs("div",{style:{marginTop:"20px"},children:[a.jsx(T,{variant:"outlined",onClick:h,children:"Add Place Media"}),n.placeMedia.map((t,e)=>a.jsxs(v,{container:!0,spacing:2,alignItems:"center",style:{marginTop:"10px"},children:[a.jsxs(v,{item:!0,children:[a.jsxs("label",{htmlFor:`placeMedia-${e}`,children:["Media ",e+1]}),a.jsx("input",{type:"file",accept:"image/*",id:`placeMedia-${e}`,onChange:s=>x(s,e)})]}),a.jsx(v,{item:!0,children:a.jsx(T,{variant:"contained",color:"error",onClick:()=>j(e),children:"Remove"})})]},e))]}),a.jsxs("div",{style:{marginTop:"20px"},children:[a.jsx(T,{variant:"outlined",onClick:P,children:"Add Place Translation"}),n.placeTranslations.map((t,e)=>a.jsxs("div",{style:{marginTop:"15px"},children:[a.jsx(p,{fullWidth:!0,label:`Language Code ${e+1}`,name:"languageCode",value:t.languageCode,onChange:s=>d(s,e),margin:"normal"}),a.jsx(p,{fullWidth:!0,label:`Name ${e+1}`,name:"name",value:t.name,onChange:s=>d(s,e),margin:"normal"}),a.jsx(p,{fullWidth:!0,label:`Description ${e+1}`,name:"description",value:t.description,onChange:s=>d(s,e),margin:"normal"}),a.jsx(p,{fullWidth:!0,label:`Address ${e+1}`,name:"address",value:t.address,onChange:s=>d(s,e),margin:"normal"}),a.jsx(p,{fullWidth:!0,label:`Contact ${e+1}`,name:"contact",value:t.contact,onChange:s=>d(s,e),margin:"normal"}),a.jsx(T,{variant:"outlined",color:"error",onClick:()=>y(e),style:{marginTop:"10px"},children:"Remove Translation"})]},e))]})]}),a.jsxs(J,{children:[a.jsx(T,{onClick:u,color:"secondary",children:"Cancel"}),a.jsx(T,{onClick:c,color:"primary",children:"Submit"})]})]})}const ee=async(m=1,u=5,f="vi")=>{const n=localStorage.getItem("accessToken");if(console.log("Access Token:",n),!n)return console.error("No access token found"),{items:[],totalCount:0};try{const o=await k.get(`https://api.localtour.space/api/Place/getAllByRole?LanguageCode=${f}&Page=${m}&Size=${u}`,{headers:{Authorization:`Bearer ${n}`}});return console.log("API Response:",o.data),{items:o.data.items,totalCount:o.data.totalCount}}catch(o){return console.error("Error fetching places",o),{items:[],totalCount:0}}};function ae(){const[m,u]=i.useState([]),[f,n]=i.useState(0),[o,b]=i.useState(""),[g,d]=i.useState("vi"),[C,x]=i.useState(!1),[P,y]=i.useState(1),[h,j]=i.useState(5);i.useEffect(()=>{(async()=>{const{items:r,totalCount:l}=await ee(P,h,g);u(r),n(l)})()},[P,h,g]);const S=s=>{const r={...s,status:s.status??"0",isVerified:s.isVerified??!1};u(l=>[...l,r]),n(l=>l+1)},c=te(),t=F({inputData:m,comparator:L(c.order,c.orderBy),filterName:o}),e=!t.length&&!!o;return a.jsxs(M,{children:[a.jsxs(R,{display:"flex",alignItems:"center",mb:5,children:[a.jsx(I,{variant:"h4",flexGrow:1,children:"Places"}),a.jsx(T,{variant:"contained",color:"inherit",startIcon:a.jsx(A,{icon:"mingcute:add-line"}),onClick:()=>x(!0),children:"New place"})]}),a.jsxs(q,{children:[a.jsx(O,{numSelected:c.selected.length,filterName:o,onFilterName:s=>{b(s.target.value),c.onResetPage()}}),a.jsx(D,{children:a.jsx(K,{sx:{overflow:"unset"},children:a.jsxs(U,{sx:{minWidth:800},children:[a.jsx($,{order:c.order,orderBy:c.orderBy,rowCount:m.length,numSelected:c.selected.length,onSort:c.onSort,onSelectAllRows:s=>c.onSelectAllRows(s,m.map(r=>r.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),a.jsxs(X,{children:[t.slice(c.page*h,c.page*h+h).map(s=>a.jsx(B,{row:s,selected:c.selected.includes(s.id),onSelectRow:()=>c.onSelectRow(s.id)},s.id)),a.jsx(E,{height:68,emptyRows:V(c.page,c.rowsPerPage,m.length)}),e&&a.jsx(G,{searchQuery:o})]})]})})}),a.jsx(Y,{component:"div",page:P-1,count:f,rowsPerPage:h,onPageChange:(s,r)=>y(r+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s=>{j(parseInt(s.target.value,10)),y(1)}})]}),a.jsx(Z,{open:C,onClose:()=>x(!1),onPlaceCreated:S})]})}function te(){const[m,u]=i.useState(0),[f,n]=i.useState("name"),[o,b]=i.useState(5),[g,d]=i.useState([]),[C,x]=i.useState("asc"),P=i.useCallback(t=>{x(f===t&&C==="asc"?"desc":"asc"),n(t)},[C,f]),y=i.useCallback((t,e)=>{if(t){d(e);return}d([])},[]),h=i.useCallback(t=>{const e=g.includes(t)?g.filter(s=>s!==t):[...g,t];d(e)},[g]),j=i.useCallback(()=>{u(0)},[]),S=i.useCallback((t,e)=>{u(e)},[]),c=i.useCallback(t=>{b(parseInt(t.target.value,10)),j()},[j]);return{page:m,order:C,onSort:P,orderBy:f,selected:g,rowsPerPage:o,onSelectRow:h,onResetPage:j,onChangePage:S,onSelectAllRows:y,onChangeRowsPerPage:c}}function fe(){return a.jsxs(a.Fragment,{children:[a.jsx(N,{children:a.jsxs("title",{children:[" ",`Places Created - ${W.appName}`]})}),a.jsx(ae,{})]})}export{fe as default};
