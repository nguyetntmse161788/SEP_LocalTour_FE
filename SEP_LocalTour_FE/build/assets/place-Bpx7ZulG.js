import{r as a,w as U,j as e,B as F,A as H,I as y,x as M,y as N,p as z,M as V,q as E,h as B,D as G,T as q,C as Q,H as W}from"./index-Cc_uhaw2.js";import{C as J}from"./config-global-DYC5wpSI.js";import{a as $}from"./axiosInstance-DxRYDP1x.js";import{U as K,a as X,g as Y,P as Z,b as _,T as ee,e as te,c as ae}from"./place-table-toolbar-BZd-6ml3.js";import{c as se,d as f,T as oe,a as ne,e as le}from"./TableRow-D6UDr9Xq.js";import{C as re}from"./Checkbox-vnf7N2Ff.js";import{D as ce,a as ie,b as de,c as pe}from"./DialogTitle-DsJ-pNoJ.js";import{C as ue}from"./Card-aOnlRS-j.js";import{b as he}from"./TableSortLabel-B-9zB2P1.js";import"./Autocomplete-CE2ucrPx.js";import"./Select-DNzxC7qm.js";import"./useFormControl-La3rWkRi.js";import"./Popper-CNsN0Zo1.js";import"./usePreviousProps-B5FCVLHW.js";import"./TextField-D9kvPmME.js";import"./InputLabel-CpWSz3oH.js";import"./Grid-CLWcti-q.js";import"./InputAdornment-CxX4agxn.js";import"./LastPage-CV_-hBrB.js";function ge({row:t,selected:u,onSelectRow:h,onDeletePlace:j,onUpdatePlace:c}){var R,v,A,I;const[g,n]=a.useState(null),[C,d]=a.useState(!1),[m,i]=a.useState(!1),[S,P]=a.useState(""),r=U(),[o,T]=a.useState([]),D=a.useCallback(l=>{l.stopPropagation(),n(l.currentTarget)},[]),b=a.useCallback(()=>{n(null)},[]),k=l=>{l.stopPropagation(),r(`/owner/place/${t.id}`)},s=l=>{P(l),i(!0),b()},p=l=>{l.target instanceof HTMLButtonElement||l.target instanceof HTMLInputElement||r(`/owner/place/${t.id}`)},x=async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{await $.delete(`https://api.localtour.space/api/Place/delete?placeid=${t.id}`,{headers:{Authorization:`Bearer ${l}`}}),j(t.id)}catch(L){console.error("Error deleting place:",L)}d(!1)},w=()=>{d(!1)},O=l=>{c(l),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(se,{hover:!0,tabIndex:-1,role:"checkbox",selected:u,onClick:p,children:[e.jsx(f,{padding:"checkbox",children:e.jsx(re,{disableRipple:!0,checked:u,onChange:h})}),e.jsx(f,{component:"th",scope:"row",children:e.jsxs(F,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(H,{alt:((R=t.placeTranslation[0])==null?void 0:R.name)||"N/A",src:t.photoDisplay}),((v=t.placeTranslation[0])==null?void 0:v.name)||"N/A"]})}),e.jsx(f,{children:((A=t.placeTranslation[0])==null?void 0:A.address)||"N/A"}),e.jsx(f,{children:((I=t.placeTranslation[0])==null?void 0:I.description)||"N/A"}),e.jsx(f,{align:"center",children:t.status==="Pending"?"-":e.jsx(y,{width:22,icon:"solar:check-circle-bold",sx:{color:"success.main"}})}),e.jsx(f,{children:e.jsx(M,{color:t.status==="Pending"?"warning":t.status==="Approved"?"success":t.status==="Rejected"?"error":"default",children:t.status})}),e.jsx(f,{align:"right",children:e.jsx(N,{onClick:k,children:e.jsx(y,{icon:"eva:arrow-forward-outline",width:22})})}),e.jsx(f,{align:"right",children:e.jsx(N,{onClick:D,children:e.jsx(y,{icon:"eva:more-vertical-fill",width:22})})})]}),e.jsx(z,{open:!!g,anchorEl:g,onClose:b,children:e.jsxs(V,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column"},children:[e.jsxs(E,{onClick:()=>{s(t.id),b()},children:[e.jsx(y,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(E,{onClick:()=>{d(!0),b()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsxs(ce,{open:C,onClose:w,children:[e.jsx(ie,{children:"Confirm Deletion"}),e.jsx(de,{children:"Are you sure you want to delete this place?"}),e.jsxs(pe,{children:[e.jsx(B,{onClick:w,color:"primary",children:"Cancel"}),e.jsx(B,{onClick:x,color:"error",children:"Delete"})]})]}),e.jsx(K,{open:m,placeId:S,onClose:()=>i(!1),onPlaceUpdated:O})]})}const me=async(t=1,u=5,h="vi",j="",c="")=>{const g=localStorage.getItem("accessToken");if(console.log("Access Token:",g),!g)return console.error("No access token found"),{items:[],totalCount:0};try{const n=await $.get(`https://api.localtour.space/api/Place/getAll?LanguageCode=${h}&Page=${t}&Size=${u}&SearchTerm=${encodeURIComponent(j)}&Status=${c}`,{headers:{Authorization:`Bearer ${g}`}});return console.log("API Response:",n.data),{items:n.data.items,totalCount:n.data.totalCount}}catch(n){return console.error("Error fetching places",n),{items:[],totalCount:0}}};function xe(){const[t,u]=a.useState([]),[h,j]=a.useState(0),[c,g]=a.useState(""),[n,C]=a.useState("vi"),[d,m]=a.useState(1),[i,S]=a.useState(5),[P,r]=a.useState("");a.useEffect(()=>{(async()=>{const{items:p,totalCount:x}=await me(d,i,n,c,P);u(p),j(x)})()},[d,i,n,c,P]);const o=fe(),T=X({inputData:t,comparator:Y(o.order,o.orderBy),filterName:c,filterStatus:P}),D=s=>{u(p=>p.filter(x=>x.id!==s))},b=s=>{u(p=>p.map(x=>x.id===s.id?s:x))},k=!T.length&&!!c;return e.jsxs(G,{children:[e.jsx(F,{display:"flex",alignItems:"center",mb:5,children:e.jsx(q,{variant:"h4",flexGrow:1,children:"Places"})}),e.jsxs(ue,{children:[e.jsx(Z,{numSelected:o.selected.length,filterName:c,onFilterName:s=>{g(s.target.value),m(1)},onFilterStatus:s=>{r(s||""),m(1)}}),e.jsx(Q,{children:e.jsx(oe,{sx:{overflow:"unset"},children:e.jsxs(ne,{sx:{minWidth:800},children:[e.jsx(_,{order:o.order,orderBy:o.orderBy,rowCount:t.length,numSelected:o.selected.length,onSort:o.onSort,onSelectAllRows:s=>o.onSelectAllRows(s,t.map(p=>p.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),e.jsxs(le,{children:[T.slice(o.page*i,o.page*i+i).map(s=>e.jsx(ge,{row:s,selected:o.selected.includes(s.id),onSelectRow:()=>o.onSelectRow(s.id),onDeletePlace:D,onUpdatePlace:b},s.id)),e.jsx(ee,{height:68,emptyRows:te(o.page,o.rowsPerPage,t.length)}),k&&e.jsx(ae,{searchQuery:c})]})]})})}),e.jsx(he,{component:"div",page:d-1,count:h,rowsPerPage:i,onPageChange:(s,p)=>m(p+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s=>{S(parseInt(s.target.value,10)),m(1)}})]})]})}function fe(){const[t,u]=a.useState(0),[h,j]=a.useState("name"),[c,g]=a.useState(5),[n,C]=a.useState([]),[d,m]=a.useState("asc"),i=a.useCallback(r=>{m(h===r&&d==="asc"?"desc":"asc"),j(r)},[d,h]),S=a.useCallback((r,o)=>{if(r){C(o);return}C([])},[]),P=a.useCallback(r=>{const o=n.includes(r)?n.filter(T=>T!==r):[...n,r];C(o)},[n]);return{order:d,orderBy:h,rowsPerPage:c,selected:n,page:t,onSort:i,onSelectAllRows:S,onSelectRow:P,onResetPage:()=>u(0)}}function Oe(){return e.jsxs(e.Fragment,{children:[e.jsx(W,{children:e.jsxs("title",{children:[" ",`Places - ${J.appName}`]})}),e.jsx(xe,{})]})}export{Oe as default};
