import{aV as b,K as F,r as i,j as e,B as m,C as P,T as a,h as g,p as x,aG as $,z as c,H as N}from"./index-JURld8WI.js";import{C as U}from"./config-global-BwHnWRtc.js";import{C as k}from"./CardContent-C8me-a83.js";import{F as T,I as z}from"./InputLabel-CrY5KikR.js";function E(){const R=b(),d=F(),{user:u,userId:o,username:p,roles:j}=R.state||{},[h,C]=i.useState(j||""),[f,r]=i.useState(""),[y,v]=i.useState(""),[l,B]=i.useState(j||[]),n=localStorage.getItem("accessToken");i.useEffect(()=>{u||r("No user data found!")},[u]);const w=t=>{C(t.target.value)},S=async t=>{if(!n){r("Authentication required. Please log in again.");return}try{const s=`https://api.localtour.space/api/User/removeRole?userId=${o}&role=${t}`;(await x.post(s,{},{headers:{Authorization:`Bearer ${n}`}})).status===200?(await A(),v(`Role "${t}" removed successfully.`),setTimeout(()=>{d("/admin/user")},500)):r("Failed to remove role. Please try again.")}catch{r("Failed to remove role. Please try again.")}},A=async()=>{try{const t=`https://api.localtour.space/api/User/getRoles?userId=${o}`,s=await x.get(t,{headers:{Authorization:`Bearer ${n}`}});s.status===200?B(s.data.roles):r("Failed to fetch updated roles. Please try again.")}catch{r("Failed to fetch updated roles. Please try again.")}},I=async()=>{if(!n){r("Authentication required. Please log in again.");return}try{const t=`https://api.localtour.space/api/User/addRole?userId=${o}&role=${h}`;(await x.post(t,{userId:o,username:p,role:h},{headers:{Authorization:`Bearer ${n}`}})).status===200&&(v("Role updated successfully!"),setTimeout(()=>{d("/admin/user")},500))}catch{r("Failed to update role. Please try again.")}};return e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"70vh",bgcolor:"#f9f9f9",sx:{maxWidth:"90vw",padding:2},children:e.jsx(P,{sx:{width:400,padding:3},children:e.jsxs(k,{children:[e.jsx(a,{variant:"h5",align:"center",marginBottom:2,children:"User Role Page"}),f&&e.jsx(a,{color:"error",variant:"body2",align:"center",marginBottom:2,children:f}),y&&e.jsx(a,{color:"success.main",variant:"body2",align:"center",marginBottom:2,children:y}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body1",marginBottom:1,children:[e.jsx("strong",{children:"ID:"})," ",o]}),e.jsxs(a,{variant:"body1",marginBottom:1,children:[e.jsx("strong",{children:"User Name:"})," ",p]}),e.jsx(a,{variant:"body1",marginBottom:1,children:e.jsx("strong",{children:"Current Role:"})}),l&&Array.isArray(l)&&l.length>0?e.jsx("ul",{children:l.map((t,s)=>e.jsxs("li",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[t,e.jsx(g,{variant:"outlined",color:"error",size:"small",onClick:()=>S(t),children:"Remove"})]},s))}):e.jsx(a,{variant:"body2",color:"textSecondary",children:"No roles found."}),e.jsxs(T,{fullWidth:!0,margin:"normal",children:[e.jsx(z,{children:"New Role"}),e.jsxs($,{value:h,onChange:w,label:"New Role",children:[e.jsx(c,{value:"Moderator",children:"Moderator"}),e.jsx(c,{value:"Administrator",children:"Administrator"}),e.jsx(c,{value:"Visitor",children:"Visitor"}),e.jsx(c,{value:"Service Owner",children:"Service Owner"})]})]}),e.jsx(m,{textAlign:"center",marginTop:2,children:e.jsx(g,{variant:"contained",color:"primary",onClick:I,sx:{width:"100%"},children:"Save Role"})})]}),e.jsx(m,{textAlign:"center",marginTop:2,children:e.jsx(g,{variant:"text",onClick:()=>d("/admin/user"),sx:{width:"100%"},children:"Back to List"})})]})})})}function q(){return e.jsxs(e.Fragment,{children:[e.jsx(N,{children:e.jsxs("title",{children:[" ",`Blog - ${U.appName}`]})}),e.jsx(E,{})]})}export{q as default};
