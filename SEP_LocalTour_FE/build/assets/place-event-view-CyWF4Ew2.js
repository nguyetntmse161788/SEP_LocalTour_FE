import{r as i,j as e,k as m,$ as Y,l as K,av as q,K as J,y as A,B as j,f as c,I as $,H as Q}from"./index-BCEoXUgR.js";import{C as X}from"./config-global-BwHnWRtc.js";import{a as T}from"./index-Br0q4W-C.js";import{D as z,a as O,b as R,c as W}from"./DialogTitle-DLFL-6md.js";import{T as C}from"./TextField-DWe7D0BL.js";import{C as Z}from"./CircularProgress-DD5OR9sX.js";import{G as g}from"./Grid-ClQYLn49.js";import{C as B}from"./Card-CnlOfLcQ.js";import"./Select-BESDqWty.js";import"./InputLabel-b21gl_J5.js";function _({open:d,onClose:a,onEventCreated:v,placeId:I}){const[y,P]=i.useState(""),[t,p]=i.useState(""),[b,S]=i.useState(""),[D,E]=i.useState(""),[f,k]=i.useState(null),o=s=>{s.target.files&&s.target.files.length>0&&k(s.target.files[0])},n=async()=>{const s=localStorage.getItem("accessToken");if(!s){console.error("No access token found");return}const F=new Date(b).toISOString(),w=new Date(D).toISOString(),u=new FormData;u.append("placeid",I),u.append("eventName",y),u.append("description",t),u.append("startDate",F),u.append("endDate",w),f&&u.append("eventPhoto",f),console.log("Data being sent to API:",u);try{const N=await T.post("https://api.localtour.space/api/Event/create",u,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});console.log("Event created response:",N.data),v(N.data),a(),h()}catch(N){console.error("Error creating event",N)}},h=()=>{P(""),p(""),S(""),E(""),k(null)};return e.jsxs(z,{open:d,onClose:a,children:[e.jsx(O,{children:"Create Event"}),e.jsxs(R,{children:[e.jsx(C,{label:"Event Name",fullWidth:!0,value:y,onChange:s=>P(s.target.value),margin:"normal"}),e.jsx(C,{label:"Description",fullWidth:!0,value:t,onChange:s=>p(s.target.value),margin:"normal"}),e.jsx(C,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:b,onChange:s=>S(s.target.value),margin:"normal"}),e.jsx(C,{label:"End Date",type:"datetime-local",fullWidth:!0,value:D,onChange:s=>E(s.target.value),margin:"normal"}),e.jsx("input",{id:"event-photo",type:"file",accept:"image/*",onChange:o,style:{marginTop:"1rem"}})]}),e.jsxs(W,{children:[e.jsx(m,{onClick:a,color:"primary",children:"Cancel"}),e.jsx(m,{onClick:n,color:"primary",children:"Create"})]})]})}const ee=Y(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");function te({open:d,onClose:a,initialData:v,onEventUpdated:I,placeId:y,eventId:P}){const[t,p]=i.useState({eventName:"",startDate:"",endDate:"",description:"",eventPhotoDisplay:"",eventPhotoFile:null}),[b,S]=i.useState(!1);i.useEffect(()=>{v&&p({...v,startDate:D(v.startDate),endDate:D(v.endDate)})},[v]);const D=o=>{if(!o)return"";const n=new Date(o),h=n.getFullYear(),s=(n.getMonth()+1).toString().padStart(2,"0"),F=n.getDate().toString().padStart(2,"0"),w=n.getHours().toString().padStart(2,"0"),u=n.getMinutes().toString().padStart(2,"0");return`${h}-${s}-${F}T${w}:${u}`},E=()=>{p({...t,eventPhotoDisplay:"",eventPhotoFile:null}),S(!0)},f=o=>{if(o.target.files&&o.target.files[0]){const n=o.target.files[0],h=URL.createObjectURL(n);p({...t,eventPhotoDisplay:h,eventPhotoFile:n}),S(!1)}},k=async()=>{const o=localStorage.getItem("accessToken");if(!o){console.error("No access token found");return}const n=new FormData;n.append("placeid",y),n.append("eventid",P),n.append("EventName",t.eventName),n.append("Description",t.description),n.append("StartDate",t.startDate),n.append("EndDate",t.endDate),t.eventPhotoFile&&n.append("EventPhoto",t.eventPhotoFile);try{const h=await T.put("https://api.localtour.space/api/Event/update",n,{headers:{accept:"text/plain","Content-Type":"multipart/form-data",Authorization:`Bearer ${o}`}});I(h.data.data),a()}catch(h){console.error("Error submitting event data:",h)}};return e.jsxs(z,{open:d,onClose:a,children:[e.jsx(O,{children:"Edit Event"}),e.jsxs(R,{children:[e.jsx(C,{label:"Event Name",value:t.eventName,onChange:o=>p({...t,eventName:o.target.value}),fullWidth:!0,margin:"normal"}),e.jsx(C,{label:"Start Date & Time",type:"datetime-local",value:t.startDate,onChange:o=>p({...t,startDate:o.target.value}),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(C,{label:"End Date & Time",type:"datetime-local",value:t.endDate,onChange:o=>p({...t,endDate:o.target.value}),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(C,{label:"Description",value:t.description,onChange:o=>p({...t,description:o.target.value}),fullWidth:!0,margin:"normal",multiline:!0,rows:4}),t.eventPhotoDisplay&&!b?e.jsxs("div",{style:{position:"relative",margin:"10px 0"},children:[e.jsx("img",{src:t.eventPhotoDisplay,alt:"Event",style:{width:"150px",height:"auto",borderRadius:"8px"}}),e.jsx(K,{style:{position:"absolute",top:"-5px",right:"-5px",backgroundColor:"white",padding:"3px",zIndex:1},onClick:E,children:e.jsx(ee,{})})]}):e.jsx("input",{type:"file",accept:"image/*",onChange:f,style:{margin:"10px 0"}})]}),e.jsxs(W,{children:[e.jsx(m,{onClick:a,children:"Cancel"}),e.jsx(m,{onClick:k,color:"primary",children:"Save Changes"})]})]})}function ae(){var U,H,G,M;const{id:d}=q(),[a,v]=i.useState(null),[I,y]=i.useState([]),[P,t]=i.useState(!0),[p,b]=i.useState(!1),S=J(),[D,E]=i.useState(!1),[f,k]=i.useState(null),[o,n]=i.useState(!1),[h,s]=i.useState(null),F=async r=>{await w()};i.useEffect(()=>{(async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{const x=await T.get(`https://api.localtour.space/api/Place/getPlaceById?languageCode=vi&placeid=${d}`,{headers:{Authorization:`Bearer ${l}`}});v(x.data),t(!1)}catch(x){console.error("Error fetching place details",x),t(!1)}})()},[d]),i.useEffect(()=>{d&&(async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{const x=await T.get(`https://api.localtour.space/api/Event/getall?placeid=${d}&languageCode=vi`,{headers:{Authorization:`Bearer ${l}`}});console.log("Place events data:",x.data.items),y(x.data.items)}catch(x){console.error("Error fetching place events",x)}})()},[d]);const w=async()=>{const r=localStorage.getItem("accessToken");if(!r){console.error("No access token found");return}try{const l=await T.get(`https://api.localtour.space/api/Event/getall?placeid=${d}&languageCode=vi`,{headers:{Authorization:`Bearer ${r}`}});console.log("Updated place events data:",l.data.items),y(l.data.items)}catch(l){console.error("Error fetching place events",l)}},u=async r=>{await w(),E(!1)},N=async()=>{if(!h)return;const r=localStorage.getItem("accessToken");if(!r){console.error("No access token found");return}try{await T.delete(`https://api.localtour.space/api/Event/delete?placeid=${d}&eventid=${h.id}`,{headers:{Authorization:`Bearer ${r}`}}),y(l=>l.filter(x=>x.id!==h.id)),n(!1)}catch(l){console.error("Error deleting event",l)}},V=r=>{s(r),n(!0)},L=()=>{n(!1),s(null)};return P?e.jsx(A,{children:e.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(Z,{})})}):a?(a.status,a.status,a.status,e.jsxs(A,{children:[e.jsxs(j,{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(m,{variant:"outlined",color:"primary",startIcon:e.jsx($,{icon:"eva:arrow-back-fill"}),onClick:()=>S("/owner/event"),children:"Back to List"}),e.jsx(c,{variant:"h4",children:"Place Detail"}),e.jsx(m,{variant:"contained",color:"secondary",startIcon:e.jsx($,{icon:"mingcute:edit-line"}),children:"Edit"})]}),e.jsxs(g,{container:!0,spacing:3,children:[e.jsx(g,{item:!0,xs:12,md:4,children:e.jsx(B,{sx:{p:2,boxShadow:3},children:e.jsx(j,{mb:2,display:"flex",justifyContent:"center",children:e.jsx("img",{src:a.photoDisplay,alt:(U=a.placeTranslations[0])==null?void 0:U.name,style:{width:"100%",height:"auto",maxHeight:"400px",objectFit:"cover"}})})})}),e.jsx(g,{item:!0,xs:12,md:8,children:e.jsxs(B,{sx:{p:3,boxShadow:3},children:[e.jsx(c,{variant:"h5",mb:2,children:(H=a.placeTranslations[0])==null?void 0:H.name}),e.jsxs(c,{variant:"body1",mb:2,children:["Address: ",(G=a.placeTranslations[0])==null?void 0:G.address]}),e.jsxs(c,{variant:"body1",mb:2,children:["Description: ",(M=a.placeTranslations[0])==null?void 0:M.description]}),e.jsxs(g,{container:!0,spacing:2,children:[e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Opening Time: ",a.timeOpen]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Closing Time: ",a.timeClose]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Longitude: ",a.longitude]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Latitude: ",a.latitude]})}),e.jsx(g,{item:!0,xs:6,children:e.jsxs(c,{variant:"h6",children:["Status: ",a.status==="Approved"?"Approved":a.status==="Rejected"?"Rejected":"Pending"]})})]})]})})]}),e.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(c,{variant:"h5",children:"Place Events"}),e.jsx(m,{variant:"contained",color:"primary",startIcon:e.jsx($,{icon:"mingcute:add-line"}),onClick:()=>b(!0),children:"Create Event"})]}),I.length>0?e.jsx(j,{mt:4,children:e.jsx(g,{container:!0,spacing:3,children:I.map(r=>{var l;return e.jsx(g,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(B,{sx:{p:2,boxShadow:2,borderRadius:2,height:"100%"},children:[e.jsx(j,{position:"relative",mb:2,children:r.eventPhotoDisplay?e.jsx("img",{src:r.eventPhotoDisplay,alt:r.eventName||"Event",style:{width:"100%",height:"200px",borderRadius:"8px",objectFit:"cover"}}):e.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",sx:{width:"100%",height:"200px",borderRadius:"8px",backgroundColor:"#f0f0f0",fontSize:"3rem",fontWeight:"bold",color:"#888"},children:(l=r.eventName)==null?void 0:l.charAt(0)})}),e.jsx(c,{variant:"h6",fontWeight:"bold",textAlign:"center",mb:1,children:r.eventName}),e.jsxs(c,{variant:"body2",color:"text.secondary",mb:1,children:["Start Date: ",r.startDate]}),e.jsxs(c,{variant:"body2",color:"text.secondary",mb:1,children:["End Date: ",r.endDate]}),e.jsxs(j,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(m,{variant:"outlined",size:"small",color:"primary",children:"View"}),e.jsx(m,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx($,{icon:"eva:edit-outline"}),onClick:()=>{k(r),E(!0),console.log(r)},children:"Edit"}),e.jsx(m,{variant:"outlined",color:"error",onClick:()=>V(r),children:e.jsx($,{icon:"eva:trash-2-outline"})})]})]})},r.id)})})}):e.jsx(c,{variant:"body1",color:"text.secondary",mt:3,children:"No events found for this place."}),e.jsxs(z,{open:o,onClose:L,children:[e.jsx(O,{children:"Are you sure you want to delete this item?"}),e.jsx(R,{children:e.jsx(c,{variant:"body2",children:"This action cannot be undone."})}),e.jsxs(W,{children:[e.jsx(m,{onClick:L,color:"primary",children:"No"}),e.jsx(m,{onClick:N,color:"error",children:"Yes, Delete"})]})]}),D&&e.jsx(te,{open:D,onClose:()=>E(!1),initialData:f,onEventUpdated:u,placeId:d||"",eventId:(f==null?void 0:f.id)||""}),e.jsx(_,{open:p,onClose:()=>b(!1),onEventCreated:F,placeId:d||""})]})):e.jsx(A,{children:e.jsx(j,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(c,{variant:"h5",children:"Place not found"})})})}function ue(){return e.jsxs(e.Fragment,{children:[e.jsx(Q,{children:e.jsxs("title",{children:[" ",`Place Details - ${X.appName}`]})}),e.jsx(ae,{})]})}export{ue as default};
