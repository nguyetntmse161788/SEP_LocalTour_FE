import{r as l,O,j as e,m as k,n as x,a0 as N,B as b,A as L,a1 as z,h as T,E as D,l as B,a2 as H,Q as $,T as P,R as W,K as M,I as y,V as w,U as G,D as Q,C as K,Y as U,i as Y,k as q,o as J,$ as V,H as X}from"./index-z39hXFLl.js";import{C as Z}from"./config-global-BwHnWRtc.js";import{a as I}from"./axiosInstance-Xq098mIU.js";function _({row:t,selected:a,onSelectRow:n,onUpdateStatus:o}){const[s,u]=l.useState(null),h=O();l.useCallback(g=>{g.stopPropagation(),u(g.currentTarget)},[]);const i=l.useCallback(()=>{u(null)},[]),m=g=>{g.target instanceof HTMLButtonElement||g.target instanceof HTMLInputElement||h(`/event/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsxs(k,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,onClick:m,children:[e.jsx(x,{padding:"checkbox",children:e.jsx(N,{disableRipple:!0,checked:a,onChange:n})}),e.jsx(x,{component:"th",scope:"row",children:e.jsxs(b,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(L,{alt:t.eventName||"N/A",src:`/static/mock-images/events/event-${t.id}.jpg`}),t.eventName||"N/A"]})}),e.jsx(x,{children:t.description||"N/A"}),e.jsx(x,{children:t.placeName||"N/A"}),e.jsxs(x,{children:[new Date(t.startDate).toLocaleDateString()," -"," ",new Date(t.endDate).toLocaleDateString()]}),e.jsx(x,{align:"center",children:e.jsx(z,{color:t.eventStatus==="Pending"?"warning":t.eventStatus==="Approved"?"success":t.eventStatus==="Rejected"?"error":"default",children:t.eventStatus})}),e.jsx(x,{align:"center",children:e.jsxs(b,{display:"flex",gap:1,justifyContent:"center",children:[e.jsx(T,{variant:"contained",color:"success",size:"small",disabled:t.eventStatus==="Approved",onClick:()=>o("Approved"),children:"Approve"}),e.jsx(T,{variant:"contained",color:"error",size:"small",disabled:t.eventStatus==="Rejected",onClick:()=>o("Rejected"),children:"Reject"})]})})]}),e.jsx(D,{open:!!s,anchorEl:s,onClose:i,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"}})]})}const ee={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function te(t,a,n){return t?Math.max(0,(1+t)*a-n):0}function E(t,a,n){return a[n]<t[n]?-1:a[n]>t[n]?1:0}function ne(t,a){return t==="desc"?(n,o)=>E(n,o,a):(n,o)=>-E(n,o,a)}function ae({inputData:t,comparator:a,filterName:n,filterStatus:o}){let s=[...t];return n&&(s=s.filter(u=>u.eventName.toLowerCase().includes(n.toLowerCase()))),o&&(s=s.filter(u=>u.eventStatus===o)),s.sort(a),s}function se({order:t,onSort:a,orderBy:n,rowCount:o,headLabel:s,numSelected:u,onSelectAllRows:h}){return e.jsx(B,{children:e.jsxs(k,{children:[e.jsx(x,{padding:"checkbox",children:e.jsx(N,{indeterminate:u>0&&u<o,checked:o>0&&u===o,onChange:i=>h(i.target.checked)})}),s.map(i=>e.jsx(x,{align:i.align||"left",sortDirection:n===i.id?t:!1,sx:{width:i.width,minWidth:i.minWidth},children:e.jsxs(H,{hideSortIcon:!0,active:n===i.id,direction:n===i.id?t:"asc",onClick:()=>a(i.id),children:[i.label,n===i.id?e.jsx(b,{sx:{...ee},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},i.id))]})})}function oe({numSelected:t,filterName:a,onFilterName:n,onFilterStatus:o}){const[s,u]=l.useState(null),[h,i]=l.useState(null),m=c=>{i(c),o(c),u(null)},g=c=>{u(c.currentTarget)},v=()=>{u(null)},f=!!s;return e.jsxs($,{sx:{height:96,display:"flex",justifyContent:"space-between",p:c=>c.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(P,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(W,{fullWidth:!0,value:a,onChange:n,placeholder:"Search event...",startAdornment:e.jsx(M,{position:"start",children:e.jsx(y,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),t>0?e.jsx(w,{children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(G,{title:"Filter list",children:e.jsx(w,{onClick:g,children:e.jsx(y,{icon:"ic:round-filter-list"})})}),e.jsx(D,{open:f,anchorEl:s,onClose:v,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(b,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(c=>e.jsx(T,{variant:h===(c==="All"?null:c)?"contained":"outlined",onClick:()=>m(c==="All"?null:c),sx:{color:h===(c==="All"?null:c)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:c},c))})})]})]})}function re({emptyRows:t,height:a,sx:n,...o}){return t?e.jsx(k,{sx:{...a&&{height:a*t},...n},...o,children:e.jsx(x,{colSpan:9})}):null}function le({searchQuery:t,...a}){return e.jsx(k,{...a,children:e.jsx(x,{align:"center",colSpan:7,children:e.jsxs(b,{sx:{py:15,textAlign:"center"},children:[e.jsx(P,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(P,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const ie=async(t=1,a=5,n="vi")=>{const o=localStorage.getItem("accessToken");if(console.log("Access Token:",o),!o)return console.error("No access token found"),{items:[],totalCount:0};try{const s=await I.get("https://api.localtour.space/api/Event/getallevent",{headers:{Authorization:`Bearer ${o}`},params:{LanguageCode:n,Page:t,Size:a}});return console.log("API Response:",s.data),{items:s.data.items,totalCount:s.data.totalCount}}catch(s){return console.error("Error fetching events",s),{items:[],totalCount:0}}},ce=async(t,a,n)=>{const o=localStorage.getItem("accessToken");if(!o)return console.error("No access token found"),null;try{return(await I.put("https://api.localtour.space/api/Event/changeStatusEvent",null,{headers:{Authorization:`Bearer ${o}`},params:{placeid:t,eventid:a,status:n}})).data}catch(s){return console.error("Error updating event status:",s),null}};function de(){const[t,a]=l.useState([]),[n,o]=l.useState(0),[s,u]=l.useState(""),[h,i]=l.useState("vi"),[m,g]=l.useState(null),[v,f]=l.useState(1),[c,S]=l.useState(5);l.useEffect(()=>{(async()=>{const{items:j,totalCount:R}=await ie(v,c,h);a(j),o(R)})()},[v,c,h,n]);const d=ue(),C=ae({inputData:t,comparator:ne(d.order,d.orderBy),filterName:s,filterStatus:m}),p=!C.length&&!!s;return e.jsxs(Q,{children:[e.jsx(b,{display:"flex",alignItems:"center",mb:5,children:e.jsx(P,{variant:"h4",flexGrow:1,children:"Events"})}),e.jsxs(K,{children:[e.jsx(oe,{numSelected:d.selected.length,filterName:s,onFilterName:r=>{u(r.target.value),d.onResetPage()},onFilterStatus:r=>g(r)}),e.jsx(U,{children:e.jsx(Y,{sx:{overflow:"unset"},children:e.jsxs(q,{sx:{minWidth:800},children:[e.jsx(se,{order:d.order,orderBy:d.orderBy,rowCount:t.length,numSelected:d.selected.length,onSort:d.onSort,onSelectAllRows:r=>d.onSelectAllRows(r,t.map(j=>j.id.toString())),headLabel:[{id:"eventName",label:"Event Name"},{id:"description",label:"Description"},{id:"placeName",label:"Place Name"},{id:"startDate - endDate",label:"Start Date - End Date"},{id:"status",label:"Status"},{id:"actions",label:"Actions"}]}),e.jsxs(J,{children:[C.slice(d.page*d.rowsPerPage,d.page*d.rowsPerPage+d.rowsPerPage).map(r=>e.jsx(_,{row:r,selected:d.selected.includes(r.id.toString()),onSelectRow:()=>d.onSelectRow(r.id.toString()),onUpdateStatus:async j=>{await ce(r.placeId,r.id,j)&&a(F=>F.map(A=>A.id===r.id?{...A,eventStatus:j}:A))}},r.id)),e.jsx(re,{height:68,emptyRows:te(d.page,d.rowsPerPage,t.length)}),p&&e.jsx(le,{searchQuery:s})]})]})})}),e.jsx(V,{component:"div",page:v-1,count:n,rowsPerPage:c,onPageChange:(r,j)=>f(j+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:r=>{S(parseInt(r.target.value,10)),f(1)}})]})]})}function ue(){const[t,a]=l.useState(0),[n,o]=l.useState("eventName"),[s,u]=l.useState(5),[h,i]=l.useState([]),[m,g]=l.useState("asc"),v=l.useCallback(p=>{g(n===p&&m==="asc"?"desc":"asc"),o(p)},[m,n]),f=l.useCallback((p,r)=>{if(p){i(r);return}i([])},[]),c=l.useCallback(p=>{const r=h.includes(p)?h.filter(j=>j!==p):[...h,p];i(r)},[h]),S=l.useCallback(()=>{a(0)},[]),d=l.useCallback((p,r)=>{a(r)},[]),C=l.useCallback(p=>{u(parseInt(p.target.value,10)),S()},[S]);return{page:t,order:m,onSort:v,orderBy:n,selected:h,rowsPerPage:s,onSelectRow:c,onResetPage:S,onChangePage:d,onSelectAllRows:f,onChangeRowsPerPage:C}}function xe(){return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs("title",{children:[" ",`Places - ${Z.appName}`]})}),e.jsx(de,{})]})}export{xe as default};
