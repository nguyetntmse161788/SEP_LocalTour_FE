import{r as l,w as O,j as e,B as f,A as z,x as L,h as T,p as E,z as B,T as P,I as k,y as N,D as H,C as W,H as $}from"./index-Cc_uhaw2.js";import{C as G}from"./config-global-DYC5wpSI.js";import{a as D}from"./axiosInstance-DxRYDP1x.js";import{c as y,d as g,b as M,T as Q,a as q,e as J}from"./TableRow-D6UDr9Xq.js";import{C as I}from"./Checkbox-vnf7N2Ff.js";import{T as K,a as U,b as X}from"./TableSortLabel-B-9zB2P1.js";import{O as Y}from"./Select-DNzxC7qm.js";import{I as Z}from"./InputAdornment-CxX4agxn.js";import{C as _}from"./Card-aOnlRS-j.js";import"./useFormControl-La3rWkRi.js";import"./Popper-CNsN0Zo1.js";import"./LastPage-CV_-hBrB.js";function V({row:t,selected:a,onSelectRow:n,onUpdateStatus:o}){const[s,u]=l.useState(null);O(),l.useCallback(i=>{i.stopPropagation(),u(i.currentTarget)},[]);const p=l.useCallback(()=>{u(null)},[]);return e.jsxs(e.Fragment,{children:[e.jsxs(y,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,children:[e.jsx(g,{padding:"checkbox",children:e.jsx(I,{disableRipple:!0,checked:a,onChange:n})}),e.jsx(g,{component:"th",scope:"row",children:e.jsxs(f,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(z,{alt:t.eventName||"N/A",src:t.eventPhotoDisplay}),t.eventName||"N/A"]})}),e.jsx(g,{children:t.description||"N/A"}),e.jsx(g,{children:t.placeName||"N/A"}),e.jsxs(g,{children:[new Date(t.startDate).toLocaleDateString()," -"," ",new Date(t.endDate).toLocaleDateString()]}),e.jsx(g,{align:"center",children:e.jsx(L,{color:t.eventStatus==="Pending"?"warning":t.eventStatus==="Approved"?"success":t.eventStatus==="Rejected"?"error":"default",children:t.eventStatus})}),e.jsx(g,{align:"center",children:e.jsxs(f,{display:"flex",gap:1,justifyContent:"center",children:[e.jsx(T,{variant:"contained",color:"success",size:"small",disabled:t.eventStatus==="Approved",onClick:()=>o("Approved"),children:"Approve"}),e.jsx(T,{variant:"contained",color:"error",size:"small",disabled:t.eventStatus==="Rejected",onClick:()=>o("Rejected"),children:"Reject"})]})})]}),e.jsx(E,{open:!!s,anchorEl:s,onClose:p,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"}})]})}const ee={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function te(t,a,n){return t?Math.max(0,(1+t)*a-n):0}function R(t,a,n){return a[n]<t[n]?-1:a[n]>t[n]?1:0}function ne(t,a){return t==="desc"?(n,o)=>R(n,o,a):(n,o)=>-R(n,o,a)}function ae({inputData:t,comparator:a,filterName:n,filterStatus:o}){let s=[...t];return n&&(s=s.filter(u=>u.eventName.toLowerCase().includes(n.toLowerCase()))),o&&(s=s.filter(u=>u.eventStatus===o)),s.sort(a),s}function se({order:t,onSort:a,orderBy:n,rowCount:o,headLabel:s,numSelected:u,onSelectAllRows:p}){return e.jsx(M,{children:e.jsxs(y,{children:[e.jsx(g,{padding:"checkbox",children:e.jsx(I,{indeterminate:u>0&&u<o,checked:o>0&&u===o,onChange:i=>p(i.target.checked)})}),s.map(i=>e.jsx(g,{align:i.align||"left",sortDirection:n===i.id?t:!1,sx:{width:i.width,minWidth:i.minWidth},children:e.jsxs(K,{hideSortIcon:!0,active:n===i.id,direction:n===i.id?t:"asc",onClick:()=>a(i.id),children:[i.label,n===i.id?e.jsx(f,{sx:{...ee},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},i.id))]})})}function oe({numSelected:t,filterName:a,onFilterName:n,onFilterStatus:o}){const[s,u]=l.useState(null),[p,i]=l.useState(null),m=c=>{i(c),o(c),u(null)},b=c=>{u(c.currentTarget)},j=()=>{u(null)},v=!!s;return e.jsxs(B,{sx:{height:96,display:"flex",justifyContent:"space-between",p:c=>c.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(P,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(Y,{fullWidth:!0,value:a,onChange:n,placeholder:"Search event...",startAdornment:e.jsx(Z,{position:"start",children:e.jsx(k,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),t>0?e.jsx(N,{children:e.jsx(k,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Filter list",children:e.jsx(N,{onClick:b,children:e.jsx(k,{icon:"ic:round-filter-list"})})}),e.jsx(E,{open:v,anchorEl:s,onClose:j,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(f,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(c=>e.jsx(T,{variant:p===(c==="All"?null:c)?"contained":"outlined",onClick:()=>m(c==="All"?null:c),sx:{color:p===(c==="All"?null:c)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:c},c))})})]})]})}function re({emptyRows:t,height:a,sx:n,...o}){return t?e.jsx(y,{sx:{...a&&{height:a*t},...n},...o,children:e.jsx(g,{colSpan:9})}):null}function le({searchQuery:t,...a}){return e.jsx(y,{...a,children:e.jsx(g,{align:"center",colSpan:7,children:e.jsxs(f,{sx:{py:15,textAlign:"center"},children:[e.jsx(P,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(P,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const ie=async(t=1,a=5,n="vi")=>{const o=localStorage.getItem("accessToken");if(console.log("Access Token:",o),!o)return console.error("No access token found"),{items:[],totalCount:0};try{const s=await D.get("https://api.localtour.space/api/Event/getallevent",{headers:{Authorization:`Bearer ${o}`},params:{LanguageCode:n,Page:t,Size:a}});return console.log("API Response:",s.data),{items:s.data.items,totalCount:s.data.totalCount}}catch(s){return console.error("Error fetching events",s),{items:[],totalCount:0}}},ce=async(t,a,n)=>{const o=localStorage.getItem("accessToken");if(!o)return console.error("No access token found"),null;try{return(await D.put("https://api.localtour.space/api/Event/changeStatusEvent",null,{headers:{Authorization:`Bearer ${o}`},params:{placeid:t,eventid:a,status:n}})).data}catch(s){return console.error("Error updating event status:",s),null}};function de(){const[t,a]=l.useState([]),[n,o]=l.useState(0),[s,u]=l.useState(""),[p,i]=l.useState("vi"),[m,b]=l.useState(null),[j,v]=l.useState(1),[c,S]=l.useState(5);l.useEffect(()=>{(async()=>{const{items:x,totalCount:w}=await ie(j,c,p);a(x),o(w)})()},[j,c,p,n]);const d=ue(),C=ae({inputData:t,comparator:ne(d.order,d.orderBy),filterName:s,filterStatus:m}),h=!C.length&&!!s;return e.jsxs(H,{children:[e.jsx(f,{display:"flex",alignItems:"center",mb:5,children:e.jsx(P,{variant:"h4",flexGrow:1,children:"Events"})}),e.jsxs(_,{children:[e.jsx(oe,{numSelected:d.selected.length,filterName:s,onFilterName:r=>{u(r.target.value),d.onResetPage()},onFilterStatus:r=>b(r)}),e.jsx(W,{children:e.jsx(Q,{sx:{overflow:"unset"},children:e.jsxs(q,{sx:{minWidth:800},children:[e.jsx(se,{order:d.order,orderBy:d.orderBy,rowCount:t.length,numSelected:d.selected.length,onSort:d.onSort,onSelectAllRows:r=>d.onSelectAllRows(r,t.map(x=>x.id.toString())),headLabel:[{id:"eventName",label:"Event Name"},{id:"description",label:"Description"},{id:"placeName",label:"Place Name"},{id:"startDate - endDate",label:"Start Date - End Date"},{id:"status",label:"Status"},{id:"actions",label:"Actions"}]}),e.jsxs(J,{children:[C.slice(d.page*d.rowsPerPage,d.page*d.rowsPerPage+d.rowsPerPage).map(r=>e.jsx(V,{row:r,selected:d.selected.includes(r.id.toString()),onSelectRow:()=>d.onSelectRow(r.id.toString()),onUpdateStatus:async x=>{await ce(r.placeId,r.id,x)&&a(F=>F.map(A=>A.id===r.id?{...A,eventStatus:x}:A))}},r.id)),e.jsx(re,{height:68,emptyRows:te(d.page,d.rowsPerPage,t.length)}),h&&e.jsx(le,{searchQuery:s})]})]})})}),e.jsx(X,{component:"div",page:j-1,count:n,rowsPerPage:c,onPageChange:(r,x)=>v(x+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:r=>{S(parseInt(r.target.value,10)),v(1)}})]})]})}function ue(){const[t,a]=l.useState(0),[n,o]=l.useState("eventName"),[s,u]=l.useState(5),[p,i]=l.useState([]),[m,b]=l.useState("asc"),j=l.useCallback(h=>{b(n===h&&m==="asc"?"desc":"asc"),o(h)},[m,n]),v=l.useCallback((h,r)=>{if(h){i(r);return}i([])},[]),c=l.useCallback(h=>{const r=p.includes(h)?p.filter(x=>x!==h):[...p,h];i(r)},[p]),S=l.useCallback(()=>{a(0)},[]),d=l.useCallback((h,r)=>{a(r)},[]),C=l.useCallback(h=>{u(parseInt(h.target.value,10)),S()},[S]);return{page:t,order:m,onSort:j,orderBy:n,selected:p,rowsPerPage:s,onSelectRow:c,onResetPage:S,onChangePage:d,onSelectAllRows:v,onChangeRowsPerPage:C}}function ye(){return e.jsxs(e.Fragment,{children:[e.jsx($,{children:e.jsxs("title",{children:[" ",`Events - ${G.appName}`]})}),e.jsx(de,{})]})}export{ye as default};
