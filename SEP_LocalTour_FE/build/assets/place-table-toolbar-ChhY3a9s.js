import{j as e,B,f as K,r,k as v,K as pe,A as he,I as A,Q as ue,l as R,P as Y,M as ge,m as X,N as me,J as xe,O as fe}from"./index-BCEoXUgR.js";import{T as z,a as C,f as je,g as ye}from"./TableSortLabel-D4yi4Kr4.js";import{a as I}from"./index-Br0q4W-C.js";import{D as Q,a as G,b as J,c as Z}from"./DialogTitle-DLFL-6md.js";import{A as F}from"./Autocomplete-Db5_biKL.js";import{T as b}from"./TextField-DWe7D0BL.js";import{G as _}from"./Grid-ClQYLn49.js";import{C as ee}from"./Checkbox-B8ndejfx.js";import{O as be}from"./Select-BESDqWty.js";function Ee({searchQuery:s,...d}){return e.jsx(z,{...d,children:e.jsx(C,{align:"center",colSpan:7,children:e.jsxs(B,{sx:{py:15,textAlign:"center"},children:[e.jsx(K,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(K,{variant:"body2",children:["No results found for  ",e.jsxs("strong",{children:['"',s,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Ce=({latitude:s,longitude:d,onLocationSelect:u,onCloseMap:x})=>{const n=r.useRef(null),[l,T]=r.useState(!1),[c,E]=r.useState(null),[k,L]=r.useState(null),[w,h]=r.useState([]),[M,P]=r.useState("");r.useEffect(()=>{const p=()=>{window.vietmapgl?T(!0):setTimeout(p,500)};p()},[]),r.useEffect(()=>{if(l){const p=new window.vietmapgl.Map({container:n.current,style:"https://maps.vietmap.vn/mt/tm/style.json?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46",center:[d,s],zoom:9}),m=new window.vietmapgl.Marker().setLngLat([d,s]).addTo(p);E(m),L(p),p.on("click",j=>{const{lng:f,lat:D}=j.lngLat;m.setLngLat([f,D])})}else console.error("VietMap API không tải được")},[s,d,l]);const O=async p=>{const m=p.target.value;if(P(m),m.length>2)try{const f=await(await fetch(`https://maps.vietmap.vn/api/search/v3?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46&text=${m}`)).json();h(f||[])}catch(j){console.error("Lỗi khi tìm kiếm địa điểm:",j)}else h([])},W=async(p,m)=>{try{const j=await fetch(`https://maps.vietmap.vn/api/place/v3?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46&refid=${m}`);if(!j.ok){console.error("Lỗi API:",j.status,j.statusText);return}const f=await j.json();if(f&&f.lng&&f.lat){const{lng:D,lat:S}=f;l&&c&&(c.setLngLat([D,S]),k.flyTo({center:[D,S],zoom:500})),u(D.toString(),S.toString()),h([]),P(p);const y=p||`${f.result.district}, ${f.result.city}`;console.log("Địa chỉ đầy đủ:",y)}else console.error("Dữ liệu không hợp lệ từ API: Không tìm thấy tọa độ.",f)}catch(j){console.error("Lỗi khi lấy tọa độ từ API:",j)}},N=()=>{if(c){const{lng:p,lat:m}=c.getLngLat();u(p.toString(),m.toString()),x()}};return e.jsxs("div",{children:[e.jsx("input",{type:"text",value:M,onChange:O,placeholder:"Nhập địa chỉ..."}),w.length>0&&e.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc"},children:w.map(p=>e.jsx("div",{style:{padding:"8px",cursor:"pointer"},role:"button",tabIndex:0,onClick:()=>W(p.address,p.ref_id),onKeyDown:m=>{(m.key==="Enter"||m.key===" ")&&W(p.address,p.ref_id)},children:p.display},p.ref_id))}),e.jsx("div",{ref:n,style:{width:"100%",height:"300px"}}),e.jsxs("div",{className:"map-actions",children:[e.jsx("button",{onClick:N,className:"btn-select",type:"button",children:"Select Location"}),e.jsx("button",{onClick:x,className:"btn-close",type:"button",children:"Close"})]})]})};function Te({open:s,onClose:d,placeId:u,onPlaceUpdated:x}){const[n,l]=r.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),[T,c]=r.useState([]),[E,k]=r.useState(!1),[L,w]=r.useState(""),[h,M]=r.useState(""),[P,O]=r.useState([]),[W,N]=r.useState([]),[p,m]=r.useState([]),[j,f]=r.useState(""),[D,S]=r.useState("");r.useEffect(()=>{(async()=>{var t,o;try{const i=(await I.get(`https://api.localtour.space/api/Place/getPlaceById?languageCode=vi&placeid=${u}`)).data;l({wardId:i.wardId||"",timeOpen:i.timeOpen||"",timeClose:i.timeClose||"",longitude:((t=i.longitude)==null?void 0:t.toString())||"",latitude:((o=i.latitude)==null?void 0:o.toString())||"",contactLink:i.contactLink||"",tags:i.tags||[],placeTranslations:i.placeTranslations||[],photoDisplay:i.photoDisplay,placeMedia:[],isVerified:i.isVerified||!1,status:i.status||"0"}),f(i.provinceId),S(i.districtId),U(i.provinceId),q(i.districtId),y(u)}catch(g){console.error("Error fetching place data:",g)}})()},[u]);const y=async a=>{try{const o=(await I.get(`https://api.localtour.space/api/Place/getTagsInPlace?placeId=${a}`)).data;c(o),l(g=>({...g,tags:o.map(i=>i.id)}))}catch(t){console.error("Error fetching tags for place:",t)}},H=(a,t)=>{w(a),M(t),l(o=>({...o,longitude:a,latitude:t}))},te=()=>{k(!0)},ae=()=>{k(!1)};r.useEffect(()=>{(async()=>{try{const t=await I.get("https://api.localtour.space/api/Tag/getAll");c(t.data.items)}catch(t){console.error("Error fetching tags:",t)}})()},[]),r.useEffect(()=>{(async()=>{try{const t=await I.get("https://api.localtour.space/api/Address/Province");O(t.data)}catch(t){console.error("Error fetching provinces:",t)}})()},[]);const U=async a=>{try{const t=await I.get(`https://api.localtour.space/api/Address/District?provinceI=${a}`);N(t.data)}catch(t){console.error("Error fetching districts:",t)}},q=async a=>{try{const t=await I.get(`https://api.localtour.space/api/Address/Ward?cityId=${a}`);console.log("Wards Response:",t.data),m(t.data)}catch(t){console.error("Error fetching wards:",t)}},ne=()=>{l(a=>({...a,placeTranslations:[...a.placeTranslations,{languageCode:"",name:"",description:"",address:"",contact:""}]}))},se=a=>{l(t=>{const o=t.placeTranslations.filter((g,i)=>i!==a);return{...t,placeTranslations:o}})},oe=()=>{l(a=>({...a,placeMedia:[...a.placeMedia,null]}))},ie=a=>{l(t=>{const o=t.placeMedia.filter((g,i)=>i!==a);return{...t,placeMedia:o}})},le=a=>{const t=a.target.files;t&&t[0]&&l(o=>({...o,photoDisplay:t[0]}))},re=(a,t)=>{const o=a.target.files;o&&o.length>0?l(g=>{const i=[...g.placeMedia];return i[t]=o[0],{...g,placeMedia:i}}):l(g=>{const i=[...g.placeMedia];return i[t]=null,{...g,placeMedia:i}})},$=(a,t)=>{const{name:o,value:g}=a.target,i=[...n.placeTranslations];i[t]={...i[t],[o]:g},l({...n,placeTranslations:i})},V=a=>{const{name:t,value:o}=a.target;l(g=>({...g,[t]:o}))},ce=(a,t)=>{l(o=>({...o,tags:t.map(g=>g.id)}))},de=async()=>{try{const a=localStorage.getItem("accessToken"),t=new FormData;t.append("WardId",n.wardId),t.append("TimeOpen",n.timeOpen),t.append("TimeClose",n.timeClose),t.append("Longitude",n.longitude),t.append("Latitude",n.latitude),t.append("ContactLink",n.contactLink),n.tags.forEach(i=>t.append("Tags",i)),t.append("PlaceTranslation",JSON.stringify(n.placeTranslations)),n.photoDisplay&&t.append("PhotoDisplay",n.photoDisplay),n.placeMedia.forEach(i=>{i&&t.append("PlaceMedia",i)});const g=(await I.put(`https://api.localtour.space/api/Place/update?placeid=${u}`,t,{headers:{Authorization:`Bearer ${a}`,"Content-Type":"multipart/form-data"}})).data;alert("Place updated successfully!"),x(g),d()}catch(a){console.error("Error updating place:",a),alert("Failed to update place.")}};return e.jsxs(Q,{open:s,onClose:d,maxWidth:"sm",fullWidth:!0,children:[e.jsx(G,{children:"New Place"}),e.jsxs(J,{children:[e.jsx(F,{fullWidth:!0,options:P,getOptionLabel:a=>a.name,onChange:(a,t)=>{f((t==null?void 0:t.id)||""),S(""),m([]),U(t==null?void 0:t.id)},value:P.find(a=>a.id===j)||null,renderInput:a=>e.jsx(b,{...a,label:"Province"})}),e.jsx(F,{fullWidth:!0,options:W,getOptionLabel:a=>a.name,onChange:(a,t)=>{S((t==null?void 0:t.id)||""),q(t==null?void 0:t.id)},value:W.find(a=>a.id===D)||null,renderInput:a=>e.jsx(b,{...a,label:"District"})}),e.jsx(F,{fullWidth:!0,options:p,getOptionLabel:a=>a.wardName||"",value:p.find(a=>a.id===n.wardId)||null,onChange:(a,t)=>{l(o=>({...o,wardId:(t==null?void 0:t.id)||""}))},renderInput:a=>e.jsx(b,{...a,label:"Ward"})}),e.jsx(b,{fullWidth:!0,label:"Time Open",name:"timeOpen",type:"time",value:n.timeOpen,onChange:V,margin:"normal",inputProps:{step:300}}),e.jsx(b,{fullWidth:!0,label:"Time Close",name:"timeClose",type:"time",value:n.timeClose,onChange:V,margin:"normal",inputProps:{step:300}}),e.jsx(b,{fullWidth:!0,label:"Longitude",name:"longitude",value:n.longitude,onChange:a=>w(a.target.value),margin:"normal"}),e.jsx(b,{fullWidth:!0,label:"Latitude",name:"latitude",value:n.latitude,onChange:a=>M(a.target.value),margin:"normal"}),e.jsx(v,{onClick:te,variant:"outlined",children:"Choose on Map"}),e.jsxs(Q,{open:E,onClose:()=>k(!1),maxWidth:"md",fullWidth:!0,children:[e.jsx(G,{children:"Select Location on Map"}),e.jsx(J,{children:e.jsx(Ce,{latitude:parseFloat(h)||10.762622,longitude:parseFloat(L)||106.827153,onLocationSelect:H,onCloseMap:ae})})]}),e.jsx(b,{fullWidth:!0,label:"Contact Link",name:"contactLink",value:n.contactLink,onChange:V,margin:"normal"}),e.jsx(F,{multiple:!0,id:"tags",options:T,getOptionLabel:a=>a.tagName,onChange:ce,value:T.filter(a=>n.tags.includes(a.id)),renderInput:a=>e.jsx(b,{...a,label:"Tags"}),disableCloseOnSelect:!0}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx("div",{style:{fontWeight:"bold"},children:"Photo Display"}),n.photoDisplay&&typeof n.photoDisplay=="string"?e.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:"200px",marginBottom:"10px"},children:[e.jsx("img",{src:n.photoDisplay,alt:"Display of the place",style:{width:"100%",height:"auto",maxHeight:"200px",objectFit:"cover",borderRadius:"10px"}}),e.jsx(v,{variant:"contained",color:"error",onClick:()=>l({...n,photoDisplay:null}),style:{position:"absolute",top:"5px",right:"5px",padding:"5px",minWidth:"unset",borderRadius:"50%",fontSize:"16px",backgroundColor:"rgba(255, 0, 0, 0.7)",color:"#fff",boxShadow:"0 2px 5px rgba(0, 0, 0, 0.3)"},children:"X"})]}):e.jsx("input",{type:"file",accept:"image/*",id:"photoDisplay",onChange:le})]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx(v,{variant:"outlined",onClick:oe,children:"Add Place Media"}),n.placeMedia.map((a,t)=>e.jsxs(_,{container:!0,spacing:2,alignItems:"center",style:{marginTop:"10px"},children:[e.jsxs(_,{item:!0,children:[e.jsxs("label",{htmlFor:`placeMedia-${t}`,children:["Media ",t+1]}),e.jsx("input",{type:"file",accept:"image/*",id:`placeMedia-${t}`,onChange:o=>re(o,t)})]}),e.jsx(_,{item:!0,children:e.jsx(v,{variant:"contained",color:"error",onClick:()=>ie(t),children:"Remove"})})]},t))]}),e.jsxs("div",{style:{marginTop:"20px"},children:[e.jsx(v,{variant:"outlined",onClick:ne,children:"Add Place Translation"}),n.placeTranslations.map((a,t)=>e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx(b,{fullWidth:!0,label:`Language Code ${t+1}`,name:"languageCode",value:a.languageCode,onChange:o=>$(o,t),margin:"normal"}),e.jsx(b,{fullWidth:!0,label:`Name ${t+1}`,name:"name",value:a.name,onChange:o=>$(o,t),margin:"normal"}),e.jsx(b,{fullWidth:!0,label:`Description ${t+1}`,name:"description",value:a.description,onChange:o=>$(o,t),margin:"normal"}),e.jsx(b,{fullWidth:!0,label:`Address ${t+1}`,name:"address",value:a.address,onChange:o=>$(o,t),margin:"normal"}),e.jsx(b,{fullWidth:!0,label:`Contact ${t+1}`,name:"contact",value:a.contact,onChange:o=>$(o,t),margin:"normal"}),e.jsx(v,{variant:"outlined",color:"error",onClick:()=>se(t),style:{marginTop:"10px"},children:"Remove Translation"})]},t))]})]}),e.jsxs(Z,{children:[e.jsx(v,{onClick:d,color:"secondary",children:"Cancel"}),e.jsx(v,{onClick:de,color:"primary",children:"Submit"})]})]})}function We({row:s,selected:d,onSelectRow:u,onDeletePlace:x}){var j,f,D,S;const[n,l]=r.useState(null),[T,c]=r.useState(!1),[E,k]=r.useState(!1),[L,w]=r.useState(""),h=pe(),M=r.useCallback(y=>{y.stopPropagation(),l(y.currentTarget)},[]),P=r.useCallback(()=>{l(null)},[]),O=y=>{y.stopPropagation(),h(`/owner/place/${s.id}`)},W=y=>{w(y),k(!0),P()},N=y=>{y.target instanceof HTMLButtonElement||y.target instanceof HTMLInputElement||h(`/owner/place/${s.id}`)},p=async()=>{const y=localStorage.getItem("accessToken");if(!y){console.error("No access token found");return}try{await I.delete(`https://api.localtour.space/api/Place/delete?placeid=${s.id}`,{headers:{Authorization:`Bearer ${y}`}}),x(s.id)}catch(H){console.error("Error deleting place:",H)}c(!1)},m=()=>{c(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(z,{hover:!0,tabIndex:-1,role:"checkbox",selected:d,onClick:N,children:[e.jsx(C,{padding:"checkbox",children:e.jsx(ee,{disableRipple:!0,checked:d,onChange:u})}),e.jsx(C,{component:"th",scope:"row",children:e.jsxs(B,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(he,{alt:((j=s.placeTranslation[0])==null?void 0:j.name)||"N/A",src:s.photoDisplay}),((f=s.placeTranslation[0])==null?void 0:f.name)||"N/A"]})}),e.jsx(C,{children:((D=s.placeTranslation[0])==null?void 0:D.address)||"N/A"}),e.jsx(C,{children:((S=s.placeTranslation[0])==null?void 0:S.description)||"N/A"}),e.jsx(C,{align:"center",children:s.status==="Pending"?"-":e.jsx(A,{width:22,icon:"solar:check-circle-bold",sx:{color:"success.main"}})}),e.jsx(C,{children:e.jsx(ue,{color:s.status==="Pending"?"warning":s.status==="Approved"?"success":s.status==="Rejected"?"error":"default",children:s.status})}),e.jsx(C,{align:"right",children:e.jsx(R,{onClick:O,children:e.jsx(A,{icon:"eva:arrow-forward-outline",width:22})})}),e.jsx(C,{align:"right",children:e.jsx(R,{onClick:M,children:e.jsx(A,{icon:"eva:more-vertical-fill",width:22})})})]}),e.jsx(Y,{open:!!n,anchorEl:n,onClose:P,children:e.jsxs(ge,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column"},children:[e.jsxs(X,{onClick:()=>{W(s.id),P()},children:[e.jsx(A,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(X,{onClick:()=>{c(!0),P()},sx:{color:"error.main"},children:[e.jsx(A,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsxs(Q,{open:T,onClose:m,children:[e.jsx(G,{children:"Confirm Deletion"}),e.jsx(J,{children:"Are you sure you want to delete this place?"}),e.jsxs(Z,{children:[e.jsx(v,{onClick:m,color:"primary",children:"Cancel"}),e.jsx(v,{onClick:p,color:"error",children:"Delete"})]})]}),e.jsx(Te,{open:E,placeId:L,onClose:()=>k(!1),onPlaceUpdated:()=>{x(L)}})]})}const ve={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function Oe(s,d,u){return s?Math.max(0,(1+s)*d-u):0}const Ne=(s,d)=>(u,x)=>{if(d==="status"){const n=Number(u.status),l=Number(x.status);return s==="asc"?n-l:l-n}return 0},$e=({inputData:s,comparator:d,filterName:u,filterStatus:x})=>{const n=[...s];return n.sort(d),n};function Fe({order:s,onSort:d,orderBy:u,rowCount:x,headLabel:n,numSelected:l,onSelectAllRows:T}){return e.jsx(je,{children:e.jsxs(z,{children:[e.jsx(C,{padding:"checkbox",children:e.jsx(ee,{indeterminate:l>0&&l<x,checked:x>0&&l===x,onChange:c=>T(c.target.checked)})}),n.map(c=>e.jsx(C,{align:c.align||"left",sortDirection:u===c.id?s:!1,sx:{width:c.width,minWidth:c.minWidth},children:e.jsxs(ye,{hideSortIcon:!0,active:u===c.id,direction:u===c.id?s:"asc",onClick:()=>d(c.id),children:[c.label,u===c.id?e.jsx(B,{sx:{...ve},children:s==="desc"?"sorted descending":"sorted ascending"}):null]})},c.id))]})})}function Re({emptyRows:s,height:d,sx:u,...x}){return s?e.jsx(z,{sx:{...d&&{height:d*s},...u},...x,children:e.jsx(C,{colSpan:9})}):null}function Be({numSelected:s,filterName:d,onFilterName:u,onFilterStatus:x}){const[n,l]=r.useState(null),[T,c]=r.useState(null),E=h=>{const M=h==="All"?"":h;c(M),x(M),l(null)},k=h=>{l(h.currentTarget)},L=()=>{l(null)},w=!!n;return e.jsxs(me,{sx:{height:96,display:"flex",justifyContent:"space-between",p:h=>h.spacing(0,1,0,3),...s>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[s>0?e.jsxs(K,{component:"div",variant:"subtitle1",children:[s," selected"]}):e.jsx(be,{fullWidth:!0,value:d,onChange:u,placeholder:"Search place...",startAdornment:e.jsx(xe,{position:"start",children:e.jsx(A,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),s>0?e.jsx(R,{children:e.jsx(A,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(fe,{title:"Filter list",children:e.jsx(R,{onClick:k,children:e.jsx(A,{icon:"ic:round-filter-list"})})}),e.jsx(Y,{open:w,anchorEl:n,onClose:L,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(B,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(h=>e.jsx(v,{variant:T===(h==="All"?null:h)?"contained":"outlined",onClick:()=>E(h==="All"?null:h),sx:{color:T===(h==="All"?null:h)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:h},h))})})]})]})}export{Ce as M,Be as P,Re as T,$e as a,Fe as b,We as c,Ee as d,Oe as e,Ne as g};
