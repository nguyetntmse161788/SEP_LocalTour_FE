import{j as t,m as Q,n as R,B as G,T as K,r as d,h as D,G as H,aI as Te,F as ee,t as te,l as ve,a0 as be,a2 as we,Q as Ce,R as De,K as ke,I as _,V as ae,U as Le,E as Pe}from"./index-z39hXFLl.js";import{a as k}from"./axiosInstance-Xq098mIU.js";import{D as se,a as ne,b as oe,c as Ie}from"./DialogTitle-Dgc1Aws8.js";import{A as B}from"./Autocomplete-_rkQI0np.js";import{T as v,F as Se}from"./TextField-B2lMQ9Li.js";function Be({searchQuery:l,...h}){return t.jsx(Q,{...h,children:t.jsx(R,{align:"center",colSpan:7,children:t.jsxs(G,{sx:{py:15,textAlign:"center"},children:[t.jsx(K,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(K,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',l,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Me=({latitude:l,longitude:h,onLocationSelect:u,onCloseMap:x})=>{const s=d.useRef(null),[i,C]=d.useState(!1),[g,A]=d.useState(null),[L,O]=d.useState(null),[P,m]=d.useState([]),[I,F]=d.useState("");d.useEffect(()=>{const p=()=>{window.vietmapgl?C(!0):setTimeout(p,500)};p()},[]),d.useEffect(()=>{if(i){const p=new window.vietmapgl.Map({container:s.current,style:"https://maps.vietmap.vn/mt/tm/style.json?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46",center:[h,l],zoom:9}),f=new window.vietmapgl.Marker().setLngLat([h,l]).addTo(p);A(f),O(p),p.on("click",T=>{const{lng:y,lat:S}=T.lngLat;f.setLngLat([y,S])})}else console.error("VietMap API không tải được")},[l,h,i]);const $=async p=>{const f=p.target.value;if(F(f),f.length>2)try{const y=await(await fetch(`https://maps.vietmap.vn/api/autocomplete/v3?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46&text=${f}`)).json();m(y||[])}catch(T){console.error("Lỗi khi tìm kiếm địa điểm:",T)}else m([])},W=async(p,f)=>{try{const T=await fetch(`https://maps.vietmap.vn/api/place/v3?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46&refid=${f}`);if(!T.ok){console.error("Lỗi API:",T.status,T.statusText);return}const y=await T.json();if(y&&y.lng&&y.lat){const{lng:S,lat:M}=y;i&&g&&(g.setLngLat([S,M]),L.flyTo({center:[S,M],zoom:500})),u(S.toString(),M.toString()),m([]),F(p);const q=p||`${y.result.district}, ${y.result.city}`;console.log("Địa chỉ đầy đủ:",q)}else console.error("Dữ liệu không hợp lệ từ API: Không tìm thấy tọa độ.",y)}catch(T){console.error("Lỗi khi lấy tọa độ từ API:",T)}},U=()=>{if(g){const{lng:p,lat:f}=g.getLngLat();u(p.toString(),f.toString()),x()}};return t.jsxs("div",{children:[t.jsx("input",{type:"text",value:I,onChange:$,placeholder:"Nhập địa chỉ..."}),P.length>0&&t.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc"},children:P.map(p=>t.jsx("div",{style:{padding:"8px",cursor:"pointer"},role:"button",tabIndex:0,onClick:()=>W(p.address,p.ref_id),onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&W(p.address,p.ref_id)},children:p.display},p.ref_id))}),t.jsx("div",{ref:s,style:{width:"100%",height:"300px"}}),t.jsxs("div",{className:"map-actions",children:[t.jsx("button",{onClick:U,className:"btn-select",type:"button",children:"Select Location"}),t.jsx("button",{onClick:x,className:"btn-close",type:"button",children:"Close"})]})]})};function Re({open:l,onClose:h,placeId:u,onPlaceUpdated:x}){const[s,i]=d.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),[C,g]=d.useState([]),[A,L]=d.useState(!1),[O,P]=d.useState(""),[m,I]=d.useState(""),[F,$]=d.useState([]),[W,U]=d.useState([]),[p,f]=d.useState([]),[T,y]=d.useState(""),[S,M]=d.useState(""),[q,ie]=d.useState(s),[c,Y]=d.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")});d.useEffect(()=>{(async()=>{var e,o;try{const n=(await k.get(`https://api.localtour.space/api/Place/getPlaceById?placeid=${u}`)).data,w={wardId:n.wardId||"",timeOpen:n.timeOpen||"",timeClose:n.timeClose||"",longitude:((e=n.longitude)==null?void 0:e.toString())||"",latitude:((o=n.latitude)==null?void 0:o.toString())||"",contactLink:n.contactLink||"",tags:n.tags||[],placeTranslations:n.placeTranslations||[],photoDisplay:n.photoDisplay,placeMedia:n.placeMedia.map(Z=>({type:Z.type,url:Z.url})),isVerified:n.isVerified||!1,status:n.status||"0"};i(w),ie(w);const b=(await k.get(`https://api.localtour.space/api/Address/getDistrictByWardId?wardId=${n.wardId}`)).data;M(b.id);const z=(await k.get(`https://api.localtour.space/api/Address/getProvinceByDistrictId?districtId=${b.id}`)).data;y(z.id),J(z.id),X(b.id),le(u),Y({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")})}catch(r){console.error("Error fetching place data:",r)}})()},[l,u]);const re=()=>{i(q),h()},le=async a=>{try{const o=(await k.get(`https://api.localtour.space/api/Place/getTagsInPlace?placeId=${a}`)).data;i(r=>({...r,tags:o.map(n=>n.id)}))}catch(e){console.error("Error fetching tags for place:",e)}},ce=(a,e)=>{P(a),I(e),i(o=>({...o,longitude:a,latitude:e}))},de=()=>{L(!0)},pe=()=>{L(!1)};d.useEffect(()=>{(async()=>{try{const e=await k.get("https://api.localtour.space/api/Tag/getAll?Size=1000");g(e.data.items)}catch(e){console.error("Error fetching tags:",e)}})()},[]),d.useEffect(()=>{(async()=>{try{const e=await k.get("https://api.localtour.space/api/Address/Province");$(e.data)}catch(e){console.error("Error fetching provinces:",e)}})()},[]);const J=async a=>{try{const e=await k.get(`https://api.localtour.space/api/Address/District?provinceI=${a}`);U(e.data)}catch(e){console.error("Error fetching districts:",e)}},X=async a=>{try{const e=await k.get(`https://api.localtour.space/api/Address/Ward?cityId=${a}`);console.log("Wards Response:",e.data),f(e.data)}catch(e){console.error("Error fetching wards:",e)}},he=()=>{i(a=>({...a,placeTranslations:[...a.placeTranslations,{languageCode:"vi",name:"",description:"",address:"",contact:""}]}))},ue=a=>{i(e=>{const o=e.placeTranslations.filter((r,n)=>n!==a);return{...e,placeTranslations:o}})},ge=a=>{const e=a.target.files;e&&e[0]&&i(o=>({...o,photoDisplay:e[0]}))},me=async(a,e)=>{const o=a.target.files;if(o&&o.length>0){const r=o[0],n=[...s.placeMedia];try{const w=new FormData;w.append("files",r);const N=await fetch("https://api.localtour.space/api/File/createlink",{method:"POST",body:w});if(!N.ok)throw new Error("Failed to upload file");const b=await N.json();let j="";if(r.type.includes("image")&&b.imageUrls&&b.imageUrls.length>0)j=b.imageUrls[0];else if(r.type.includes("video")&&b.videoUrls&&b.videoUrls.length>0)j=b.videoUrls[0];else throw new Error("No URL returned for the uploaded file");n[e]={type:r.type.includes("image")?"Image":"Video",url:j},i({...s,placeMedia:n})}catch(w){console.error("Error uploading file:",w)}}},fe=a=>{const e=s.placeMedia.filter((o,r)=>r!==a);i({...s,placeMedia:e})},xe=()=>s.placeMedia.map((a,e)=>t.jsxs(H,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(H,{item:!0,xs:6,children:a.url?a.type==="Image"?t.jsx("img",{src:a.url,alt:"Media",style:{width:"100%",maxHeight:"200px",objectFit:"cover"}}):t.jsxs("video",{width:"100%",height:"auto",controls:!0,children:[t.jsx("source",{src:a.url,type:"video/mp4"}),"Your browser does not support the video tag."]}):t.jsx("div",{children:"No media selected"})}),t.jsxs(H,{item:!0,xs:6,children:[!a.url&&t.jsx(t.Fragment,{children:t.jsx("input",{type:"file",accept:"image/*,video/*",onChange:o=>me(o,e)})}),t.jsx(D,{variant:"contained",color:"error",onClick:()=>fe(e),children:"Remove"})]})]},e)),E=(a,e)=>{const{name:o,value:r}=a.target,n=[...s.placeTranslations];n[e]={...n[e],[o]:r},i({...s,placeTranslations:n})},V=a=>{const{name:e,value:o}=a.target;i(r=>({...r,[e]:o}))},ye=(a,e)=>{i(o=>({...o,tags:e.map(r=>r.id)}))},je=async()=>{var o;let a=!1;const e={wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")};if(s.wardId||(e.wardId="Please select a ward.",a=!0),s.timeOpen||(e.timeOpen="Time Open is required.",a=!0),s.timeClose||(e.timeClose="Time Close is required.",a=!0),s.longitude||(e.longitude="Longitude is required.",a=!0),s.latitude||(e.latitude="Latitude is required.",a=!0),s.photoDisplay||(e.photoDisplay="PhotoDisplay is required.",a=!0),s.contactLink||(e.contactLink="Contact Link is required.",a=!0),s.tags.length===0&&(e.tags="At least one tag is required.",a=!0),s.placeMedia.length===0&&(e.placeMedia="At least one media is required.",a=!0),s.placeTranslations.forEach((r,n)=>{!r.name||!r.description||!r.address||!r.contact?(e.placeTranslations[n]="All fields are required for each translation.",a=!0):e.placeTranslations[n]=""}),a){Y(e);return}try{const r=localStorage.getItem("accessToken"),n=new FormData;n.append("WardId",s.wardId),n.append("TimeOpen",s.timeOpen),n.append("TimeClose",s.timeClose),n.append("Longitude",s.longitude),n.append("Latitude",s.latitude),n.append("ContactLink",s.contactLink),s.tags.forEach(j=>n.append("Tags",j)),n.append("PlaceTranslation",JSON.stringify(s.placeTranslations));let w=s.photoDisplay;if(s.photoDisplay&&s.photoDisplay instanceof File){const j=new FormData;j.append("file",s.photoDisplay),w=(o=(await te.post("https://api.localtour.space/api/File/link",j)).data)==null?void 0:o.data}n.append("PhotoDisplay",w),s.placeMedia.forEach(j=>{j.url&&(j.url,n.append("PlaceMedia",j.url))});const b=(await te.put(`https://api.localtour.space/api/Place/update?placeid=${u}`,n,{headers:{Authorization:`Bearer ${r}`,"Content-Type":"multipart/form-data"}})).data;alert("Place updated successfully!"),x(b),h()}catch(r){console.error("Error updating place:",r),alert("Failed to update place.")}};return t.jsxs(se,{open:l,onClose:h,maxWidth:"sm",fullWidth:!0,children:[t.jsx(ne,{children:"New Place"}),t.jsxs(oe,{children:[t.jsx(B,{fullWidth:!0,options:F,getOptionLabel:a=>a.name,onChange:(a,e)=>{y((e==null?void 0:e.id)||""),M(""),f([]),J(e==null?void 0:e.id)},value:F.find(a=>a.id===T)||null,renderInput:a=>t.jsx(v,{...a,label:"Province"})}),t.jsx(B,{fullWidth:!0,options:W,getOptionLabel:a=>a.name,onChange:(a,e)=>{M((e==null?void 0:e.id)||""),X(e==null?void 0:e.id)},value:W.find(a=>a.id===S)||null,renderInput:a=>t.jsx(v,{...a,label:"District"})}),t.jsx(B,{fullWidth:!0,options:p,getOptionLabel:a=>a.wardName||"",value:p.find(a=>a.id===s.wardId)||null,onChange:(a,e)=>{i(o=>({...o,wardId:(e==null?void 0:e.id)||""}))},renderInput:a=>t.jsxs(t.Fragment,{children:[t.jsx(v,{...a,label:"Ward",error:!!c.wardId}),c.wardId&&t.jsx(Se,{error:!0,children:c.wardId})]}),isOptionEqualToValue:(a,e)=>a.id===(e==null?void 0:e.id)}),t.jsx(v,{fullWidth:!0,label:"Time Open",name:"timeOpen",type:"time",value:s.timeOpen,onChange:V,margin:"normal",inputProps:{step:300},error:!!c.timeOpen,helperText:c.timeOpen}),t.jsx(v,{fullWidth:!0,label:"Time Close",name:"timeClose",type:"time",value:s.timeClose,onChange:V,margin:"normal",inputProps:{step:300},error:!!c.timeClose,helperText:c.timeClose}),t.jsx(v,{fullWidth:!0,label:"Longitude",name:"longitude",value:s.longitude,onChange:a=>P(a.target.value),margin:"normal",error:!!c.longitude,helperText:c.longitude}),t.jsx(v,{fullWidth:!0,label:"Latitude",name:"latitude",value:s.latitude,onChange:a=>I(a.target.value),margin:"normal",error:!!c.latitude,helperText:c.latitude}),t.jsx(D,{onClick:de,variant:"outlined",children:"Choose on Map"}),t.jsxs(se,{open:A,onClose:()=>L(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(ne,{children:"Select Location on Map"}),t.jsx(oe,{children:t.jsx(Me,{latitude:parseFloat(m)||10.762622,longitude:parseFloat(O)||106.827153,onLocationSelect:ce,onCloseMap:pe})})]}),t.jsx(v,{fullWidth:!0,label:"Contact Link",name:"contactLink",value:s.contactLink,onChange:V,margin:"normal",error:!!c.contactLink,helperText:c.contactLink}),t.jsx(B,{multiple:!0,id:"tags",options:C,getOptionLabel:a=>a.tagName,onChange:ye,value:C.filter(a=>s.tags.includes(a.id)),renderInput:a=>t.jsx(v,{...a,label:"Tags",error:!!c.tags,helperText:c.tags}),disableCloseOnSelect:!0}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("div",{style:{fontWeight:"bold"},children:"Photo Display"}),s.photoDisplay?t.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:"200px",marginBottom:"10px"},children:[t.jsx("img",{src:typeof s.photoDisplay=="string"?s.photoDisplay:URL.createObjectURL(s.photoDisplay),alt:"Display of the place",style:{width:"100%",height:"auto",maxHeight:"200px",objectFit:"cover",borderRadius:"10px"}}),t.jsx(D,{variant:"contained",color:"error",onClick:()=>i({...s,photoDisplay:null}),style:{position:"absolute",top:"5px",right:"5px",padding:"5px",minWidth:"unset",borderRadius:"50%",fontSize:"16px",backgroundColor:"rgba(255, 0, 0, 0.7)",color:"#fff"},children:"X"})]}):t.jsx("input",{type:"file",accept:"image/*",id:"photoDisplay",onChange:ge}),c.photoDisplay&&t.jsx("div",{style:{color:"red"},children:c.photoDisplay})]}),t.jsxs("div",{children:[t.jsx("h4",{children:"Place Media"}),xe(),c.placeMedia&&t.jsx("div",{style:{color:"red"},children:c.placeMedia})]}),t.jsx(D,{variant:"contained",color:"primary",onClick:()=>i({...s,placeMedia:[...s.placeMedia,{type:"",url:""}]}),children:"Add Media"}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(D,{variant:"outlined",onClick:he,children:"Add Place Translation"}),s.placeTranslations.map((a,e)=>t.jsxs("div",{style:{marginTop:"15px"},children:[t.jsxs(Te,{fullWidth:!0,value:a.languageCode||"",onChange:o=>{const r=[...s.placeTranslations];r[e]={...r[e],languageCode:o.target.value},i({...s,placeTranslations:r})},children:[t.jsx(ee,{value:"vi",children:"VN"}),t.jsx(ee,{value:"en",children:"EN"})]}),t.jsx(v,{fullWidth:!0,label:`Name ${e+1}`,name:"name",value:a.name,onChange:o=>E(o,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(v,{fullWidth:!0,label:`Description ${e+1}`,name:"description",value:a.description,onChange:o=>E(o,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(v,{fullWidth:!0,label:`Address ${e+1}`,name:"address",value:a.address,onChange:o=>E(o,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(v,{fullWidth:!0,label:`Contact ${e+1}`,name:"contact",value:a.contact,onChange:o=>E(o,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(D,{variant:"outlined",color:"error",onClick:()=>ue(e),style:{marginTop:"10px"},children:"Remove Translation"})]},e))]})]}),t.jsxs(Ie,{children:[t.jsx(D,{onClick:re,color:"secondary",children:"Cancel"}),t.jsx(D,{onClick:je,color:"primary",children:"Submit"})]})]})}const Ae={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function $e(l,h,u){return l?Math.max(0,(1+l)*h-u):0}const Ue=(l,h)=>(u,x)=>{if(h==="status"){const s=Number(u.status),i=Number(x.status);return l==="asc"?s-i:i-s}return 0},qe=({inputData:l,comparator:h,filterName:u,filterStatus:x})=>{const s=[...l];return s.sort(h),s};function Ve({order:l,onSort:h,orderBy:u,rowCount:x,headLabel:s,numSelected:i,onSelectAllRows:C}){return t.jsx(ve,{children:t.jsxs(Q,{children:[t.jsx(R,{padding:"checkbox",children:t.jsx(be,{indeterminate:i>0&&i<x,checked:x>0&&i===x,onChange:g=>C(g.target.checked)})}),s.map(g=>t.jsx(R,{align:g.align||"left",sortDirection:u===g.id?l:!1,sx:{width:g.width,minWidth:g.minWidth},children:t.jsxs(we,{hideSortIcon:!0,active:u===g.id,direction:u===g.id?l:"asc",onClick:()=>h(g.id),children:[g.label,u===g.id?t.jsx(G,{sx:{...Ae},children:l==="desc"?"sorted descending":"sorted ascending"}):null]})},g.id))]})})}function ze({emptyRows:l,height:h,sx:u,...x}){return l?t.jsx(Q,{sx:{...h&&{height:h*l},...u},...x,children:t.jsx(R,{colSpan:9})}):null}function He({numSelected:l,filterName:h,onFilterName:u,onFilterStatus:x}){const[s,i]=d.useState(null),[C,g]=d.useState(null),A=m=>{const I=m==="All"?"":m;g(I),x(I),i(null)},L=m=>{i(m.currentTarget)},O=()=>{i(null)},P=!!s;return t.jsxs(Ce,{sx:{height:96,display:"flex",justifyContent:"space-between",p:m=>m.spacing(0,1,0,3),...l>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[l>0?t.jsxs(K,{component:"div",variant:"subtitle1",children:[l," selected"]}):t.jsx(De,{fullWidth:!0,value:h,onChange:u,placeholder:"Search place...",startAdornment:t.jsx(ke,{position:"start",children:t.jsx(_,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),l>0?t.jsx(ae,{children:t.jsx(_,{icon:"solar:trash-bin-trash-bold"})}):t.jsxs(t.Fragment,{children:[t.jsx(Le,{title:"Filter list",children:t.jsx(ae,{onClick:L,children:t.jsx(_,{icon:"ic:round-filter-list"})})}),t.jsx(Pe,{open:P,anchorEl:s,onClose:O,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(G,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(m=>t.jsx(D,{variant:C===(m==="All"?null:m)?"contained":"outlined",onClick:()=>A(m==="All"?null:m),sx:{color:C===(m==="All"?null:m)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:m},m))})})]})]})}export{Me as M,He as P,ze as T,Re as U,qe as a,Ve as b,Be as c,$e as e,Ue as g};
