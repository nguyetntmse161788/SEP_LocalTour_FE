import{j as e,B as v,T as k,w as R,A as C,h as S,l as T,z as I,I as y,y as w,r as d,C as A}from"./index-Cc_uhaw2.js";import{c as P,d as u,b as B,T as F,a as E,e as D}from"./TableRow-D6UDr9Xq.js";import{v as O,b as $,g as L,e as z}from"./utils-DIknCzrT.js";import{T as W,a as U,b as J}from"./TableSortLabel-B-9zB2P1.js";import{O as M}from"./Select-DNzxC7qm.js";import{I as H}from"./InputAdornment-CxX4agxn.js";import{C as Q}from"./Card-aOnlRS-j.js";function _({searchQuery:s,...n}){return e.jsx(P,{...n,children:e.jsx(u,{align:"center",colSpan:7,children:e.jsxs(v,{sx:{py:15,textAlign:"center"},children:[e.jsx(k,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(k,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',s,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function q({row:s,selected:n,onSelectRow:i}){const r=R(),f=async(t,c,a)=>{console.log(s);try{const l=localStorage.getItem("accessToken");if(!l){alert("No token found. Please log in."),r("/sign-in");return}const g=JSON.parse(atob(l.split(".")[1])),x=Math.floor(Date.now()/1e3);if(g.exp<x){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),r("/login");return}const h=(await T.get(`https://api.localtour.space/api/User/getProfile?userId=${t}`,{headers:{Authorization:`Bearer ${l}`}})).data;r("/admin/role",{state:{user:h,userId:t,username:c,roles:a}})}catch(l){console.error("Failed to fetch user profile:",l),alert("Error fetching user profile. Please try again.")}console.log("Updated Roles:",a),console.log("Roles from localStorage:",a)},b=async t=>{try{const c=localStorage.getItem("accessToken");if(!c){alert("No token found. Please log in."),r("/sign-in");return}const a=JSON.parse(atob(c.split(".")[1])),l=Math.floor(Date.now()/1e3);if(a.exp<l){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),r("/login");return}const g=`https://api.localtour.space/api/User/UnBan/${t}`;console.log("Unban URL:",g),(await T.post(g,{},{headers:{Authorization:`Bearer ${c}`}})).status===200?(alert("User has been unbanned successfully."),window.location.reload()):alert("Failed to unban user. Please try again.")}catch(c){console.error("Error unbanning user:",c),alert("Error unbanning user. Please try again.")}},m=async(t,c,a)=>{try{const l=localStorage.getItem("accessToken");if(!l){alert("No token found. Please log in."),r("/sign-in");return}const g=JSON.parse(atob(l.split(".")[1])),x=Math.floor(Date.now()/1e3);if(g.exp<x){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),r("/sign-in");return}const o=await T.get(`https://api.localtour.space/api/User/getProfile?userId=${t}`,{headers:{Authorization:`Bearer ${l}`}});if(o.status===200){const h=o.data;r("/admin/ban",{state:{user:h,userId:t,username:c,endDate:a}})}else alert("User profile not found. Please try again.")}catch(l){console.error("Failed to fetch user profile:",l),alert("Error fetching user profile. Please try again.")}};return e.jsxs(P,{hover:!0,tabIndex:-1,role:"checkbox",selected:n,children:[e.jsx(u,{children:e.jsx(C,{alt:s.fullName,src:s.profilePictureUrl})}),e.jsx(u,{children:s.username}),e.jsx(u,{children:s.email}),e.jsx(u,{children:s.fullName}),e.jsx(u,{children:s.phoneNumber}),e.jsx(u,{children:s.roles.join(", ")}),e.jsxs(u,{children:[e.jsx(S,{variant:"outlined",color:"primary",sx:{margin:"0 5px"},onClick:()=>f(s.id,s.username,s.roles),children:"Set Role"}),e.jsx(S,{variant:"outlined",color:"error",sx:{margin:"0 5px"},onClick:()=>m(s.id,s.username,s.endDate),children:"Ban"}),e.jsx(S,{variant:"outlined",color:"success",sx:{margin:"0 5px"},onClick:()=>b(s.id),children:"Unban"})]})]})}function G({order:s,onSort:n,orderBy:i,rowCount:r,headLabel:f,numSelected:b,onSelectAllRows:m}){return e.jsx(B,{children:e.jsx(P,{children:f.map(t=>e.jsx(u,{align:t.align||"left",sortDirection:i===t.id?s:!1,sx:{width:t.width,minWidth:t.minWidth},children:e.jsxs(W,{hideSortIcon:!0,active:i===t.id,direction:i===t.id?s:"asc",onClick:()=>n(t.id),children:[t.label,i===t.id?e.jsx(v,{sx:{...O},children:s==="desc"?"sorted descending":"sorted ascending"}):null]})},t.id))})})}function K({emptyRows:s,height:n,sx:i,...r}){return s?e.jsx(P,{sx:{...n&&{height:n*s},...i},...r,children:e.jsx(u,{colSpan:9})}):null}function X({numSelected:s,filterName:n,onFilterName:i}){return e.jsxs(I,{sx:{height:96,display:"flex",justifyContent:"space-between",p:r=>r.spacing(0,1,0,3),...s>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[s>0?e.jsxs(k,{component:"div",variant:"subtitle1",children:[s," selected"]}):e.jsx(M,{fullWidth:!0,value:n,onChange:i,placeholder:"Search user...",startAdornment:e.jsx(H,{position:"start",children:e.jsx(y,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),s>0?e.jsx(U,{title:"Delete",children:e.jsx(w,{children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})}):e.jsx(U,{title:"Filter list",children:e.jsx(w,{children:e.jsx(y,{icon:"ic:round-filter-list"})})})]})}function re(){const s=R(),[n,i]=d.useState([]),[r,f]=d.useState(!0),[b,m]=d.useState(""),[t,c]=d.useState(""),a=Y();d.useEffect(()=>{const o=localStorage.getItem("accessToken");if(!o){m("No access token found. Please log in."),f(!1),s("/login");return}const h=JSON.parse(atob(o.split(".")[1])),p=Math.floor(Date.now()/1e3);if(h.exp<p){m("Token has expired. Please log in again."),f(!1),s("/sign-in");return}l(o)},[s]);const l=async o=>{try{const h=await T.get("https://api.localtour.space/api/User/getlist",{headers:{Authorization:`Bearer ${o}`}});console.log("Fetched Users:",h.data),i([...h.data])}catch{m("Failed to fetch users")}finally{f(!1)}},g=$({inputData:n,comparator:L(a.order,a.orderBy),filterName:t}),x=!g.length&&!!t;return r?e.jsx("div",{children:"Loading..."}):e.jsx(v,{sx:{p:3},children:e.jsxs(Q,{children:[e.jsx(X,{filterName:t,onFilterName:o=>{c(o.target.value),a.onResetPage()},numSelected:0}),e.jsx(A,{children:e.jsx(F,{sx:{overflow:"unset"},children:e.jsxs(E,{sx:{minWidth:800},children:[e.jsx(G,{order:a.order,orderBy:a.orderBy,rowCount:n.length,numSelected:a.selected.length,onSort:a.onSort,headLabel:[{id:"avatar",label:"Avatar"},{id:"username",label:"User name"},{id:"email",label:"Email"},{id:"fullname",label:"Full Name"},{id:"phone",label:"Phone"},{id:"role",label:"Role"},{id:"button",label:"Action"}]}),e.jsxs(D,{children:[r&&e.jsx(P,{children:e.jsx(u,{colSpan:8,align:"center",children:"Loading..."})}),b&&e.jsx(P,{children:e.jsx(u,{colSpan:8,align:"center",sx:{color:"error.main"},children:b})}),g.slice(a.page*a.rowsPerPage,a.page*a.rowsPerPage+a.rowsPerPage).map(o=>e.jsx(q,{row:o,selected:a.selected.includes(o.id),onSelectRow:()=>a.onSelectRow(o.id)},o.id)),e.jsx(K,{height:68,emptyRows:z(a.page,a.rowsPerPage,n.length)}),x&&e.jsx(_,{searchQuery:t})]})]})})}),e.jsx(J,{component:"div",page:a.page,count:n.length,rowsPerPage:a.rowsPerPage,onPageChange:a.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:a.onChangeRowsPerPage})]})})}function Y(){const[s,n]=d.useState(0),[i,r]=d.useState("username"),[f,b]=d.useState(5),[m,t]=d.useState([]),[c,a]=d.useState("asc"),l=d.useCallback(p=>{a(i===p&&c==="asc"?"desc":"asc"),r(p)},[c,i]),g=d.useCallback(p=>{t(j=>j.includes(p)?j.filter(N=>N!==p):[...j,p])},[]),x=d.useCallback(()=>n(0),[]),o=d.useCallback((p,j)=>{n(j)},[]),h=d.useCallback(p=>{b(parseInt(p.target.value,10)),x()},[x]);return{page:s,order:c,orderBy:i,rowsPerPage:f,selected:m,onSort:l,onSelectRow:g,onResetPage:x,onChangePage:o,onChangeRowsPerPage:h}}export{re as U,Y as u};
