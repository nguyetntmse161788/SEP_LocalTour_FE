import{r,j as e,h as d,q,ag as Y,w as Z,D as $,B as A,T as l,I as O,H as ee}from"./index-D4PwaD5N.js";import{C as te}from"./config-global-DYC5wpSI.js";import{a as H}from"./axiosInstance-Q6XP8Ys3.js";import{D as z,a as U,b as V,c as _}from"./DialogTitle-C6FRhu7J.js";import{T as D}from"./TextField-C0PbMPGO.js";import{F as ae,I as ie}from"./InputLabel-C9R4CQou.js";import{S as se}from"./Select-545m9gIo.js";import{G as o}from"./Grid-BP6mOV8A.js";import{C as ne}from"./CircularProgress-DT4cvsDk.js";import{C as G}from"./Card-CkOvGVvy.js";import"./useFormControl-BxpVqGaN.js";function re({open:m,onClose:i,onActivityCreated:R,placeId:k}){const[j,L]=r.useState(""),[x,W]=r.useState(""),[T,P]=r.useState(0),[f,B]=r.useState(""),[N,I]=r.useState(0),[y,w]=r.useState("vi"),[g,v]=r.useState(null),[C,b]=r.useState(1);r.useEffect(()=>{m||(v(null),w("vi"),b(1),p([{languageCode:"vi",activityName:"",price:0,description:"",priceType:"",discount:0}]))},[m]);const[h,p]=r.useState([{languageCode:y,activityName:j,price:T,description:x,priceType:f,discount:N}]),[n,c]=r.useState([]),F=async()=>{if(!g||n.length<1||!C){alert("Please fill out all required fields");return}const s=localStorage.getItem("accessToken");if(!s){console.error("No access token found");return}const a=new FormData;a.append("placeid",k),a.append("DisplayNumber",C.toString()),h.forEach(t=>{if(!t.activityName||t.price<=0||!t.description||!t.priceType){alert("Please fill out all required fields");return}a.append("PlaceActivityTranslations",JSON.stringify(t))}),g&&a.append("PhotoDisplay",g),n.forEach(t=>{t&&a.append("PlaceActivityMedium",t)});try{const t=await H.post(`https://api.localtour.space/api/PlaceActivity/create?placeid=${k}`,a,{headers:{Authorization:`Bearer ${s}`,"Content-Type":"multipart/form-data"}});console.log("Activity created response:",t.data),R(t.data),i(),E()}catch(t){console.error("Error creating activity",t)}},E=()=>{L(""),W(""),P(0),B(""),I(0),w("vi"),v(null),b(1),p([{languageCode:y,activityName:j,price:T,description:x,priceType:f,discount:N}]),c([])},M=()=>{p([...h,{languageCode:y,activityName:j,price:T,description:x,priceType:f,discount:N}])},J=s=>{const a=h.filter((t,u)=>u!==s);p(a)},K=()=>{c([...n,null])},Q=s=>{const a=n.filter((t,u)=>u!==s);c(a)},S=(s,a,t)=>{const u=[...h];u[s]={...u[s],[a]:t},p(u)},X=(s,a)=>{const t=s.target.files;if(t&&t[0]){const u=[...n];u[a]=t[0],c(u)}};return e.jsxs(z,{open:m,onClose:i,children:[e.jsx(U,{children:"Create Activity"}),e.jsxs(V,{children:[e.jsx(D,{label:"Display Number",type:"number",fullWidth:!0,value:C,onChange:s=>b(Number(s.target.value)),margin:"normal"}),e.jsxs("div",{children:[e.jsx(d,{variant:"outlined",onClick:M,children:"Add Translation"}),h.map((s,a)=>e.jsxs("div",{children:[e.jsx(D,{label:"Activity Name",fullWidth:!0,value:s.activityName,onChange:t=>S(a,"activityName",t.target.value),margin:"normal"}),e.jsxs(ae,{fullWidth:!0,margin:"normal",children:[e.jsx(ie,{children:"Language"}),e.jsxs(se,{value:y,onChange:t=>w(t.target.value),label:"Language",children:[e.jsx(q,{value:"vi",children:"VN"})," ",e.jsx(q,{value:"en",children:"EN"})," "]})]}),e.jsx(D,{label:"Description",fullWidth:!0,value:s.description,onChange:t=>S(a,"description",t.target.value),margin:"normal"}),e.jsx(D,{label:"Price",type:"number",fullWidth:!0,value:s.price,onChange:t=>S(a,"price",Number(t.target.value)),margin:"normal"}),e.jsx(D,{label:"Price Type",fullWidth:!0,value:s.priceType,onChange:t=>S(a,"priceType",t.target.value),margin:"normal"}),e.jsx(D,{label:"Discount",type:"number",fullWidth:!0,value:s.discount,onChange:t=>S(a,"discount",Number(t.target.value)),margin:"normal"}),e.jsx(d,{onClick:()=>J(a),children:"Remove Translation"})]},a))]}),e.jsxs("div",{children:[e.jsx(d,{variant:"outlined",onClick:K,children:"Add Media"}),n.map((s,a)=>e.jsxs(o,{container:!0,children:[e.jsx(o,{item:!0,children:e.jsx("input",{type:"file",accept:"image/*",onChange:t=>X(t,a)})}),e.jsx(o,{item:!0,children:e.jsx(d,{onClick:()=>Q(a),children:"Remove"})})]},a))]}),e.jsxs("div",{children:["Photo Display:",e.jsx("input",{type:"file",accept:"image/*",onChange:s=>v(s.target.files?s.target.files[0]:null)})]})]}),e.jsxs(_,{children:[e.jsx(d,{onClick:i,color:"primary",children:"Cancel"}),e.jsx(d,{onClick:F,color:"primary",children:"Create"})]})]})}function le(){var v,C,b,h,p;const{id:m}=Y(),[i,R]=r.useState(null),[k,j]=r.useState(!0),[L,x]=r.useState(!1),W=Z(),[T,P]=r.useState(!1),[f,B]=r.useState(null),N=n=>{B(n),P(!0)},I=()=>{P(!1)},y=async()=>{if(f)try{const n=localStorage.getItem("accessToken");if(!n){console.error("No access token found");return}const c=await H.delete(`https://api.localtour.space/api/PlaceActivity/delete?placeid=${i.id}&activityid=${f.id}`,{headers:{Authorization:`Bearer ${n}`}});console.log("Activity deleted",c.data),await g(),P(!1)}catch(n){console.error("Error deleting activity",n)}},w=async()=>{await g(),x(!1)},g=async()=>{const n=localStorage.getItem("accessToken");if(!n){console.error("No access token found");return}try{const c=await H.get(`https://api.localtour.space/api/Place/getPlaceById?languageCode=vi&placeid=${m}`,{headers:{Authorization:`Bearer ${n}`}});R(c.data),j(!1)}catch(c){console.error("Error fetching place details",c),j(!1)}};return r.useEffect(()=>{g()},[m]),k?e.jsx($,{children:e.jsx(A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(ne,{})})}):i?(i.status,i.status,i.status,e.jsxs($,{children:[e.jsxs(A,{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(d,{variant:"outlined",color:"primary",startIcon:e.jsx(O,{icon:"eva:arrow-back-fill"}),onClick:()=>W("/owner/activity"),children:"Back to List"}),e.jsx(l,{variant:"h4",sx:{flexGrow:1,textAlign:"center"},children:"Place Detail"})]}),e.jsxs(o,{container:!0,spacing:3,children:[e.jsx(o,{item:!0,xs:12,md:4,children:e.jsx(G,{sx:{p:2,boxShadow:3},children:e.jsx(A,{mb:2,display:"flex",justifyContent:"center",children:e.jsx("img",{src:i.photoDisplay||"/placeholder.png",alt:((v=i.placeTranslations[0])==null?void 0:v.name)||"No name available",style:{width:"100%",height:"auto",maxHeight:"400px",objectFit:"cover"}})})})}),e.jsx(o,{item:!0,xs:12,md:8,children:e.jsxs(G,{sx:{p:3,boxShadow:3},children:[e.jsx(l,{variant:"h5",mb:2,children:(C=i.placeTranslations[0])==null?void 0:C.name}),e.jsxs(l,{variant:"body1",mb:2,children:["Address: ",(b=i.placeTranslations[0])==null?void 0:b.address]}),e.jsxs(l,{variant:"body1",mb:2,children:["Description: ",(h=i.placeTranslations[0])==null?void 0:h.description]}),e.jsxs(o,{container:!0,spacing:2,children:[e.jsx(o,{item:!0,xs:6,children:e.jsxs(l,{variant:"h6",children:["Opening Time: ",i.timeOpen]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(l,{variant:"h6",children:["Closing Time: ",i.timeClose]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(l,{variant:"h6",children:["Longitude: ",i.longitude]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(l,{variant:"h6",children:["Latitude: ",i.latitude]})}),e.jsx(o,{item:!0,xs:6,children:e.jsxs(l,{variant:"h6",children:["Status: ",i.status==="Approved"?"Approved":i.status==="Rejected"?"Rejected":"Pending"]})})]})]})})]}),e.jsxs(l,{variant:"h5",mb:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx("span",{children:"Place Activity"}),e.jsx(d,{variant:"contained",color:"primary",startIcon:e.jsx(O,{icon:"mingcute:add-line"}),onClick:()=>x(!0),children:"Create Activity"})]}),((p=i.placeActivities)==null?void 0:p.length)>0&&e.jsx(A,{mt:4,children:e.jsx(o,{container:!0,spacing:3,children:i.placeActivities.map(n=>{var c,F,E,M;return e.jsx(o,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(G,{sx:{p:2,boxShadow:2,borderRadius:2},children:[e.jsx(A,{display:"flex",justifyContent:"center",alignItems:"center",style:{width:"100%",height:"auto",maxHeight:"400px",backgroundColor:"#f0f0f0",borderRadius:"8px",position:"relative",overflow:"hidden"},children:n.photoDisplay?e.jsx("img",{src:n.photoDisplay,alt:((c=i.placeTranslations[0])==null?void 0:c.name)||"Unnamed Place",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx(l,{variant:"h3",style:{color:"#fff",backgroundColor:"#3f51b5",borderRadius:"50%",width:"80px",height:"80px",display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"bold"},children:((E=(F=i.placeTranslations[0])==null?void 0:F.name)==null?void 0:E.charAt(0).toUpperCase())||"N"})}),e.jsx(l,{variant:"h6",fontWeight:"bold",textAlign:"center",mb:1,children:(M=n.placeActivityTranslations[0])==null?void 0:M.activityName}),e.jsx(d,{variant:"outlined",color:"error",onClick:()=>N(n),startIcon:e.jsx(O,{icon:"eva:trash-2-fill"}),sx:{marginLeft:"auto",display:"block"}})]})},n.id)})})}),e.jsx(re,{open:L,onClose:()=>x(!1),onActivityCreated:w,placeId:m||""}),e.jsxs(z,{open:T,onClose:I,children:[e.jsx(U,{children:"Are you sure you want to delete this activity?"}),e.jsx(V,{children:e.jsx(l,{variant:"body1",children:"This action cannot be undone. Please confirm if you want to delete this activity."})}),e.jsxs(_,{children:[e.jsx(d,{onClick:I,color:"primary",children:"Cancel"}),e.jsx(d,{onClick:y,color:"error",children:"Delete"})]})]})]})):e.jsx($,{children:e.jsx(A,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(l,{variant:"h5",children:"Place not found"})})})}function ye(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsxs("title",{children:[" ",`Place Details - ${te.appName}`]})}),e.jsx(le,{})]})}export{ye as default};
