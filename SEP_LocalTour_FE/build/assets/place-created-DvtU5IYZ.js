import{r as l,j as t,k as M,m as se,y as oe,B as ne,f as le,I as re,S as ie,H as ce}from"./index-DUX23g0E.js";import{C as de}from"./config-global-BwHnWRtc.js";import{a as F}from"./axiosInstance-DCuNI-kV.js";import{M as pe,a as ue,g as me,P as ge,b as he,c as fe,T as Ce,e as Te,d as xe}from"./place-table-toolbar-C-cZK3xd.js";import{D as z,a as G,b as H,c as je}from"./DialogTitle-Bksj2ejr.js";import{A as E}from"./Autocomplete-DBpAOSAN.js";import{T as f,F as ye}from"./TextField-DgaCIWDs.js";import{G as N}from"./Grid-Bx36BDWb.js";import{F as Pe,I as Se}from"./InputLabel-6HE52FsW.js";import{S as be}from"./Select-CoLeV2jR.js";import{C as we}from"./Card-CfNpMCOC.js";import{b as Ie,c as Me,d as De,e as ke}from"./TableSortLabel-2OFHYdxw.js";import"./index-Br0q4W-C.js";import"./Checkbox-2R0jymSI.js";import"./LastPage-B31ot4Y2.js";const Le=[{label:"VN",value:"vi"},{label:"EN",value:"en"}];function ve({open:C,onClose:u,onPlaceCreated:j}){const[s,c]=l.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),[y,p]=l.useState([]),[k,P]=l.useState(!1),[L,T]=l.useState(""),[S,h]=l.useState(""),[D,b]=l.useState([]),[W,m]=l.useState([]),[d,w]=l.useState([]),[q,B]=l.useState(""),[V,r]=l.useState(""),[n,x]=l.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")});l.useEffect(()=>{C||(c({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),T(""),h(""),B(""),r(""),w([]),x({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")}))},[C,s.placeTranslations]);const v=(a,e)=>{T(a),h(e),c(o=>({...o,longitude:a,latitude:e}))},A=()=>{P(!0)},U=()=>{P(!1)};l.useEffect(()=>{(async()=>{try{const e=await F.get("https://api.localtour.space/api/Tag/getAll?Size=1000");p(e.data.items)}catch(e){console.error("Error fetching tags:",e)}})()},[]);const I=(a,e)=>{const{name:o,value:i}=a.target;c(e!==void 0?g=>{const O=[...g.placeTranslations];return O[e]={...O[e],[o]:i},{...g,placeTranslations:O}}:g=>({...g,[o]:i}))},_=a=>{const e=a.target.files;e&&e[0]&&c(o=>({...o,photoDisplay:e[0]}))},J=(a,e)=>{const o=a.target.files;o&&o.length>0?c(i=>{const g=[...i.placeMedia];return g[e]=o[0],{...i,placeMedia:g}}):c(i=>{const g=[...i.placeMedia];return g[e]=null,{...i,placeMedia:g}})},Q=()=>{c(a=>({...a,placeTranslations:[...a.placeTranslations,{languageCode:"vi",name:"",description:"",address:"",contact:""}]}))},K=a=>{c(e=>{const o=e.placeTranslations.filter((i,g)=>g!==a);return{...e,placeTranslations:o}})},X=()=>{c(a=>({...a,placeMedia:[...a.placeMedia,null]}))},Y=a=>{c(e=>{const o=e.placeMedia.filter((i,g)=>g!==a);return{...e,placeMedia:o}})},Z=(a,e)=>{c(o=>({...o,tags:e.map(i=>i.id)}))},ee=async()=>{let a=!1;const e={wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")};if(s.wardId||(e.wardId="Please select a ward.",a=!0),s.timeOpen||(e.timeOpen="Time Open is required.",a=!0),s.timeClose||(e.timeClose="Time Close is required.",a=!0),s.longitude||(e.longitude="Longitude is required.",a=!0),s.latitude||(e.latitude="Latitude is required.",a=!0),s.photoDisplay||(e.photoDisplay="PhotoDisplay is required.",a=!0),s.contactLink||(e.contactLink="Contact Link is required.",a=!0),s.tags.length===0&&(e.tags="At least one tag is required.",a=!0),s.placeMedia.length===0&&(e.placeMedia="At least one media is required.",a=!0),s.placeTranslations.forEach((o,i)=>{!o.name||!o.description||!o.address||!o.contact?(e.placeTranslations[i]="All fields are required for each translation.",a=!0):e.placeTranslations[i]=""}),a){x(e);return}try{const o=localStorage.getItem("accessToken"),i=new FormData;if(!s.wardId){alert("Please select a ward.");return}i.append("WardId",s.wardId),i.append("TimeOpen",s.timeOpen),i.append("TimeClose",s.timeClose),i.append("Longitude",parseFloat(s.longitude).toFixed(6)),i.append("Latitude",parseFloat(s.latitude).toFixed(6)),i.append("ContactLink",s.contactLink),console.log("longitude",s.longitude),console.log("latitude",s.latitude),s.tags.forEach(R=>{i.append("Tags",R)}),i.append("PlaceTranslation",JSON.stringify(s.placeTranslations)),s.photoDisplay&&i.append("PhotoDisplay",s.photoDisplay),s.placeMedia.forEach((R,We)=>{R&&i.append("PlaceMedia",R)});const O=(await F.post("https://api.localtour.space/api/Place/create",i,{headers:{Authorization:`Bearer ${o}`,"Content-Type":"multipart/form-data"}})).data;console.log("newPlace",O),alert("Place created successfully!"),j(O),u()}catch(o){console.error("Error creating place:",o),alert("Failed to create place.")}};l.useEffect(()=>{(async()=>{try{const e=await F.get("https://api.localtour.space/api/Address/Province");b(e.data)}catch(e){console.error("Error fetching provinces:",e)}})()},[]);const te=async a=>{try{const e=await F.get(`https://api.localtour.space/api/Address/District?provinceI=${a}`);m(e.data)}catch(e){console.error("Error fetching districts:",e)}},ae=async a=>{try{const e=await F.get(`https://api.localtour.space/api/Address/Ward?cityId=${a}`);console.log("Wards Response:",e.data),w(e.data)}catch(e){console.error("Error fetching wards:",e)}};return t.jsxs(z,{open:C,onClose:u,maxWidth:"sm",fullWidth:!0,children:[t.jsx(G,{children:"New Place"}),t.jsxs(H,{children:[t.jsx(E,{fullWidth:!0,options:D,getOptionLabel:a=>a.name,onChange:(a,e)=>{B((e==null?void 0:e.id)||""),r(""),w([]),te(e==null?void 0:e.id)},renderInput:a=>t.jsx(f,{...a,label:"Province"})}),t.jsx(E,{fullWidth:!0,options:W,getOptionLabel:a=>a.name,onChange:(a,e)=>{r((e==null?void 0:e.id)||""),ae(e==null?void 0:e.id)},renderInput:a=>t.jsx(f,{...a,label:"District"})}),t.jsx(E,{fullWidth:!0,options:d,getOptionLabel:a=>a.wardName||"",value:d.find(a=>a.id===s.wardId)||null,onChange:(a,e)=>{c(o=>({...o,wardId:(e==null?void 0:e.id)||""}))},renderInput:a=>t.jsxs(t.Fragment,{children:[t.jsx(f,{...a,label:"Ward",error:!!n.wardId}),n.wardId&&t.jsx(ye,{error:!0,children:n.wardId})]}),isOptionEqualToValue:(a,e)=>a.id===(e==null?void 0:e.id)}),t.jsx(f,{fullWidth:!0,label:"Time Open",name:"timeOpen",type:"time",value:s.timeOpen,onChange:I,margin:"normal",inputProps:{step:300},error:!!n.timeOpen,helperText:n.timeOpen}),t.jsx(f,{fullWidth:!0,label:"Time Close",name:"timeClose",type:"time",value:s.timeClose,onChange:I,margin:"normal",inputProps:{step:300},error:!!n.timeClose,helperText:n.timeClose}),t.jsx(f,{fullWidth:!0,label:"Longitude",name:"longitude",value:s.longitude,onChange:a=>T(a.target.value),margin:"normal",error:!!n.longitude,helperText:n.longitude}),t.jsx(f,{fullWidth:!0,label:"Latitude",name:"latitude",value:s.latitude,onChange:a=>h(a.target.value),margin:"normal",error:!!n.latitude,helperText:n.latitude}),t.jsx(M,{onClick:A,variant:"outlined",children:"Choose on Map"}),t.jsxs(z,{open:k,onClose:()=>P(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(G,{children:"Select Location on Map"}),t.jsx(H,{children:t.jsx(pe,{latitude:parseFloat(S)||10.762622,longitude:parseFloat(L)||106.827153,onLocationSelect:v,onCloseMap:U})})]}),t.jsx(f,{fullWidth:!0,label:"Contact Link",name:"contactLink",value:s.contactLink,onChange:I,margin:"normal",error:!!n.contactLink,helperText:n.contactLink}),t.jsx(E,{multiple:!0,id:"tags",options:y,getOptionLabel:a=>a.tagName,onChange:Z,renderInput:a=>t.jsx(f,{...a,label:"Tags",error:!!n.tags,helperText:n.tags})}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("div",{style:{fontWeight:"bold"},children:"Photo Display"}),t.jsx("input",{type:"file",accept:"image/*",id:"photoDisplay",onChange:_}),n.photoDisplay&&t.jsx("div",{style:{color:"red"},children:n.photoDisplay})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(M,{variant:"outlined",onClick:X,children:"Add Place Media"}),s.placeMedia.map((a,e)=>t.jsxs(N,{container:!0,spacing:2,alignItems:"center",style:{marginTop:"10px"},children:[t.jsxs(N,{item:!0,children:[t.jsxs("label",{htmlFor:`placeMedia-${e}`,children:["Media ",e+1]}),t.jsx("input",{type:"file",accept:"image/*",id:`placeMedia-${e}`,onChange:o=>J(o,e)})]}),t.jsx(N,{item:!0,children:t.jsx(M,{variant:"contained",color:"error",onClick:()=>Y(e),children:"Remove"})})]},e)),n.placeMedia&&t.jsx("div",{style:{color:"red"},children:n.placeMedia})]}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(M,{variant:"outlined",onClick:Q,children:"Add Place Translation"}),s.placeTranslations.map((a,e)=>t.jsxs("div",{style:{marginTop:"15px"},children:[t.jsxs(Pe,{fullWidth:!0,margin:"normal",children:[t.jsx(Se,{children:"Language Code"}),t.jsx(be,{label:"Language Code",name:"languageCode",value:a.languageCode,onChange:o=>I(o,e),children:Le.map(o=>t.jsx(se,{value:o.value,children:o.label},o.value))})]}),t.jsx(f,{fullWidth:!0,label:`Name ${e+1}`,name:"name",value:a.name,onChange:o=>I(o,e),margin:"normal",error:!!n.placeTranslations[e],helperText:n.placeTranslations[e]}),t.jsx(f,{fullWidth:!0,label:`Description ${e+1}`,name:"description",value:a.description,onChange:o=>I(o,e),margin:"normal",error:!!n.placeTranslations[e],helperText:n.placeTranslations[e]}),t.jsx(f,{fullWidth:!0,label:`Address ${e+1}`,name:"address",value:a.address,onChange:o=>I(o,e),margin:"normal",error:!!n.placeTranslations[e],helperText:n.placeTranslations[e]}),t.jsx(f,{fullWidth:!0,label:`Contact ${e+1}`,name:"contact",value:a.contact,onChange:o=>I(o,e),margin:"normal",error:!!n.placeTranslations[e],helperText:n.placeTranslations[e]}),t.jsx(M,{variant:"outlined",color:"error",onClick:()=>K(e),style:{marginTop:"10px"},children:"Remove Translation"})]},e))]})]}),t.jsxs(je,{children:[t.jsx(M,{onClick:u,color:"secondary",children:"Cancel"}),t.jsx(M,{onClick:ee,color:"primary",children:"Submit"})]})]})}const $=async(C=1,u=5,j="vi",s="",c="")=>{const y=localStorage.getItem("accessToken");if(console.log("Access Token:",y),!y)return console.error("No access token found"),{items:[],totalCount:0};try{const p=await F.get(`https://api.localtour.space/api/Place/getAllByRole?LanguageCode=${j}&Page=${C}&Size=${u}&SearchTerm=${encodeURIComponent(s)}&Status=${c}`,{headers:{Authorization:`Bearer ${y}`}});return console.log("API Response:",p.data),{items:p.data.items,totalCount:p.data.totalCount}}catch(p){return console.error("Error fetching places",p),{items:[],totalCount:0}}};function Oe(){const[C,u]=l.useState([]),[j,s]=l.useState(0),[c,y]=l.useState(""),[p,k]=l.useState("vi"),[P,L]=l.useState(!1),[T,S]=l.useState(1),[h,D]=l.useState(5),[b,W]=l.useState("");l.useEffect(()=>{(async()=>{const{items:n,totalCount:x}=await $(T,h,p,c,b);u(n),s(x)})()},[T,h,p,c,b]);const m=async r=>{const n={...r,status:r.status??"0",isVerified:r.isVerified??!1,photoDisplay:r.photoDisplay};u(A=>[...A,n]),s(A=>A+1);const{items:x,totalCount:v}=await $(T,h,p);u(x),s(v)},d=Fe(),w=ue({inputData:C,comparator:me(d.order,d.orderBy),filterName:c,filterStatus:b}),q=r=>{u(n=>n.filter(x=>x.id!==r))},B=async r=>{u(x=>x.map(v=>v.id===r.id?r:v));const{items:n}=await $(T,h,p,c,b);u(n)},V=!w.length&&!!c;return t.jsxs(oe,{children:[t.jsxs(ne,{display:"flex",alignItems:"center",mb:5,children:[t.jsx(le,{variant:"h4",flexGrow:1,children:"Places"}),t.jsx(M,{variant:"contained",color:"inherit",startIcon:t.jsx(re,{icon:"mingcute:add-line"}),onClick:()=>L(!0),children:"New place"})]}),t.jsxs(we,{children:[t.jsx(ge,{numSelected:d.selected.length,filterName:c,onFilterName:r=>{y(r.target.value),S(1)},onFilterStatus:r=>{W(r||""),S(1)}}),t.jsx(ie,{children:t.jsx(Ie,{sx:{overflow:"unset"},children:t.jsxs(Me,{sx:{minWidth:800},children:[t.jsx(he,{order:d.order,orderBy:d.orderBy,rowCount:C.length,numSelected:d.selected.length,onSort:d.onSort,onSelectAllRows:r=>d.onSelectAllRows(r,C.map(n=>n.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),t.jsxs(De,{children:[w.slice(d.page*h,d.page*h+h).map(r=>t.jsx(fe,{row:r,selected:d.selected.includes(r.id),onSelectRow:()=>d.onSelectRow(r.id),onDeletePlace:q,onUpdatePlace:B},r.id)),t.jsx(Ce,{height:68,emptyRows:Te(d.page,d.rowsPerPage,C.length)}),V&&t.jsx(xe,{searchQuery:c})]})]})})}),t.jsx(ke,{component:"div",page:T-1,count:j,rowsPerPage:h,onPageChange:(r,n)=>S(n+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:r=>{D(parseInt(r.target.value,10)),S(1)}})]}),t.jsx(ve,{open:P,onClose:()=>L(!1),onPlaceCreated:m})]})}function Fe(){const[C,u]=l.useState(0),[j,s]=l.useState("name"),[c,y]=l.useState(5),[p,k]=l.useState([]),[P,L]=l.useState("asc"),T=l.useCallback(m=>{L(j===m&&P==="asc"?"desc":"asc"),s(m)},[P,j]),S=l.useCallback((m,d)=>{if(m){k(d);return}k([])},[]),h=l.useCallback(m=>{const d=p.includes(m)?p.filter(w=>w!==m):[...p,m];k(d)},[p]),D=l.useCallback(()=>{u(0)},[]),b=l.useCallback((m,d)=>{u(d)},[]),W=l.useCallback(m=>{y(parseInt(m.target.value,10)),D()},[D]);return{page:C,order:P,onSort:T,orderBy:j,selected:p,rowsPerPage:c,onSelectRow:h,onResetPage:D,onChangePage:b,onSelectAllRows:S,onChangeRowsPerPage:W}}function Ke(){return t.jsxs(t.Fragment,{children:[t.jsx(ce,{children:t.jsxs("title",{children:[" ",`Places Created - ${de.appName}`]})}),t.jsx(Oe,{})]})}export{Ke as default};
