import{j as e,B as P,T as v,r,w as E,A as L,I as T,C as z,y as k,p as F,M as H,t as I,x as M,h as R,D as W,z as V,H as U}from"./index-D4PwaD5N.js";import{C as G}from"./config-global-DYC5wpSI.js";import{a as O}from"./axiosInstance-Q6XP8Ys3.js";import{c as N,d as m,b as Q,T as q,a as J,e as K}from"./TableRow-B7nkHKsf.js";import{C as $}from"./Checkbox-B4qOLwXZ.js";import{b as X,T as Y,a as Z}from"./TableSortLabel-CWuwd1kD.js";import{O as _}from"./Select-545m9gIo.js";import{I as ee}from"./InputAdornment-BfKJzYYN.js";import{C as te}from"./Card-CkOvGVvy.js";import"./useFormControl-BxpVqGaN.js";import"./Popper-ChwOFtB3.js";import"./LastPage-B1ewK7Uw.js";function se({searchQuery:t,...a}){return e.jsx(N,{...a,children:e.jsx(m,{align:"center",colSpan:7,children:e.jsxs(P,{sx:{py:15,textAlign:"center"},children:[e.jsx(v,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(v,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function ne({row:t,selected:a,onSelectRow:i}){var f,g,S,j;const[d,o]=r.useState(null),h=E();r.useCallback(c=>{c.stopPropagation(),o(c.currentTarget)},[]);const u=r.useCallback(()=>{o(null)},[]),s=c=>{c.stopPropagation(),h(`/place/${t.id}`)},p=c=>{c.target instanceof HTMLButtonElement||c.target instanceof HTMLInputElement||h(`/place/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,onClick:p,children:[e.jsx(m,{padding:"checkbox",children:e.jsx($,{disableRipple:!0,checked:a,onChange:i})}),e.jsx(m,{component:"th",scope:"row",children:e.jsxs(P,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(L,{alt:((f=t.placeTranslation[0])==null?void 0:f.name)||"N/A",src:t.photoDisplay}),((g=t.placeTranslation[0])==null?void 0:g.name)||"N/A"]})}),e.jsx(m,{children:((S=t.placeTranslation[0])==null?void 0:S.address)||"N/A"}),e.jsx(m,{children:((j=t.placeTranslation[0])==null?void 0:j.description)||"N/A"}),e.jsx(m,{children:t.wardName||"N/A"}),e.jsx(m,{align:"center",children:t.status==="Pending"?"-":e.jsx(T,{width:22,icon:"solar:check-circle-bold",sx:{color:"success.main"}})}),e.jsx(m,{children:e.jsx(z,{color:t.status==="Pending"?"warning":t.status==="Approved"?"success":t.status==="Rejected"?"error":"default",children:t.status})}),e.jsx(m,{align:"right",children:e.jsxs(k,{onClick:s,children:[" ",e.jsx(T,{icon:"eva:arrow-forward-outline",width:22})]})})]}),e.jsx(F,{open:!!d,anchorEl:d,onClose:u,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(H,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${I.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${I.selected}`]:{bgcolor:"action.selected"}}}})})]})}const ae={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function re(t,a,i){return t?Math.max(0,(1+t)*a-i):0}const oe=(t,a)=>(i,d)=>{if(a==="status"){const o=Number(i.status),h=Number(d.status);return t==="asc"?o-h:h-o}return 0},ie=({inputData:t,comparator:a,filterName:i,filterStatus:d})=>{const o=[...t];return o.sort(a),o};function le({order:t,onSort:a,orderBy:i,rowCount:d,headLabel:o,numSelected:h,onSelectAllRows:u}){return e.jsx(Q,{children:e.jsxs(N,{children:[e.jsx(m,{padding:"checkbox",children:e.jsx($,{indeterminate:h>0&&h<d,checked:d>0&&h===d,onChange:s=>u(s.target.checked)})}),o.map(s=>e.jsx(m,{align:s.align||"left",sortDirection:i===s.id?t:!1,sx:{width:s.width,minWidth:s.minWidth},children:e.jsxs(X,{hideSortIcon:!0,active:i===s.id,direction:i===s.id?t:"asc",onClick:()=>a(s.id),children:[s.label,i===s.id?e.jsx(P,{sx:{...ae},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}function ce({emptyRows:t,height:a,sx:i,...d}){return t?e.jsx(N,{sx:{...a&&{height:a*t},...i},...d,children:e.jsx(m,{colSpan:9})}):null}const de=async t=>{try{return(await O.get(`https://api.localtour.space/api/ModTag/UserTags/${t}`)).data.tags}catch(a){return console.error("Error fetching user districts:",a),[]}};function ue({numSelected:t,filterName:a,onFilterName:i,onFilterStatus:d,userId:o,onDistrictSelect:h}){const[u,s]=r.useState(null),[p,f]=r.useState(null),[g,S]=r.useState([]),[j,c]=r.useState([]);r.useEffect(()=>{(async()=>{const l=await de(o);S(l)})()},[o]);const b=n=>{c(l=>{const A=l.includes(n)?l.filter(B=>B!==n):[...l,n];return h(A),A})},C=n=>{const l=n==="All"?"":n;f(l),d(l),s(null)},D=n=>{s(n.currentTarget)},x=()=>{s(null)},w=!!u;return e.jsxs(M,{sx:{height:96,display:"flex",justifyContent:"space-between",p:n=>n.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(v,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(_,{fullWidth:!0,value:a,onChange:i,placeholder:"Search place...",startAdornment:e.jsx(ee,{position:"start",children:e.jsx(T,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),e.jsx(P,{sx:{display:"flex",flexDirection:"row",gap:2},children:Array.isArray(g)&&g.length>0?g.map(n=>e.jsx(R,{onClick:()=>b(n.cityId),variant:j.includes(n.cityId)?"contained":"outlined",children:n.cityName},n.cityId)):e.jsx(v,{children:"No districts available"})}),t>0?e.jsx(k,{children:e.jsx(T,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{title:"Filter list",children:e.jsx(k,{onClick:D,children:e.jsx(T,{icon:"ic:round-filter-list"})})}),e.jsx(F,{open:w,anchorEl:u,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(P,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(n=>e.jsx(R,{variant:p===(n==="All"?null:n)?"contained":"outlined",onClick:()=>C(n==="All"?null:n),sx:{color:p===(n==="All"?null:n)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:n},n))})})]})]})}const he=async(t=1,a=5,i="vi",d="",o="",h=[])=>{const u=localStorage.getItem("accessToken");if(console.log("Access Token:",u),!u)return console.error("No access token found"),{items:[],totalCount:0};try{let s=`https://api.localtour.space/api/Place/getAllByRole?LanguageCode=${i}&Page=${t}&Size=${a}&SearchTerm=${encodeURIComponent(d)}&Status=${o}`;h.length>0&&(s+=`&DistrictNCityIds=${h.join("&DistrictNCityIds=")}`);const p=await O.get(s,{headers:{Authorization:`Bearer ${u}`}});return console.log("API Response:",p.data),{items:p.data.items,totalCount:p.data.totalCount}}catch(s){return console.error("Error fetching places",s),{items:[],totalCount:0}}};function pe(){const[t,a]=r.useState([]),[i,d]=r.useState(0),[o,h]=r.useState(""),[u,s]=r.useState("vi"),[p,f]=r.useState(1),[g,S]=r.useState(5),[j,c]=r.useState(""),[b,C]=r.useState([]),D=localStorage.getItem("userId");r.useEffect(()=>{(async()=>{const{items:y,totalCount:A}=await he(p,g,u,o,j,b);a(y),d(A)})()},[p,g,u,o,j,b]);const x=xe(),w=ie({inputData:t,comparator:oe(x.order,x.orderBy),filterName:o,filterStatus:j}),n=!w.length&&!!o;return e.jsxs(W,{children:[e.jsx(P,{display:"flex",alignItems:"center",mb:5,children:e.jsx(v,{variant:"h4",flexGrow:1,children:"Places"})}),e.jsxs(te,{children:[e.jsx(ue,{numSelected:x.selected.length,filterName:o,onFilterName:l=>{h(l.target.value),f(1)},onFilterStatus:l=>{c(l||""),f(1)},userId:D||"",onDistrictSelect:C}),e.jsx(V,{children:e.jsx(q,{sx:{overflow:"unset"},children:e.jsxs(J,{sx:{minWidth:800},children:[e.jsx(le,{order:x.order,orderBy:x.orderBy,rowCount:t.length,numSelected:x.selected.length,onSort:x.onSort,onSelectAllRows:l=>x.onSelectAllRows(l,t.map(y=>y.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"wardName",label:"WardName"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),e.jsxs(K,{children:[w.slice(x.page*g,x.page*g+g).map(l=>e.jsx(ne,{row:l,selected:x.selected.includes(l.id),onSelectRow:()=>x.onSelectRow(l.id)},l.id)),e.jsx(ce,{height:68,emptyRows:re(x.page,x.rowsPerPage,t.length)}),n&&e.jsx(se,{searchQuery:o})]})]})})}),e.jsx(Z,{component:"div",page:p-1,count:i,rowsPerPage:g,onPageChange:(l,y)=>f(y+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:l=>{S(parseInt(l.target.value,10)),f(1)}})]})]})}function xe(){const[t,a]=r.useState(0),[i,d]=r.useState("name"),[o,h]=r.useState(5),[u,s]=r.useState([]),[p,f]=r.useState("asc"),g=r.useCallback(c=>{f(i===c&&p==="asc"?"desc":"asc"),d(c)},[p,i]),S=r.useCallback((c,b)=>{if(c){s(b);return}s([])},[]),j=r.useCallback(c=>{const b=u.includes(c)?u.filter(C=>C!==c):[...u,c];s(b)},[u]);return{order:p,orderBy:i,rowsPerPage:o,selected:u,page:t,onSort:g,onSelectAllRows:S,onSelectRow:j,onResetPage:()=>a(0)}}function Ae(){return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsxs("title",{children:[" ",`Places - ${G.appName}`]})}),e.jsx(pe,{})]})}export{Ae as default};
