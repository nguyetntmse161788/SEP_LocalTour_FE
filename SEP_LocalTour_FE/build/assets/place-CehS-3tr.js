import{j as e,B as C,f as T,r,K as L,A as H,I as y,Q as M,l as k,P as O,M as z,m as I,n as R,N as W,J as V,k as F,O as U,y as G,S as Q,H as J}from"./index-DUX23g0E.js";import{C as K}from"./config-global-BwHnWRtc.js";import{a as E}from"./axiosInstance-DCuNI-kV.js";import{T as N,a as j,f as q,g as X,b as Y,c as Z,d as _,e as ee}from"./TableSortLabel-2OFHYdxw.js";import{C as $}from"./Checkbox-2R0jymSI.js";import{O as te}from"./Select-CoLeV2jR.js";import{C as se}from"./Card-CfNpMCOC.js";import"./index-Br0q4W-C.js";import"./LastPage-B31ot4Y2.js";function ne({searchQuery:t,...a}){return e.jsx(N,{...a,children:e.jsx(j,{align:"center",colSpan:7,children:e.jsxs(C,{sx:{py:15,textAlign:"center"},children:[e.jsx(T,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(T,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',t,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function ae({row:t,selected:a,onSelectRow:i}){var g,S,b,m;const[c,o]=r.useState(null),h=L(),d=r.useCallback(u=>{u.stopPropagation(),o(u.currentTarget)},[]),s=r.useCallback(()=>{o(null)},[]),p=u=>{u.stopPropagation(),h(`/place/${t.id}`)},f=u=>{u.target instanceof HTMLButtonElement||u.target instanceof HTMLInputElement||h(`/place/${t.id}`)};return e.jsxs(e.Fragment,{children:[e.jsxs(N,{hover:!0,tabIndex:-1,role:"checkbox",selected:a,onClick:f,children:[e.jsx(j,{padding:"checkbox",children:e.jsx($,{disableRipple:!0,checked:a,onChange:i})}),e.jsx(j,{component:"th",scope:"row",children:e.jsxs(C,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(H,{alt:((g=t.placeTranslation[0])==null?void 0:g.name)||"N/A",src:t.photoDisplay}),((S=t.placeTranslation[0])==null?void 0:S.name)||"N/A"]})}),e.jsx(j,{children:((b=t.placeTranslation[0])==null?void 0:b.address)||"N/A"}),e.jsx(j,{children:((m=t.placeTranslation[0])==null?void 0:m.description)||"N/A"}),e.jsx(j,{children:t.wardName||"N/A"}),e.jsx(j,{align:"center",children:t.status==="Pending"?"-":e.jsx(y,{width:22,icon:"solar:check-circle-bold",sx:{color:"success.main"}})}),e.jsx(j,{children:e.jsx(M,{color:t.status==="Pending"?"warning":t.status==="Approved"?"success":t.status==="Rejected"?"error":"default",children:t.status})}),e.jsx(j,{align:"right",children:e.jsxs(k,{onClick:p,children:[" ",e.jsx(y,{icon:"eva:arrow-forward-outline",width:22})]})}),e.jsx(j,{align:"right",children:e.jsxs(k,{onClick:d,children:[" ",e.jsx(y,{icon:"eva:more-vertical-fill",width:22})]})})]}),e.jsx(O,{open:!!c,anchorEl:c,onClose:s,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsxs(z,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column",[`& .${R.root}`]:{px:1,gap:2,borderRadius:.75,[`&.${R.selected}`]:{bgcolor:"action.selected"}}},children:[e.jsxs(I,{onClick:s,children:[e.jsx(y,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(I,{onClick:s,sx:{color:"error.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})})]})}const re={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function oe(t,a,i){return t?Math.max(0,(1+t)*a-i):0}const ie=(t,a)=>(i,c)=>{if(a==="status"){const o=Number(i.status),h=Number(c.status);return t==="asc"?o-h:h-o}return 0},le=({inputData:t,comparator:a,filterName:i,filterStatus:c})=>{const o=[...t];return o.sort(a),o};function ce({order:t,onSort:a,orderBy:i,rowCount:c,headLabel:o,numSelected:h,onSelectAllRows:d}){return e.jsx(q,{children:e.jsxs(N,{children:[e.jsx(j,{padding:"checkbox",children:e.jsx($,{indeterminate:h>0&&h<c,checked:c>0&&h===c,onChange:s=>d(s.target.checked)})}),o.map(s=>e.jsx(j,{align:s.align||"left",sortDirection:i===s.id?t:!1,sx:{width:s.width,minWidth:s.minWidth},children:e.jsxs(X,{hideSortIcon:!0,active:i===s.id,direction:i===s.id?t:"asc",onClick:()=>a(s.id),children:[s.label,i===s.id?e.jsx(C,{sx:{...re},children:t==="desc"?"sorted descending":"sorted ascending"}):null]})},s.id))]})})}function de({emptyRows:t,height:a,sx:i,...c}){return t?e.jsx(N,{sx:{...a&&{height:a*t},...i},...c,children:e.jsx(j,{colSpan:9})}):null}const he=async t=>{try{return(await E.get(`https://api.localtour.space/api/ModTag/UserTags/${t}`)).data.tags}catch(a){return console.error("Error fetching user districts:",a),[]}};function ue({numSelected:t,filterName:a,onFilterName:i,onFilterStatus:c,userId:o,onDistrictSelect:h}){const[d,s]=r.useState(null),[p,f]=r.useState(null),[g,S]=r.useState([]),[b,m]=r.useState([]);r.useEffect(()=>{(async()=>{const l=await he(o);S(l)})()},[o]);const u=n=>{m(l=>{const A=l.includes(n)?l.filter(B=>B!==n):[...l,n];return h(A),A})},v=n=>{const l=n==="All"?"":n;f(l),c(l),s(null)},D=n=>{s(n.currentTarget)},x=()=>{s(null)},w=!!d;return e.jsxs(W,{sx:{height:96,display:"flex",justifyContent:"space-between",p:n=>n.spacing(0,1,0,3),...t>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[t>0?e.jsxs(T,{component:"div",variant:"subtitle1",children:[t," selected"]}):e.jsx(te,{fullWidth:!0,value:a,onChange:i,placeholder:"Search place...",startAdornment:e.jsx(V,{position:"start",children:e.jsx(y,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),e.jsx(C,{sx:{display:"flex",flexDirection:"row",gap:2},children:Array.isArray(g)&&g.length>0?g.map(n=>e.jsx(F,{onClick:()=>u(n.cityId),variant:b.includes(n.cityId)?"contained":"outlined",children:n.cityName},n.cityId)):e.jsx(T,{children:"No districts available"})}),t>0?e.jsx(k,{children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})}):e.jsxs(e.Fragment,{children:[e.jsx(U,{title:"Filter list",children:e.jsx(k,{onClick:D,children:e.jsx(y,{icon:"ic:round-filter-list"})})}),e.jsx(O,{open:w,anchorEl:d,onClose:x,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:e.jsx(C,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(n=>e.jsx(F,{variant:p===(n==="All"?null:n)?"contained":"outlined",onClick:()=>v(n==="All"?null:n),sx:{color:p===(n==="All"?null:n)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:n},n))})})]})]})}const pe=async(t=1,a=5,i="vi",c="",o="",h=[])=>{const d=localStorage.getItem("accessToken");if(console.log("Access Token:",d),!d)return console.error("No access token found"),{items:[],totalCount:0};try{let s=`https://api.localtour.space/api/Place/getAllByRole?LanguageCode=${i}&Page=${t}&Size=${a}&SearchTerm=${encodeURIComponent(c)}&Status=${o}`;h.length>0&&(s+=`&DistrictNCityIds=${h.join("&DistrictNCityIds=")}`);const p=await E.get(s,{headers:{Authorization:`Bearer ${d}`}});return console.log("API Response:",p.data),{items:p.data.items,totalCount:p.data.totalCount}}catch(s){return console.error("Error fetching places",s),{items:[],totalCount:0}}};function xe(){const[t,a]=r.useState([]),[i,c]=r.useState(0),[o,h]=r.useState(""),[d,s]=r.useState("vi"),[p,f]=r.useState(1),[g,S]=r.useState(5),[b,m]=r.useState(""),[u,v]=r.useState([]),D=localStorage.getItem("userId");r.useEffect(()=>{(async()=>{const{items:P,totalCount:A}=await pe(p,g,d,o,b,u);a(P),c(A)})()},[p,g,d,o,b,u]);const x=ge(),w=le({inputData:t,comparator:ie(x.order,x.orderBy),filterName:o,filterStatus:b}),n=!w.length&&!!o;return e.jsxs(G,{children:[e.jsx(C,{display:"flex",alignItems:"center",mb:5,children:e.jsx(T,{variant:"h4",flexGrow:1,children:"Places"})}),e.jsxs(se,{children:[e.jsx(ue,{numSelected:x.selected.length,filterName:o,onFilterName:l=>{h(l.target.value),f(1)},onFilterStatus:l=>{m(l||""),f(1)},userId:D||"",onDistrictSelect:v}),e.jsx(Q,{children:e.jsx(Y,{sx:{overflow:"unset"},children:e.jsxs(Z,{sx:{minWidth:800},children:[e.jsx(ce,{order:x.order,orderBy:x.orderBy,rowCount:t.length,numSelected:x.selected.length,onSort:x.onSort,onSelectAllRows:l=>x.onSelectAllRows(l,t.map(P=>P.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"wardName",label:"WardName"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),e.jsxs(_,{children:[w.slice(x.page*g,x.page*g+g).map(l=>e.jsx(ae,{row:l,selected:x.selected.includes(l.id),onSelectRow:()=>x.onSelectRow(l.id)},l.id)),e.jsx(de,{height:68,emptyRows:oe(x.page,x.rowsPerPage,t.length)}),n&&e.jsx(ne,{searchQuery:o})]})]})})}),e.jsx(ee,{component:"div",page:p-1,count:i,rowsPerPage:g,onPageChange:(l,P)=>f(P+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:l=>{S(parseInt(l.target.value,10)),f(1)}})]})]})}function ge(){const[t,a]=r.useState(0),[i,c]=r.useState("name"),[o,h]=r.useState(5),[d,s]=r.useState([]),[p,f]=r.useState("asc"),g=r.useCallback(m=>{f(i===m&&p==="asc"?"desc":"asc"),c(m)},[p,i]),S=r.useCallback((m,u)=>{if(m){s(u);return}s([])},[]),b=r.useCallback(m=>{const u=d.includes(m)?d.filter(v=>v!==m):[...d,m];s(u)},[d]);return{order:p,orderBy:i,rowsPerPage:o,selected:d,page:t,onSort:g,onSelectAllRows:S,onSelectRow:b,onResetPage:()=>a(0)}}function Te(){return e.jsxs(e.Fragment,{children:[e.jsx(J,{children:e.jsxs("title",{children:[" ",`Places - ${K.appName}`]})}),e.jsx(xe,{})]})}export{Te as default};
