import{r as a,O as U,j as e,m as H,n as j,a0 as M,B as F,A as V,I as y,a1 as z,V as N,E as G,M as Q,F as E,h as B,D as W,T as Y,C as q,Y as J,i as K,k as X,o as Z,$ as _,H as ee}from"./index-z39hXFLl.js";import{C as te}from"./config-global-BwHnWRtc.js";import{a as $}from"./axiosInstance-Xq098mIU.js";import{U as ae,a as se,g as oe,P as ne,b as le,T as re,e as ce,c as ie}from"./place-table-toolbar-nCcx8wMk.js";import{D as de,a as pe,b as ue,c as he}from"./DialogTitle-Dgc1Aws8.js";import"./Autocomplete-_rkQI0np.js";import"./TextField-B2lMQ9Li.js";import"./InputLabel-D6bSjKO1.js";function ge({row:t,selected:u,onSelectRow:h,onDeletePlace:P,onUpdatePlace:c}){var R,v,A,I;const[g,n]=a.useState(null),[C,d]=a.useState(!1),[x,i]=a.useState(!1),[S,f]=a.useState(""),r=U(),[o,T]=a.useState([]),D=a.useCallback(l=>{l.stopPropagation(),n(l.currentTarget)},[]),b=a.useCallback(()=>{n(null)},[]),k=l=>{l.stopPropagation(),r(`/owner/place/${t.id}`)},s=l=>{f(l),i(!0),b()},p=l=>{l.target instanceof HTMLButtonElement||l.target instanceof HTMLInputElement||r(`/owner/place/${t.id}`)},m=async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{await $.delete(`https://api.localtour.space/api/Place/delete?placeid=${t.id}`,{headers:{Authorization:`Bearer ${l}`}}),P(t.id)}catch(L){console.error("Error deleting place:",L)}d(!1)},w=()=>{d(!1)},O=l=>{c(l),i(!1)};return e.jsxs(e.Fragment,{children:[e.jsxs(H,{hover:!0,tabIndex:-1,role:"checkbox",selected:u,onClick:p,children:[e.jsx(j,{padding:"checkbox",children:e.jsx(M,{disableRipple:!0,checked:u,onChange:h})}),e.jsx(j,{component:"th",scope:"row",children:e.jsxs(F,{gap:2,display:"flex",alignItems:"center",children:[e.jsx(V,{alt:((R=t.placeTranslation[0])==null?void 0:R.name)||"N/A",src:t.photoDisplay}),((v=t.placeTranslation[0])==null?void 0:v.name)||"N/A"]})}),e.jsx(j,{children:((A=t.placeTranslation[0])==null?void 0:A.address)||"N/A"}),e.jsx(j,{children:((I=t.placeTranslation[0])==null?void 0:I.description)||"N/A"}),e.jsx(j,{align:"center",children:t.status==="Pending"?"-":e.jsx(y,{width:22,icon:"solar:check-circle-bold",sx:{color:"success.main"}})}),e.jsx(j,{children:e.jsx(z,{color:t.status==="Pending"?"warning":t.status==="Approved"?"success":t.status==="Rejected"?"error":"default",children:t.status})}),e.jsx(j,{align:"right",children:e.jsx(N,{onClick:k,children:e.jsx(y,{icon:"eva:arrow-forward-outline",width:22})})}),e.jsx(j,{align:"right",children:e.jsx(N,{onClick:D,children:e.jsx(y,{icon:"eva:more-vertical-fill",width:22})})})]}),e.jsx(G,{open:!!g,anchorEl:g,onClose:b,children:e.jsxs(Q,{disablePadding:!0,sx:{p:.5,gap:.5,width:140,display:"flex",flexDirection:"column"},children:[e.jsxs(E,{onClick:()=>{s(t.id),b()},children:[e.jsx(y,{icon:"solar:pen-bold"}),"Edit"]}),e.jsxs(E,{onClick:()=>{d(!0),b()},sx:{color:"error.main"},children:[e.jsx(y,{icon:"solar:trash-bin-trash-bold"}),"Delete"]})]})}),e.jsxs(de,{open:C,onClose:w,children:[e.jsx(pe,{children:"Confirm Deletion"}),e.jsx(ue,{children:"Are you sure you want to delete this place?"}),e.jsxs(he,{children:[e.jsx(B,{onClick:w,color:"primary",children:"Cancel"}),e.jsx(B,{onClick:m,color:"error",children:"Delete"})]})]}),e.jsx(ae,{open:x,placeId:S,onClose:()=>i(!1),onPlaceUpdated:O})]})}const xe=async(t=1,u=5,h="vi",P="",c="")=>{const g=localStorage.getItem("accessToken");if(console.log("Access Token:",g),!g)return console.error("No access token found"),{items:[],totalCount:0};try{const n=await $.get(`https://api.localtour.space/api/Place/getAll?LanguageCode=${h}&Page=${t}&Size=${u}&SearchTerm=${encodeURIComponent(P)}&Status=${c}`,{headers:{Authorization:`Bearer ${g}`}});return console.log("API Response:",n.data),{items:n.data.items,totalCount:n.data.totalCount}}catch(n){return console.error("Error fetching places",n),{items:[],totalCount:0}}};function me(){const[t,u]=a.useState([]),[h,P]=a.useState(0),[c,g]=a.useState(""),[n,C]=a.useState("vi"),[d,x]=a.useState(1),[i,S]=a.useState(5),[f,r]=a.useState("");a.useEffect(()=>{(async()=>{const{items:p,totalCount:m}=await xe(d,i,n,c,f);u(p),P(m)})()},[d,i,n,c,f]);const o=je(),T=se({inputData:t,comparator:oe(o.order,o.orderBy),filterName:c,filterStatus:f}),D=s=>{u(p=>p.filter(m=>m.id!==s))},b=s=>{u(p=>p.map(m=>m.id===s.id?s:m))},k=!T.length&&!!c;return e.jsxs(W,{children:[e.jsx(F,{display:"flex",alignItems:"center",mb:5,children:e.jsx(Y,{variant:"h4",flexGrow:1,children:"Places"})}),e.jsxs(q,{children:[e.jsx(ne,{numSelected:o.selected.length,filterName:c,onFilterName:s=>{g(s.target.value),x(1)},onFilterStatus:s=>{r(s||""),x(1)}}),e.jsx(J,{children:e.jsx(K,{sx:{overflow:"unset"},children:e.jsxs(X,{sx:{minWidth:800},children:[e.jsx(le,{order:o.order,orderBy:o.orderBy,rowCount:t.length,numSelected:o.selected.length,onSort:o.onSort,onSelectAllRows:s=>o.onSelectAllRows(s,t.map(p=>p.id)),headLabel:[{id:"name",label:"Name"},{id:"address",label:"Address"},{id:"description",label:"Description"},{id:"isVerify",label:"isVerify"},{id:"status",label:"Status"},{id:"View details",label:"View details"},{id:""}]}),e.jsxs(Z,{children:[T.slice(o.page*i,o.page*i+i).map(s=>e.jsx(ge,{row:s,selected:o.selected.includes(s.id),onSelectRow:()=>o.onSelectRow(s.id),onDeletePlace:D,onUpdatePlace:b},s.id)),e.jsx(re,{height:68,emptyRows:ce(o.page,o.rowsPerPage,t.length)}),k&&e.jsx(ie,{searchQuery:c})]})]})})}),e.jsx(_,{component:"div",page:d-1,count:h,rowsPerPage:i,onPageChange:(s,p)=>x(p+1),rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s=>{S(parseInt(s.target.value,10)),x(1)}})]})]})}function je(){const[t,u]=a.useState(0),[h,P]=a.useState("name"),[c,g]=a.useState(5),[n,C]=a.useState([]),[d,x]=a.useState("asc"),i=a.useCallback(r=>{x(h===r&&d==="asc"?"desc":"asc"),P(r)},[d,h]),S=a.useCallback((r,o)=>{if(r){C(o);return}C([])},[]),f=a.useCallback(r=>{const o=n.includes(r)?n.filter(T=>T!==r):[...n,r];C(o)},[n]);return{order:d,orderBy:h,rowsPerPage:c,selected:n,page:t,onSort:i,onSelectAllRows:S,onSelectRow:f,onResetPage:()=>u(0)}}function ke(){return e.jsxs(e.Fragment,{children:[e.jsx(ee,{children:e.jsxs("title",{children:[" ",`Places - ${te.appName}`]})}),e.jsx(me,{})]})}export{ke as default};
