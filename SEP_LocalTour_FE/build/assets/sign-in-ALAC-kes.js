import{g as T,a as w,r as l,R as W,U as N,b as F,_ as D,V as M,c as f,j as n,p as C,e as A,s as $,k as O,W as U,X as B,B as k,f as b,F as z,J,l as j,I as L,D as _,H as G}from"./index-CqOrFkS9.js";import{C as H}from"./config-global-BwHnWRtc.js";import{T as E}from"./TextField-W0bFp4Lb.js";import{C as V}from"./CircularProgress-DXol546A.js";import"./Select-BH5qWtTR.js";import"./InputLabel-_37qWNMV.js";function X(t){return T("MuiLoadingButton",t)}const r=w("MuiLoadingButton",["root","loading","loadingIndicator","loadingIndicatorCenter","loadingIndicatorStart","loadingIndicatorEnd","endIconLoadingEnd","startIconLoadingStart"]),Y=["children","disabled","id","loading","loadingIndicator","loadingPosition","variant"],q=t=>{const{loading:o,loadingPosition:a,classes:d}=t,p={root:["root",o&&"loading"],startIcon:[o&&`startIconLoading${C(a)}`],endIcon:[o&&`endIconLoading${C(a)}`],loadingIndicator:["loadingIndicator",o&&`loadingIndicator${C(a)}`]},e=A(p,X,d);return f({},d,e)},K=t=>t!=="ownerState"&&t!=="theme"&&t!=="sx"&&t!=="as"&&t!=="classes",Q=$(O,{shouldForwardProp:t=>K(t)||t==="classes",name:"MuiLoadingButton",slot:"Root",overridesResolver:(t,o)=>[o.root,o.startIconLoadingStart&&{[`& .${r.startIconLoadingStart}`]:o.startIconLoadingStart},o.endIconLoadingEnd&&{[`& .${r.endIconLoadingEnd}`]:o.endIconLoadingEnd}]})(({ownerState:t,theme:o})=>f({[`& .${r.startIconLoadingStart}, & .${r.endIconLoadingEnd}`]:{transition:o.transitions.create(["opacity"],{duration:o.transitions.duration.short}),opacity:0}},t.loadingPosition==="center"&&{transition:o.transitions.create(["background-color","box-shadow","border-color"],{duration:o.transitions.duration.short}),[`&.${r.loading}`]:{color:"transparent"}},t.loadingPosition==="start"&&t.fullWidth&&{[`& .${r.startIconLoadingStart}, & .${r.endIconLoadingEnd}`]:{transition:o.transitions.create(["opacity"],{duration:o.transitions.duration.short}),opacity:0,marginRight:-8}},t.loadingPosition==="end"&&t.fullWidth&&{[`& .${r.startIconLoadingStart}, & .${r.endIconLoadingEnd}`]:{transition:o.transitions.create(["opacity"],{duration:o.transitions.duration.short}),opacity:0,marginLeft:-8}})),Z=$("span",{name:"MuiLoadingButton",slot:"LoadingIndicator",overridesResolver:(t,o)=>{const{ownerState:a}=t;return[o.loadingIndicator,o[`loadingIndicator${C(a.loadingPosition)}`]]}})(({theme:t,ownerState:o})=>f({position:"absolute",visibility:"visible",display:"flex"},o.loadingPosition==="start"&&(o.variant==="outlined"||o.variant==="contained")&&{left:o.size==="small"?10:14},o.loadingPosition==="start"&&o.variant==="text"&&{left:6},o.loadingPosition==="center"&&{left:"50%",transform:"translate(-50%)",color:(t.vars||t).palette.action.disabled},o.loadingPosition==="end"&&(o.variant==="outlined"||o.variant==="contained")&&{right:o.size==="small"?10:14},o.loadingPosition==="end"&&o.variant==="text"&&{right:6},o.loadingPosition==="start"&&o.fullWidth&&{position:"relative",left:-10},o.loadingPosition==="end"&&o.fullWidth&&{position:"relative",right:-10})),oo=l.forwardRef(function(o,a){const d=l.useContext(W),p=N(d,o),e=F({props:p,name:"MuiLoadingButton"}),{children:I,disabled:P=!1,id:y,loading:u=!1,loadingIndicator:x,loadingPosition:S="center",variant:v="text"}=e,i=D(e,Y),c=M(y),g=x??n.jsx(V,{"aria-labelledby":c,color:"inherit",size:16}),s=f({},e,{disabled:P,loading:u,loadingIndicator:g,loadingPosition:S,variant:v}),h=q(s),m=u?n.jsx(Z,{className:h.loadingIndicator,ownerState:s,children:g}):null;return n.jsxs(Q,f({disabled:P||u,id:c,ref:a},i,{variant:v,classes:h,ownerState:s,children:[s.loadingPosition==="end"?I:m,s.loadingPosition==="end"?m:I]}))});function to(){const t=U(),[o,a]=l.useState(""),[d,p]=l.useState(""),[e,I]=l.useState(!1),[P,y]=l.useState(!1),[u,x]=l.useState("");l.useEffect(()=>{const i=localStorage.getItem("accessToken"),c=localStorage.getItem("user"),g=localStorage.getItem("currentPath")||"/";if(i&&c)try{const s=B(i),h=Math.floor(Date.now()/1e3);s.exp&&s.exp>h?t.replace(g):(localStorage.clear(),t.push("/sign-in"))}catch(s){console.error("Invalid token:",s),localStorage.clear(),t.push("/sign-in")}},[t]);const S=l.useCallback(async()=>{y(!0),x("");try{const i=await fetch("https://api.localtour.space/api/Authen/login",{method:"POST",headers:{Accept:"*/*","Content-Type":"application/json"},body:JSON.stringify({phoneNumber:o,password:d})});if(!i.ok)throw new Error("Failed to sign in");const c=await i.json();localStorage.setItem("accessToken",c.accessToken);const g=B(c.accessToken),s=Array.isArray(g["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"])?g["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]:[g["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"]],h=["Administrator","Moderator","Service Owner"],m=s.filter(R=>h.includes(R));if(m.length===0)throw new Error("You do not have permission to access this page");localStorage.setItem("user",JSON.stringify(c)),localStorage.setItem("role",JSON.stringify(m)),localStorage.setItem("currentPath","/"),t.replace("/")}catch(i){x(i.message||"Invalid phone number or password")}finally{y(!1)}},[o,d,t]),v=n.jsxs(k,{display:"flex",flexDirection:"column",alignItems:"flex-end",children:[n.jsx(E,{fullWidth:!0,name:"phoneNumber",label:"Phone Number",value:o,onChange:i=>a(i.target.value),InputLabelProps:{shrink:!0},sx:{mb:3}}),n.jsx(E,{fullWidth:!0,name:"password",label:"Password",value:d,onChange:i=>p(i.target.value),InputLabelProps:{shrink:!0},type:e?"text":"password",InputProps:{endAdornment:n.jsx(J,{position:"end",children:n.jsx(j,{onClick:()=>I(!e),edge:"end",children:n.jsx(L,{icon:e?"solar:eye-bold":"solar:eye-closed-bold"})})})},sx:{mb:3}}),u&&n.jsx(b,{color:"error",sx:{mb:2},children:u}),n.jsx(oo,{fullWidth:!0,size:"large",type:"button",color:"inherit",variant:"contained",onClick:S,loading:P,children:"Sign in"})]});return n.jsxs(n.Fragment,{children:[n.jsxs(k,{gap:1.5,display:"flex",flexDirection:"column",alignItems:"center",sx:{mb:5},children:[n.jsx(b,{variant:"h5",children:"Sign in"}),n.jsxs(b,{variant:"body2",color:"text.secondary",children:["Donâ€™t have an account?",n.jsx(z,{variant:"subtitle2",sx:{ml:.5},children:"Get started"})]})]}),v,n.jsx(_,{sx:{my:3,"&::before, &::after":{borderTopStyle:"dashed"}},children:n.jsx(b,{variant:"overline",sx:{color:"text.secondary",fontWeight:"fontWeightMedium"},children:"OR"})}),n.jsxs(k,{gap:1,display:"flex",justifyContent:"center",children:[n.jsx(j,{color:"inherit",children:n.jsx(L,{icon:"logos:google-icon"})}),n.jsx(j,{color:"inherit",children:n.jsx(L,{icon:"eva:github-fill"})}),n.jsx(j,{color:"inherit",children:n.jsx(L,{icon:"ri:twitter-x-fill"})})]})]})}function lo(){return n.jsxs(n.Fragment,{children:[n.jsx(G,{children:n.jsxs("title",{children:[" ",`Sign in - ${H.appName}`]})}),n.jsx(to,{})]})}export{lo as default};
