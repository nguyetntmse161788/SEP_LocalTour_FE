import{r as i,j as e,h as y,Q,y as V,l as Y,ag as J,w as K,D as W,B as S,T as d,I as z,H as X}from"./index-D4PwaD5N.js";import{C as Z}from"./config-global-DYC5wpSI.js";import{a as R}from"./axiosInstance-Q6XP8Ys3.js";import{D as H,a as q,b as G,c as M}from"./DialogTitle-C6FRhu7J.js";import{T as P}from"./TextField-C0PbMPGO.js";import{C as _}from"./CircularProgress-DT4cvsDk.js";import{G as D}from"./Grid-BP6mOV8A.js";import{C as U}from"./Card-CkOvGVvy.js";import"./useFormControl-BxpVqGaN.js";import"./Select-545m9gIo.js";import"./InputLabel-C9R4CQou.js";function ee({open:h,onClose:o,onEventCreated:E,placeId:T}){const[C,I]=i.useState(""),[a,m]=i.useState(""),[b,w]=i.useState(null),[c,x]=i.useState({eventName:"",description:"",startDate:"",endDate:"",eventPhoto:""}),[v,k]=i.useState(()=>new Date().toISOString().slice(0,16)),[r,n]=i.useState(()=>{const t=new Date;return t.setHours(t.getHours()+1),t.toISOString().slice(0,16)}),g=t=>{const u=t.target.value;new Date(u)>=new Date(r)?x(p=>({...p,startDate:"Start Date must be earlier than End Date"})):x(p=>({...p,startDate:""})),k(u)},F=t=>{const u=t.target.value;new Date(u)<=new Date(v)?x(p=>({...p,endDate:"End Date must be later than Start Date"})):x(p=>({...p,endDate:""})),n(u)};i.useEffect(()=>{h||(I(""),m(""),k(""),n(""),w(null),x({eventName:"",description:"",startDate:"",endDate:"",eventPhoto:""}))},[h]);const B=t=>{t.target.files&&t.target.files.length>0&&w(t.target.files[0])},$=async()=>{let t=!1;const u={eventName:"",description:"",startDate:"",endDate:"",eventPhoto:""};if(C||(u.eventName="Event Name is required.",t=!0),a||(u.description="Description is required.",t=!0),v||(u.startDate="Start Date is required.",t=!0),r||(u.endDate="End Date is required.",t=!0),b||(u.eventPhoto="Event photo is required.",t=!0),t){x(u);return}try{const p=localStorage.getItem("accessToken");if(!p){console.error("No access token found");return}const L=new Date(v).toISOString(),O=new Date(r).toISOString(),f=new FormData;f.append("placeid",T),f.append("eventName",C),f.append("description",a),f.append("startDate",L),f.append("endDate",O),b&&f.append("eventPhoto",b),console.log("Data being sent to API:",f);try{const N=await R.post("https://api.localtour.space/api/Event/create",f,{headers:{Authorization:`Bearer ${p}`,"Content-Type":"multipart/form-data"}});console.log("Event created response:",N.data),E(N.data),o(),A()}catch(N){console.error("Error creating event",N),alert("Failed to create event.")}}catch(p){console.error("Error creating event:",p),alert("Failed to create event.")}},A=()=>{I(""),m(""),k(""),n(""),w(null)};return e.jsxs(H,{open:h,onClose:o,children:[e.jsx(q,{children:"Create Event"}),e.jsxs(G,{children:[e.jsx(P,{label:"Event Name",fullWidth:!0,value:C,onChange:t=>I(t.target.value),margin:"normal",InputLabelProps:{shrink:!0},error:!!c.eventName,helperText:c.eventName}),e.jsx(P,{label:"Description",fullWidth:!0,value:a,onChange:t=>m(t.target.value),margin:"normal",InputLabelProps:{shrink:!0},error:!!c.description,helperText:c.description}),e.jsx(P,{label:"Start Date",type:"datetime-local",fullWidth:!0,value:v,onChange:t=>g(t),margin:"normal",InputLabelProps:{shrink:!0},error:!!c.startDate,helperText:c.startDate}),e.jsx(P,{label:"End Date",type:"datetime-local",fullWidth:!0,value:r,onChange:t=>F(t),margin:"normal",InputLabelProps:{shrink:!0},error:!!c.endDate,helperText:c.endDate}),e.jsx("input",{id:"event-photo",type:"file",accept:"image/*",onChange:B,style:{marginTop:"1rem"}}),c.eventPhoto&&e.jsx("div",{style:{color:"red"},children:c.eventPhoto})]}),e.jsxs(M,{children:[e.jsx(y,{onClick:o,color:"primary",children:"Cancel"}),e.jsx(y,{onClick:$,color:"primary",children:"Create"})]})]})}const te=Q(e.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close");function ae({open:h,onClose:o,initialData:E,onEventUpdated:T,placeId:C,eventId:I}){const[a,m]=i.useState({eventName:"",startDate:"",endDate:"",description:"",eventPhotoDisplay:"",eventPhotoFile:null}),[b,w]=i.useState(!1);i.useEffect(()=>{E&&m({...E,startDate:c(E.startDate),endDate:c(E.endDate)})},[E]);const c=r=>{if(!r)return"";const n=new Date(r),g=n.getFullYear(),F=(n.getMonth()+1).toString().padStart(2,"0"),B=n.getDate().toString().padStart(2,"0"),$=n.getHours().toString().padStart(2,"0"),A=n.getMinutes().toString().padStart(2,"0");return`${g}-${F}-${B}T${$}:${A}`},x=()=>{m({...a,eventPhotoDisplay:"",eventPhotoFile:null}),w(!0)},v=r=>{if(r.target.files&&r.target.files[0]){const n=r.target.files[0],g=URL.createObjectURL(n);m({...a,eventPhotoDisplay:g,eventPhotoFile:n}),w(!1)}},k=async()=>{const r=localStorage.getItem("accessToken");if(!r){console.error("No access token found");return}const n=new FormData;n.append("placeid",C),n.append("eventid",I),n.append("EventName",a.eventName),n.append("Description",a.description),n.append("StartDate",a.startDate),n.append("EndDate",a.endDate),a.eventPhotoFile&&n.append("EventPhoto",a.eventPhotoFile);try{const g=await Y.put("https://api.localtour.space/api/Event/update",n,{headers:{accept:"text/plain","Content-Type":"multipart/form-data",Authorization:`Bearer ${r}`}});T(g.data.data),o()}catch(g){console.error("Error submitting event data:",g)}};return e.jsxs(H,{open:h,onClose:o,children:[e.jsx(q,{children:"Edit Event"}),e.jsxs(G,{children:[e.jsx(P,{label:"Event Name",value:a.eventName,onChange:r=>m({...a,eventName:r.target.value}),fullWidth:!0,margin:"normal"}),e.jsx(P,{label:"Start Date & Time",type:"datetime-local",value:a.startDate,onChange:r=>m({...a,startDate:r.target.value}),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(P,{label:"End Date & Time",type:"datetime-local",value:a.endDate,onChange:r=>m({...a,endDate:r.target.value}),fullWidth:!0,margin:"normal",InputLabelProps:{shrink:!0}}),e.jsx(P,{label:"Description",value:a.description,onChange:r=>m({...a,description:r.target.value}),fullWidth:!0,margin:"normal",multiline:!0,rows:4}),a.eventPhotoDisplay&&!b?e.jsxs("div",{style:{position:"relative",margin:"10px 0"},children:[e.jsx("img",{src:a.eventPhotoDisplay,alt:"Event",style:{width:"150px",height:"auto",borderRadius:"8px"}}),e.jsx(V,{style:{position:"absolute",top:"-5px",right:"-5px",backgroundColor:"white",padding:"3px",zIndex:1},onClick:x,children:e.jsx(te,{})})]}):e.jsx("input",{type:"file",accept:"image/*",onChange:v,style:{margin:"10px 0"}})]}),e.jsxs(M,{children:[e.jsx(y,{onClick:o,children:"Cancel"}),e.jsx(y,{onClick:k,color:"primary",children:"Save Changes"})]})]})}function ne(){var L,O,f,N;const{id:h}=J(),[o,E]=i.useState(null),[T,C]=i.useState([]),[I,a]=i.useState(!0),[m,b]=i.useState(!1),w=K(),[c,x]=i.useState(!1),[v,k]=i.useState(null),[r,n]=i.useState(!1),[g,F]=i.useState(null),B=async s=>{await $()};i.useEffect(()=>{(async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{const j=await R.get(`https://api.localtour.space/api/Place/getPlaceById?languageCode=vi&placeid=${h}`,{headers:{Authorization:`Bearer ${l}`}});E(j.data),a(!1)}catch(j){console.error("Error fetching place details",j),a(!1)}})()},[h]),i.useEffect(()=>{h&&(async()=>{const l=localStorage.getItem("accessToken");if(!l){console.error("No access token found");return}try{const j=await R.get(`https://api.localtour.space/api/Event/getall?placeid=${h}&languageCode=vi`,{headers:{Authorization:`Bearer ${l}`}});console.log("Place events data:",j.data.items),C(j.data.items)}catch(j){console.error("Error fetching place events",j)}})()},[h]);const $=async()=>{const s=localStorage.getItem("accessToken");if(!s){console.error("No access token found");return}try{const l=await R.get(`https://api.localtour.space/api/Event/getall?placeid=${h}&languageCode=vi`,{headers:{Authorization:`Bearer ${s}`}});console.log("Updated place events data:",l.data.items),C(l.data.items)}catch(l){console.error("Error fetching place events",l)}},A=async s=>{await $(),x(!1)},t=async()=>{if(!g)return;const s=localStorage.getItem("accessToken");if(!s){console.error("No access token found");return}try{await Y.delete(`https://api.localtour.space/api/Event/delete?placeid=${h}&eventid=${g.id}`,{headers:{Authorization:`Bearer ${s}`}}),C(l=>l.filter(j=>j.id!==g.id)),n(!1)}catch(l){console.error("Error deleting event",l)}},u=s=>{F(s),n(!0)},p=()=>{n(!1),F(null)};return I?e.jsx(W,{children:e.jsx(S,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(_,{})})}):o?(o.status,o.status,o.status,e.jsxs(W,{children:[e.jsxs(S,{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(y,{variant:"outlined",color:"primary",startIcon:e.jsx(z,{icon:"eva:arrow-back-fill"}),onClick:()=>w("/owner/event"),children:"Back to List"}),e.jsx(d,{variant:"h4",sx:{flexGrow:1,textAlign:"center"},children:"Place Detail"})]}),e.jsxs(D,{container:!0,spacing:3,children:[e.jsx(D,{item:!0,xs:12,md:4,children:e.jsx(U,{sx:{p:2,boxShadow:3},children:e.jsx(S,{mb:2,display:"flex",justifyContent:"center",children:e.jsx("img",{src:o.photoDisplay,alt:(L=o.placeTranslations[0])==null?void 0:L.name,style:{width:"100%",height:"auto",maxHeight:"400px",objectFit:"cover"}})})})}),e.jsx(D,{item:!0,xs:12,md:8,children:e.jsxs(U,{sx:{p:3,boxShadow:3},children:[e.jsx(d,{variant:"h5",mb:2,children:(O=o.placeTranslations[0])==null?void 0:O.name}),e.jsxs(d,{variant:"body1",mb:2,children:["Address: ",(f=o.placeTranslations[0])==null?void 0:f.address]}),e.jsxs(d,{variant:"body1",mb:2,children:["Description: ",(N=o.placeTranslations[0])==null?void 0:N.description]}),e.jsxs(D,{container:!0,spacing:2,children:[e.jsx(D,{item:!0,xs:6,children:e.jsxs(d,{variant:"h6",children:["Opening Time: ",o.timeOpen]})}),e.jsx(D,{item:!0,xs:6,children:e.jsxs(d,{variant:"h6",children:["Closing Time: ",o.timeClose]})}),e.jsx(D,{item:!0,xs:6,children:e.jsxs(d,{variant:"h6",children:["Longitude: ",o.longitude]})}),e.jsx(D,{item:!0,xs:6,children:e.jsxs(d,{variant:"h6",children:["Latitude: ",o.latitude]})}),e.jsx(D,{item:!0,xs:6,children:e.jsxs(d,{variant:"h6",children:["Status: ",o.status==="Approved"?"Approved":o.status==="Rejected"?"Rejected":"Pending"]})})]})]})})]}),e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3,children:[e.jsx(d,{variant:"h5",children:"Place Events"}),e.jsx(y,{variant:"contained",color:"primary",startIcon:e.jsx(z,{icon:"mingcute:add-line"}),onClick:()=>b(!0),children:"Create Event"})]}),T.length>0?e.jsx(S,{mt:4,children:e.jsx(D,{container:!0,spacing:3,children:T.map(s=>{var l;return e.jsx(D,{item:!0,xs:12,sm:6,md:4,lg:3,children:e.jsxs(U,{sx:{p:2,boxShadow:2,borderRadius:2,height:"100%"},children:[e.jsx(S,{position:"relative",mb:2,children:s.eventPhotoDisplay?e.jsx("img",{src:s.eventPhotoDisplay,alt:s.eventName||"Event",style:{width:"100%",height:"200px",borderRadius:"8px",objectFit:"cover"}}):e.jsx(S,{display:"flex",justifyContent:"center",alignItems:"center",sx:{width:"100%",height:"200px",borderRadius:"8px",backgroundColor:"#f0f0f0",fontSize:"3rem",fontWeight:"bold",color:"#888"},children:(l=s.eventName)==null?void 0:l.charAt(0)})}),e.jsx(d,{variant:"h6",fontWeight:"bold",textAlign:"center",mb:1,children:s.eventName}),e.jsxs(d,{variant:"body2",color:"text.secondary",mb:1,children:["Start Date: ",s.startDate]}),e.jsxs(d,{variant:"body2",color:"text.secondary",mb:1,children:["End Date: ",s.endDate]}),e.jsxs(S,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[e.jsx(y,{variant:"outlined",size:"small",color:"secondary",startIcon:e.jsx(z,{icon:"eva:edit-outline"}),onClick:()=>{k(s),x(!0),console.log(s)},children:"Edit"}),e.jsx(y,{variant:"outlined",color:"error",onClick:()=>u(s),children:e.jsx(z,{icon:"eva:trash-2-outline"})})]})]})},s.id)})})}):e.jsx(d,{variant:"body1",color:"text.secondary",mt:3,children:"No events found for this place."}),e.jsxs(H,{open:r,onClose:p,children:[e.jsx(q,{children:"Are you sure you want to delete this item?"}),e.jsx(G,{children:e.jsx(d,{variant:"body2",children:"This action cannot be undone."})}),e.jsxs(M,{children:[e.jsx(y,{onClick:p,color:"primary",children:"No"}),e.jsx(y,{onClick:t,color:"error",children:"Yes, Delete"})]})]}),c&&e.jsx(ae,{open:c,onClose:()=>x(!1),initialData:v,onEventUpdated:A,placeId:h||"",eventId:(v==null?void 0:v.id)||""}),e.jsx(ee,{open:m,onClose:()=>b(!1),onEventCreated:B,placeId:h||""})]})):e.jsx(W,{children:e.jsx(S,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:e.jsx(d,{variant:"h5",children:"Place not found"})})})}function ge(){return e.jsxs(e.Fragment,{children:[e.jsx(X,{children:e.jsxs("title",{children:[" ",`Place Details - ${Z.appName}`]})}),e.jsx(ne,{})]})}export{ge as default};
