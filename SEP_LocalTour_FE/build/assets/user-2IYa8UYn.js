import{j as e,B as R,f as T,K as w,A as U,k as C,N as A,J as I,I as y,O as N,l as v,r as o,S as F,H as O}from"./index-CqOrFkS9.js";import{C as E}from"./config-global-BwHnWRtc.js";import{a as k}from"./index-Br0q4W-C.js";import{T as P,a as d,b as D,c as $,d as J,e as L}from"./TableSortLabel-Bt7vdYS2.js";import{a as z,g as H,U as M,e as W}from"./user-table-head-D4blfPs4.js";import{O as G}from"./Select-BH5qWtTR.js";import{C as K}from"./Card-BGRQsCGj.js";import"./LastPage-DAK7OL3M.js";function Q({searchQuery:a,...r}){return e.jsx(P,{...r,children:e.jsx(d,{align:"center",colSpan:7,children:e.jsxs(R,{sx:{py:15,textAlign:"center"},children:[e.jsx(T,{variant:"h6",sx:{mb:1},children:"Not found"}),e.jsxs(T,{variant:"body2",children:["No results found for Â ",e.jsxs("strong",{children:['"',a,'"']}),".",e.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}function _({row:a,selected:r,onSelectRow:u}){const n=w(),p=async(i,l,h)=>{console.log(a);try{const s=localStorage.getItem("accessToken");if(!s){alert("No token found. Please log in."),n("/sign-in");return}const f=JSON.parse(atob(s.split(".")[1])),g=Math.floor(Date.now()/1e3);if(f.exp<g){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),n("/login");return}const t=(await k.get(`https://localhost:44388/api/User/getProfile?userId=${i}`,{headers:{Authorization:`Bearer ${s}`}})).data;n("/admin/role",{state:{user:t,userId:i,userName:l,role:h}})}catch(s){console.error("Failed to fetch user profile:",s),alert("Error fetching user profile. Please try again.")}},b=async(i,l,h)=>{try{const s=localStorage.getItem("accessToken");if(!s){alert("No token found. Please log in."),n("/sign-in");return}const f=JSON.parse(atob(s.split(".")[1])),g=Math.floor(Date.now()/1e3);if(f.exp<g){alert("Token has expired. Please log in again."),localStorage.removeItem("accessToken"),n("/sign-in");return}const m=await k.get(`https://api.localtour.space/api/User/getProfile?userId=${i}`,{headers:{Authorization:`Bearer ${s}`}});if(m.status===200){const t=m.data;n("/admin/ban",{state:{user:t,userId:i,userName:l,endDate:h}})}else alert("User profile not found. Please try again.")}catch(s){console.error("Failed to fetch user profile:",s),alert("Error fetching user profile. Please try again.")}};return e.jsxs(P,{hover:!0,tabIndex:-1,role:"checkbox",selected:r,children:[e.jsx(d,{children:e.jsx(U,{alt:a.fullName,src:a.profilePictureUrl})}),e.jsx(d,{children:a.userName}),e.jsx(d,{children:a.email}),e.jsx(d,{children:a.fullName}),e.jsx(d,{children:a.phoneNumber}),e.jsx(d,{children:a.roles.join(", ")}),e.jsxs(d,{children:[e.jsx(C,{variant:"outlined",color:"primary",sx:{margin:"0 5px"},onClick:()=>p(a.id,a.userName,a.role),children:"Set Role"}),e.jsx(C,{variant:"outlined",color:"error",sx:{margin:"0 5px"},onClick:()=>b(a.id,a.userName,a.endDate),children:"Ban"})]})]})}function q({emptyRows:a,height:r,sx:u,...n}){return a?e.jsx(P,{sx:{...r&&{height:r*a},...u},...n,children:e.jsx(d,{colSpan:9})}):null}function X({numSelected:a,filterName:r,onFilterName:u}){return e.jsxs(A,{sx:{height:96,display:"flex",justifyContent:"space-between",p:n=>n.spacing(0,1,0,3),...a>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[a>0?e.jsxs(T,{component:"div",variant:"subtitle1",children:[a," selected"]}):e.jsx(G,{fullWidth:!0,value:r,onChange:u,placeholder:"Search user...",startAdornment:e.jsx(I,{position:"start",children:e.jsx(y,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),a>0?e.jsx(N,{title:"Delete",children:e.jsx(v,{children:e.jsx(y,{icon:"solar:trash-bin-trash-bold"})})}):e.jsx(N,{title:"Filter list",children:e.jsx(v,{children:e.jsx(y,{icon:"ic:round-filter-list"})})})]})}function Y(){const a=w(),[r,u]=o.useState([]),[n,p]=o.useState(!0),[b,i]=o.useState(""),[l,h]=o.useState(""),s=Z();o.useEffect(()=>{const t=localStorage.getItem("accessToken");if(!t){i("No access token found. Please log in."),p(!1),a("/login");return}const j=JSON.parse(atob(t.split(".")[1])),S=Math.floor(Date.now()/1e3);if(j.exp<S){i("Token has expired. Please log in again."),p(!1),a("/sign-in");return}f(t)},[a]);const f=async t=>{try{const j=await k.get("https://localhost:44388/api/User/getlist",{headers:{Authorization:`Bearer ${t}`}});console.log(j.data),u(j.data)}catch{i("Failed to fetch users")}finally{p(!1)}},g=z({inputData:r,comparator:H(s.order,s.orderBy),filterName:l}),m=!g.length&&!!l;return n?e.jsx("div",{children:"Loading..."}):e.jsx(R,{sx:{p:3},children:e.jsxs(K,{children:[e.jsx(X,{filterName:l,onFilterName:t=>{h(t.target.value),s.onResetPage()},numSelected:0}),e.jsx(F,{children:e.jsx(D,{sx:{overflow:"unset"},children:e.jsxs($,{sx:{minWidth:800},children:[e.jsx(M,{order:s.order,orderBy:s.orderBy,rowCount:r.length,numSelected:s.selected.length,onSort:s.onSort,headLabel:[{id:"avatar",label:"Avatar"},{id:"username",label:"User name"},{id:"email",label:"Email"},{id:"fullname",label:"Full Name"},{id:"phone",label:"Phone"},{id:"role",label:"Role"},{id:"button",label:"Action"}]}),e.jsxs(J,{children:[n&&e.jsxs(P,{children:[e.jsx(d,{colSpan:8,align:"center",children:"Loading..."}),"  "]}),b&&e.jsx(P,{children:e.jsx(d,{colSpan:8,align:"center",sx:{color:"error.main"},children:b})}),g.slice(s.page*s.rowsPerPage,s.page*s.rowsPerPage+s.rowsPerPage).map(t=>e.jsx(_,{row:t,selected:s.selected.includes(t.id),onSelectRow:()=>s.onSelectRow(t.id)},t.id)),e.jsx(q,{height:68,emptyRows:W(s.page,s.rowsPerPage,r.length)}),m&&e.jsx(Q,{searchQuery:l})]})]})})}),e.jsx(L,{component:"div",page:s.page,count:r.length,rowsPerPage:s.rowsPerPage,onPageChange:s.onChangePage,rowsPerPageOptions:[5,10,25],onRowsPerPageChange:s.onChangeRowsPerPage})]})})}function Z(){const[a,r]=o.useState(0),[u,n]=o.useState("username"),[p,b]=o.useState(5),[i,l]=o.useState([]),[h,s]=o.useState("asc"),f=o.useCallback(c=>{s(u===c&&h==="asc"?"desc":"asc"),n(c)},[h,u]),g=o.useCallback((c,x)=>{if(c){l(x);return}l([])},[]),m=o.useCallback(c=>{l(x=>x.includes(c)?x.filter(B=>B!==c):[...x,c])},[]),t=o.useCallback(()=>r(0),[]),j=o.useCallback((c,x)=>{r(x)},[]),S=o.useCallback(c=>{b(parseInt(c.target.value,10)),t()},[t]);return{page:a,order:h,orderBy:u,rowsPerPage:p,selected:i,onSort:f,onSelectRow:m,onSelectAllRows:g,onResetPage:t,onChangePage:j,onChangeRowsPerPage:S}}function le(){return e.jsxs(e.Fragment,{children:[e.jsx(O,{children:e.jsxs("title",{children:[" ",`Users - ${E.appName}`]})}),e.jsx(Y,{})]})}export{le as default};
