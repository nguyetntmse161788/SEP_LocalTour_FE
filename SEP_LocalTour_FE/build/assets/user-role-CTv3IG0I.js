import{aJ as P,K as b,r as i,j as e,B as m,f as a,k as g,m as c,H as F}from"./index-DUX23g0E.js";import{C as $}from"./config-global-BwHnWRtc.js";import{a as x}from"./index-Br0q4W-C.js";import{C as N}from"./Card-CfNpMCOC.js";import{C as U}from"./CardContent-DqDfuNTI.js";import{F as k,I as T}from"./InputLabel-6HE52FsW.js";import{S as z}from"./Select-CoLeV2jR.js";function E(){const R=P(),d=b(),{user:u,userId:o,username:p,roles:j}=R.state||{},[h,C]=i.useState(j||""),[f,t]=i.useState(""),[y,v]=i.useState(""),[l,B]=i.useState(j||[]),n=localStorage.getItem("accessToken");i.useEffect(()=>{u||t("No user data found!")},[u]);const S=r=>{C(r.target.value)},w=async r=>{if(!n){t("Authentication required. Please log in again.");return}try{const s=`https://api.localtour.space/api/User/removeRole?userId=${o}&role=${r}`;(await x.post(s,{},{headers:{Authorization:`Bearer ${n}`}})).status===200?(await A(),v(`Role "${r}" removed successfully.`),setTimeout(()=>{d("/admin/user")},500)):t("Failed to remove role. Please try again.")}catch{t("Failed to remove role. Please try again.")}},A=async()=>{try{const r=`https://api.localtour.space/api/User/getRoles?userId=${o}`,s=await x.get(r,{headers:{Authorization:`Bearer ${n}`}});s.status===200?B(s.data.roles):t("Failed to fetch updated roles. Please try again.")}catch{t("Failed to fetch updated roles. Please try again.")}},I=async()=>{if(!n){t("Authentication required. Please log in again.");return}try{const r=`https://api.localtour.space/api/User/addRole?userId=${o}&role=${h}`;(await x.post(r,{userId:o,username:p,role:h},{headers:{Authorization:`Bearer ${n}`}})).status===200&&(v("Role updated successfully!"),setTimeout(()=>{d("/admin/user")},500))}catch{t("Failed to update role. Please try again.")}};return e.jsx(m,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"70vh",bgcolor:"#f9f9f9",sx:{maxWidth:"90vw",padding:2},children:e.jsx(N,{sx:{width:400,padding:3},children:e.jsxs(U,{children:[e.jsx(a,{variant:"h5",align:"center",marginBottom:2,children:"User Role Page"}),f&&e.jsx(a,{color:"error",variant:"body2",align:"center",marginBottom:2,children:f}),y&&e.jsx(a,{color:"success.main",variant:"body2",align:"center",marginBottom:2,children:y}),u&&e.jsxs(e.Fragment,{children:[e.jsxs(a,{variant:"body1",marginBottom:1,children:[e.jsx("strong",{children:"ID:"})," ",o]}),e.jsxs(a,{variant:"body1",marginBottom:1,children:[e.jsx("strong",{children:"User Name:"})," ",p]}),e.jsx(a,{variant:"body1",marginBottom:1,children:e.jsx("strong",{children:"Current Role:"})}),l&&Array.isArray(l)&&l.length>0?e.jsx("ul",{children:l.map((r,s)=>e.jsxs("li",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[r,e.jsx(g,{variant:"outlined",color:"error",size:"small",onClick:()=>w(r),children:"Remove"})]},s))}):e.jsx(a,{variant:"body2",color:"textSecondary",children:"No roles found."}),e.jsxs(k,{fullWidth:!0,margin:"normal",children:[e.jsx(T,{children:"New Role"}),e.jsxs(z,{value:h,onChange:S,label:"New Role",children:[e.jsx(c,{value:"Moderator",children:"Moderator"}),e.jsx(c,{value:"Administrator",children:"Administrator"}),e.jsx(c,{value:"Visitor",children:"Visitor"}),e.jsx(c,{value:"Service Owner",children:"Service Owner"})]})]}),e.jsx(m,{textAlign:"center",marginTop:2,children:e.jsx(g,{variant:"contained",color:"primary",onClick:I,sx:{width:"100%"},children:"Save Role"})})]}),e.jsx(m,{textAlign:"center",marginTop:2,children:e.jsx(g,{variant:"text",onClick:()=>d("/admin/user"),sx:{width:"100%"},children:"Go to Profile"})})]})})})}function D(){return e.jsxs(e.Fragment,{children:[e.jsx(F,{children:e.jsxs("title",{children:[" ",`Blog - ${$.appName}`]})}),e.jsx(E,{})]})}export{D as default};
