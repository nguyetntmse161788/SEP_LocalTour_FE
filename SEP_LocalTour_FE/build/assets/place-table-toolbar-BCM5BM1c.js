import{j as t,B as K,T as G,r as d,h as D,q as ee,l as te,x as Te,I as H,y as ae,p as be}from"./index-D4PwaD5N.js";import{c as Q,d as R,b as ve}from"./TableRow-B7nkHKsf.js";import{a as k}from"./axiosInstance-Q6XP8Ys3.js";import{D as se,a as oe,b as ne,c as we}from"./DialogTitle-C6FRhu7J.js";import{A as B}from"./Autocomplete-CB4pWVi1.js";import{T as b,F as Ce}from"./TextField-C0PbMPGO.js";import{G as _}from"./Grid-BP6mOV8A.js";import{S as De,O as ke}from"./Select-545m9gIo.js";import{C as Le}from"./Checkbox-B4qOLwXZ.js";import{b as Pe,T as Ie}from"./TableSortLabel-CWuwd1kD.js";import{I as Se}from"./InputAdornment-BfKJzYYN.js";function ze({searchQuery:l,...h}){return t.jsx(Q,{...h,children:t.jsx(R,{align:"center",colSpan:7,children:t.jsxs(K,{sx:{py:15,textAlign:"center"},children:[t.jsx(G,{variant:"h6",sx:{mb:1},children:"Not found"}),t.jsxs(G,{variant:"body2",children:["No results found for  ",t.jsxs("strong",{children:['"',l,'"']}),".",t.jsx("br",{})," Try checking for typos or using complete words."]})]})})})}const Me=({latitude:l,longitude:h,onLocationSelect:u,onCloseMap:x})=>{const s=d.useRef(null),[r,C]=d.useState(!1),[g,A]=d.useState(null),[L,O]=d.useState(null),[P,m]=d.useState([]),[I,W]=d.useState("");d.useEffect(()=>{const p=()=>{window.vietmapgl?C(!0):setTimeout(p,500)};p()},[]),d.useEffect(()=>{if(r){const p=new window.vietmapgl.Map({container:s.current,style:"https://maps.vietmap.vn/mt/tm/style.json?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46",center:[h,l],zoom:9}),f=new window.vietmapgl.Marker().setLngLat([h,l]).addTo(p);A(f),O(p),p.on("click",T=>{const{lng:y,lat:S}=T.lngLat;f.setLngLat([y,S])})}else console.error("VietMap API không tải được")},[l,h,r]);const $=async p=>{const f=p.target.value;if(W(f),f.length>2)try{const y=await(await fetch(`https://maps.vietmap.vn/api/autocomplete/v3?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46&text=${f}`)).json();m(y||[])}catch(T){console.error("Lỗi khi tìm kiếm địa điểm:",T)}else m([])},F=async(p,f)=>{try{const T=await fetch(`https://maps.vietmap.vn/api/place/v3?apikey=9e37b843f972388f80a9e51612cad4c1bc3877c71c107e46&refid=${f}`);if(!T.ok){console.error("Lỗi API:",T.status,T.statusText);return}const y=await T.json();if(y&&y.lng&&y.lat){const{lng:S,lat:M}=y;r&&g&&(g.setLngLat([S,M]),L.flyTo({center:[S,M],zoom:500})),u(S.toString(),M.toString()),m([]),W(p);const U=p||`${y.result.district}, ${y.result.city}`;console.log("Địa chỉ đầy đủ:",U)}else console.error("Dữ liệu không hợp lệ từ API: Không tìm thấy tọa độ.",y)}catch(T){console.error("Lỗi khi lấy tọa độ từ API:",T)}},q=()=>{if(g){const{lng:p,lat:f}=g.getLngLat();u(p.toString(),f.toString()),x()}};return t.jsxs("div",{children:[t.jsx("input",{type:"text",value:I,onChange:$,placeholder:"Nhập địa chỉ..."}),P.length>0&&t.jsx("div",{style:{maxHeight:"200px",overflowY:"auto",border:"1px solid #ccc"},children:P.map(p=>t.jsx("div",{style:{padding:"8px",cursor:"pointer"},role:"button",tabIndex:0,onClick:()=>F(p.address,p.ref_id),onKeyDown:f=>{(f.key==="Enter"||f.key===" ")&&F(p.address,p.ref_id)},children:p.display},p.ref_id))}),t.jsx("div",{ref:s,style:{width:"100%",height:"300px"}}),t.jsxs("div",{className:"map-actions",children:[t.jsx("button",{onClick:q,className:"btn-select",type:"button",children:"Select Location"}),t.jsx("button",{onClick:x,className:"btn-close",type:"button",children:"Close"})]})]})};function He({open:l,onClose:h,placeId:u,onPlaceUpdated:x}){const[s,r]=d.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",tags:[],placeTranslations:[],photoDisplay:null,placeMedia:[],isVerified:!1,status:"0"}),[C,g]=d.useState([]),[A,L]=d.useState(!1),[O,P]=d.useState(""),[m,I]=d.useState(""),[W,$]=d.useState([]),[F,q]=d.useState([]),[p,f]=d.useState([]),[T,y]=d.useState(""),[S,M]=d.useState(""),[U,re]=d.useState(s),[c,Y]=d.useState({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")});d.useEffect(()=>{(async()=>{var e,n;try{const o=(await k.get(`https://api.localtour.space/api/Place/getPlaceById?placeid=${u}`)).data,w={wardId:o.wardId||"",timeOpen:o.timeOpen||"",timeClose:o.timeClose||"",longitude:((e=o.longitude)==null?void 0:e.toString())||"",latitude:((n=o.latitude)==null?void 0:n.toString())||"",contactLink:o.contactLink||"",tags:o.tags||[],placeTranslations:o.placeTranslations||[],photoDisplay:o.photoDisplay,placeMedia:o.placeMedia.map(Z=>({type:Z.type,url:Z.url})),isVerified:o.isVerified||!1,status:o.status||"0"};r(w),re(w);const v=(await k.get(`https://api.localtour.space/api/Address/getDistrictByWardId?wardId=${o.wardId}`)).data;M(v.id);const z=(await k.get(`https://api.localtour.space/api/Address/getProvinceByDistrictId?districtId=${v.id}`)).data;y(z.id),J(z.id),X(v.id),le(u),Y({wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")})}catch(i){console.error("Error fetching place data:",i)}})()},[l,u]);const ie=()=>{r(U),h()},le=async a=>{try{const n=(await k.get(`https://api.localtour.space/api/Place/getTagsInPlace?placeId=${a}`)).data;r(i=>({...i,tags:n.map(o=>o.id)}))}catch(e){console.error("Error fetching tags for place:",e)}},ce=(a,e)=>{P(a),I(e),r(n=>({...n,longitude:a,latitude:e}))},de=()=>{L(!0)},pe=()=>{L(!1)};d.useEffect(()=>{(async()=>{try{const e=await k.get("https://api.localtour.space/api/Tag/getAll?Size=1000");g(e.data.items)}catch(e){console.error("Error fetching tags:",e)}})()},[]),d.useEffect(()=>{(async()=>{try{const e=await k.get("https://api.localtour.space/api/Address/Province");$(e.data)}catch(e){console.error("Error fetching provinces:",e)}})()},[]);const J=async a=>{try{const e=await k.get(`https://api.localtour.space/api/Address/District?provinceI=${a}`);q(e.data)}catch(e){console.error("Error fetching districts:",e)}},X=async a=>{try{const e=await k.get(`https://api.localtour.space/api/Address/Ward?cityId=${a}`);console.log("Wards Response:",e.data),f(e.data)}catch(e){console.error("Error fetching wards:",e)}},he=()=>{r(a=>({...a,placeTranslations:[...a.placeTranslations,{languageCode:"vi",name:"",description:"",address:"",contact:""}]}))},ue=a=>{r(e=>{const n=e.placeTranslations.filter((i,o)=>o!==a);return{...e,placeTranslations:n}})},ge=a=>{const e=a.target.files;e&&e[0]&&r(n=>({...n,photoDisplay:e[0]}))},me=async(a,e)=>{const n=a.target.files;if(n&&n.length>0){const i=n[0],o=[...s.placeMedia];try{const w=new FormData;w.append("files",i);const N=await fetch("https://api.localtour.space/api/File/createlink",{method:"POST",body:w});if(!N.ok)throw new Error("Failed to upload file");const v=await N.json();let j="";if(i.type.includes("image")&&v.imageUrls&&v.imageUrls.length>0)j=v.imageUrls[0];else if(i.type.includes("video")&&v.videoUrls&&v.videoUrls.length>0)j=v.videoUrls[0];else throw new Error("No URL returned for the uploaded file");o[e]={type:i.type.includes("image")?"Image":"Video",url:j},r({...s,placeMedia:o})}catch(w){console.error("Error uploading file:",w)}}},fe=a=>{const e=s.placeMedia.filter((n,i)=>i!==a);r({...s,placeMedia:e})},xe=()=>s.placeMedia.map((a,e)=>t.jsxs(_,{container:!0,spacing:2,alignItems:"center",children:[t.jsx(_,{item:!0,xs:6,children:a.url?a.type==="Image"?t.jsx("img",{src:a.url,alt:"Media",style:{width:"100%",maxHeight:"200px",objectFit:"cover"}}):t.jsxs("video",{width:"100%",height:"auto",controls:!0,children:[t.jsx("source",{src:a.url,type:"video/mp4"}),"Your browser does not support the video tag."]}):t.jsx("div",{children:"No media selected"})}),t.jsxs(_,{item:!0,xs:6,children:[!a.url&&t.jsx(t.Fragment,{children:t.jsx("input",{type:"file",accept:"image/*,video/*",onChange:n=>me(n,e)})}),t.jsx(D,{variant:"contained",color:"error",onClick:()=>fe(e),children:"Remove"})]})]},e)),E=(a,e)=>{const{name:n,value:i}=a.target,o=[...s.placeTranslations];o[e]={...o[e],[n]:i},r({...s,placeTranslations:o})},V=a=>{const{name:e,value:n}=a.target;r(i=>({...i,[e]:n}))},ye=(a,e)=>{r(n=>({...n,tags:e.map(i=>i.id)}))},je=async()=>{var n;let a=!1;const e={wardId:"",timeOpen:"",timeClose:"",longitude:"",latitude:"",contactLink:"",placeMedia:"",photoDisplay:"",tags:"",placeTranslations:s.placeTranslations.map(()=>"")};if(s.wardId||(e.wardId="Please select a ward.",a=!0),s.timeOpen||(e.timeOpen="Time Open is required.",a=!0),s.timeClose||(e.timeClose="Time Close is required.",a=!0),s.longitude||(e.longitude="Longitude is required.",a=!0),s.latitude||(e.latitude="Latitude is required.",a=!0),s.photoDisplay||(e.photoDisplay="PhotoDisplay is required.",a=!0),s.contactLink||(e.contactLink="Contact Link is required.",a=!0),s.tags.length===0&&(e.tags="At least one tag is required.",a=!0),s.placeMedia.length===0&&(e.placeMedia="At least one media is required.",a=!0),s.placeTranslations.forEach((i,o)=>{!i.name||!i.description||!i.address||!i.contact?(e.placeTranslations[o]="All fields are required for each translation.",a=!0):e.placeTranslations[o]=""}),a){Y(e);return}try{const i=localStorage.getItem("accessToken"),o=new FormData;o.append("WardId",s.wardId),o.append("TimeOpen",s.timeOpen),o.append("TimeClose",s.timeClose),o.append("Longitude",s.longitude),o.append("Latitude",s.latitude),o.append("ContactLink",s.contactLink),s.tags.forEach(j=>o.append("Tags",j)),o.append("PlaceTranslation",JSON.stringify(s.placeTranslations));let w=s.photoDisplay;if(s.photoDisplay&&s.photoDisplay instanceof File){const j=new FormData;j.append("file",s.photoDisplay),w=(n=(await te.post("https://api.localtour.space/api/File/link",j)).data)==null?void 0:n.data}o.append("PhotoDisplay",w),s.placeMedia.forEach(j=>{j.url&&(j.url,o.append("PlaceMedia",j.url))});const v=(await te.put(`https://api.localtour.space/api/Place/update?placeid=${u}`,o,{headers:{Authorization:`Bearer ${i}`,"Content-Type":"multipart/form-data"}})).data;alert("Place updated successfully!"),x(v),h()}catch(i){console.error("Error updating place:",i),alert("Failed to update place.")}};return t.jsxs(se,{open:l,onClose:h,maxWidth:"sm",fullWidth:!0,children:[t.jsx(oe,{children:"New Place"}),t.jsxs(ne,{children:[t.jsx(B,{fullWidth:!0,options:W,getOptionLabel:a=>a.name,onChange:(a,e)=>{y((e==null?void 0:e.id)||""),M(""),f([]),J(e==null?void 0:e.id)},value:W.find(a=>a.id===T)||null,renderInput:a=>t.jsx(b,{...a,label:"Province"})}),t.jsx(B,{fullWidth:!0,options:F,getOptionLabel:a=>a.name,onChange:(a,e)=>{M((e==null?void 0:e.id)||""),X(e==null?void 0:e.id)},value:F.find(a=>a.id===S)||null,renderInput:a=>t.jsx(b,{...a,label:"District"})}),t.jsx(B,{fullWidth:!0,options:p,getOptionLabel:a=>a.wardName||"",value:p.find(a=>a.id===s.wardId)||null,onChange:(a,e)=>{r(n=>({...n,wardId:(e==null?void 0:e.id)||""}))},renderInput:a=>t.jsxs(t.Fragment,{children:[t.jsx(b,{...a,label:"Ward",error:!!c.wardId}),c.wardId&&t.jsx(Ce,{error:!0,children:c.wardId})]}),isOptionEqualToValue:(a,e)=>a.id===(e==null?void 0:e.id)}),t.jsx(b,{fullWidth:!0,label:"Time Open",name:"timeOpen",type:"time",value:s.timeOpen,onChange:V,margin:"normal",inputProps:{step:300},error:!!c.timeOpen,helperText:c.timeOpen}),t.jsx(b,{fullWidth:!0,label:"Time Close",name:"timeClose",type:"time",value:s.timeClose,onChange:V,margin:"normal",inputProps:{step:300},error:!!c.timeClose,helperText:c.timeClose}),t.jsx(b,{fullWidth:!0,label:"Longitude",name:"longitude",value:s.longitude,onChange:a=>P(a.target.value),margin:"normal",error:!!c.longitude,helperText:c.longitude}),t.jsx(b,{fullWidth:!0,label:"Latitude",name:"latitude",value:s.latitude,onChange:a=>I(a.target.value),margin:"normal",error:!!c.latitude,helperText:c.latitude}),t.jsx(D,{onClick:de,variant:"outlined",children:"Choose on Map"}),t.jsxs(se,{open:A,onClose:()=>L(!1),maxWidth:"md",fullWidth:!0,children:[t.jsx(oe,{children:"Select Location on Map"}),t.jsx(ne,{children:t.jsx(Me,{latitude:parseFloat(m)||10.762622,longitude:parseFloat(O)||106.827153,onLocationSelect:ce,onCloseMap:pe})})]}),t.jsx(b,{fullWidth:!0,label:"Contact Link",name:"contactLink",value:s.contactLink,onChange:V,margin:"normal",error:!!c.contactLink,helperText:c.contactLink}),t.jsx(B,{multiple:!0,id:"tags",options:C,getOptionLabel:a=>a.tagName,onChange:ye,value:C.filter(a=>s.tags.includes(a.id)),renderInput:a=>t.jsx(b,{...a,label:"Tags",error:!!c.tags,helperText:c.tags}),disableCloseOnSelect:!0}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx("div",{style:{fontWeight:"bold"},children:"Photo Display"}),s.photoDisplay?t.jsxs("div",{style:{position:"relative",width:"100%",maxWidth:"200px",marginBottom:"10px"},children:[t.jsx("img",{src:typeof s.photoDisplay=="string"?s.photoDisplay:URL.createObjectURL(s.photoDisplay),alt:"Display of the place",style:{width:"100%",height:"auto",maxHeight:"200px",objectFit:"cover",borderRadius:"10px"}}),t.jsx(D,{variant:"contained",color:"error",onClick:()=>r({...s,photoDisplay:null}),style:{position:"absolute",top:"5px",right:"5px",padding:"5px",minWidth:"unset",borderRadius:"50%",fontSize:"16px",backgroundColor:"rgba(255, 0, 0, 0.7)",color:"#fff"},children:"X"})]}):t.jsx("input",{type:"file",accept:"image/*",id:"photoDisplay",onChange:ge}),c.photoDisplay&&t.jsx("div",{style:{color:"red"},children:c.photoDisplay})]}),t.jsxs("div",{children:[t.jsx("h4",{children:"Place Media"}),xe(),c.placeMedia&&t.jsx("div",{style:{color:"red"},children:c.placeMedia})]}),t.jsx(D,{variant:"contained",color:"primary",onClick:()=>r({...s,placeMedia:[...s.placeMedia,{type:"",url:""}]}),children:"Add Media"}),t.jsxs("div",{style:{marginTop:"20px"},children:[t.jsx(D,{variant:"outlined",onClick:he,children:"Add Place Translation"}),s.placeTranslations.map((a,e)=>t.jsxs("div",{style:{marginTop:"15px"},children:[t.jsxs(De,{fullWidth:!0,value:a.languageCode||"",onChange:n=>{const i=[...s.placeTranslations];i[e]={...i[e],languageCode:n.target.value},r({...s,placeTranslations:i})},children:[t.jsx(ee,{value:"vi",children:"VN"}),t.jsx(ee,{value:"en",children:"EN"})]}),t.jsx(b,{fullWidth:!0,label:`Name ${e+1}`,name:"name",value:a.name,onChange:n=>E(n,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(b,{fullWidth:!0,label:`Description ${e+1}`,name:"description",value:a.description,onChange:n=>E(n,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(b,{fullWidth:!0,label:`Address ${e+1}`,name:"address",value:a.address,onChange:n=>E(n,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(b,{fullWidth:!0,label:`Contact ${e+1}`,name:"contact",value:a.contact,onChange:n=>E(n,e),margin:"normal",error:!!c.placeTranslations[e],helperText:c.placeTranslations[e]}),t.jsx(D,{variant:"outlined",color:"error",onClick:()=>ue(e),style:{marginTop:"10px"},children:"Remove Translation"})]},e))]})]}),t.jsxs(we,{children:[t.jsx(D,{onClick:ie,color:"secondary",children:"Cancel"}),t.jsx(D,{onClick:je,color:"primary",children:"Submit"})]})]})}const Ae={border:0,margin:-1,padding:0,width:"1px",height:"1px",overflow:"hidden",position:"absolute",whiteSpace:"nowrap",clip:"rect(0 0 0 0)"};function _e(l,h,u){return l?Math.max(0,(1+l)*h-u):0}const Ge=(l,h)=>(u,x)=>{if(h==="status"){const s=Number(u.status),r=Number(x.status);return l==="asc"?s-r:r-s}return 0},Ke=({inputData:l,comparator:h,filterName:u,filterStatus:x})=>{const s=[...l];return s.sort(h),s};function Qe({order:l,onSort:h,orderBy:u,rowCount:x,headLabel:s,numSelected:r,onSelectAllRows:C}){return t.jsx(ve,{children:t.jsxs(Q,{children:[t.jsx(R,{padding:"checkbox",children:t.jsx(Le,{indeterminate:r>0&&r<x,checked:x>0&&r===x,onChange:g=>C(g.target.checked)})}),s.map(g=>t.jsx(R,{align:g.align||"left",sortDirection:u===g.id?l:!1,sx:{width:g.width,minWidth:g.minWidth},children:t.jsxs(Pe,{hideSortIcon:!0,active:u===g.id,direction:u===g.id?l:"asc",onClick:()=>h(g.id),children:[g.label,u===g.id?t.jsx(K,{sx:{...Ae},children:l==="desc"?"sorted descending":"sorted ascending"}):null]})},g.id))]})})}function Ye({emptyRows:l,height:h,sx:u,...x}){return l?t.jsx(Q,{sx:{...h&&{height:h*l},...u},...x,children:t.jsx(R,{colSpan:9})}):null}function Je({numSelected:l,filterName:h,onFilterName:u,onFilterStatus:x}){const[s,r]=d.useState(null),[C,g]=d.useState(null),A=m=>{const I=m==="All"?"":m;g(I),x(I),r(null)},L=m=>{r(m.currentTarget)},O=()=>{r(null)},P=!!s;return t.jsxs(Te,{sx:{height:96,display:"flex",justifyContent:"space-between",p:m=>m.spacing(0,1,0,3),...l>0&&{color:"primary.main",bgcolor:"primary.lighter"}},children:[l>0?t.jsxs(G,{component:"div",variant:"subtitle1",children:[l," selected"]}):t.jsx(ke,{fullWidth:!0,value:h,onChange:u,placeholder:"Search place...",startAdornment:t.jsx(Se,{position:"start",children:t.jsx(H,{width:20,icon:"eva:search-fill",sx:{color:"text.disabled"}})}),sx:{maxWidth:320}}),l>0?t.jsx(ae,{children:t.jsx(H,{icon:"solar:trash-bin-trash-bold"})}):t.jsxs(t.Fragment,{children:[t.jsx(Ie,{title:"Filter list",children:t.jsx(ae,{onClick:L,children:t.jsx(H,{icon:"ic:round-filter-list"})})}),t.jsx(be,{open:P,anchorEl:s,onClose:O,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},children:t.jsx(K,{sx:{p:2,display:"flex",flexDirection:"column",gap:1},children:["All","Pending","Approved","Rejected"].map(m=>t.jsx(D,{variant:C===(m==="All"?null:m)?"contained":"outlined",onClick:()=>A(m==="All"?null:m),sx:{color:C===(m==="All"?null:m)?"text.primary":"text.secondary",borderColor:"text.secondary"},children:m},m))})})]})]})}export{Me as M,Je as P,Ye as T,He as U,Ke as a,Qe as b,ze as c,_e as e,Ge as g};
