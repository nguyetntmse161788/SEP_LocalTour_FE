import{r,j as e,h as m,T as k,w as N,t as $,D as z,B as C,I as b,V as E,H as G}from"./index-z39hXFLl.js";import{C as L}from"./config-global-BwHnWRtc.js";import{D as v,a as I,b as D,c as T}from"./DialogTitle-Dgc1Aws8.js";import{T as A}from"./TextField-B2lMQ9Li.js";import"./InputLabel-D6bSjKO1.js";const P=({open:p,onClose:i,onBannerCreated:s})=>{const[c,d]=r.useState(""),[o,l]=r.useState(null),[u,f]=r.useState(!1);r.useEffect(()=>{p||(d(""),l(null))},[p]);const x=n=>{n.target.files&&n.target.files.length>0&&l(n.target.files[0])},g=async()=>{if(!c||!o){alert("Please provide all required fields!");return}f(!0);try{const n=localStorage.getItem("accessToken"),a=new FormData;if(a.append("BannerName",c),a.append("BannerUrl",o),!(await fetch("https://api.localtour.space/api/Banner/createBanner",{method:"POST",headers:{Authorization:`Bearer ${n}`},body:a})).ok)throw new Error("Failed to create banner");alert("Banner created successfully!"),s(),i()}catch(n){console.error("Error creating banner:",n),alert("Failed to create banner")}finally{f(!1)}};return e.jsxs(v,{open:p,onClose:i,children:[e.jsx(I,{children:"Create New Banner"}),e.jsxs(D,{children:[e.jsx(A,{label:"Banner Name",fullWidth:!0,value:c,onChange:n=>d(n.target.value),margin:"normal"}),e.jsxs(m,{variant:"contained",component:"label",color:"primary",fullWidth:!0,style:{marginTop:"16px"},children:[o?o.name:"Choose File",e.jsx("input",{type:"file",accept:"image/*",hidden:!0,onChange:x})]}),o&&e.jsxs(k,{variant:"body2",style:{marginTop:"8px",color:"#555"},children:["Selected File: ",o.name]})]}),e.jsxs(T,{children:[e.jsx(m,{onClick:i,color:"inherit",children:"Cancel"}),e.jsx(m,{onClick:g,variant:"contained",color:"primary",disabled:u,children:u?e.jsx(N,{size:24}):"Submit"})]})]})},O=({open:p,onClose:i,banner:s,onBannerUpdated:c})=>{const[d,o]=r.useState((s==null?void 0:s.bannerName)||""),[l,u]=r.useState(null),[f,x]=r.useState(!1);r.useEffect(()=>{s&&o(s.bannerName)},[s]);const g=a=>{a.target.files&&a.target.files.length>0&&u(a.target.files[0])},n=async()=>{var y;if(!s||!d){alert("Please provide all required fields!");return}x(!0);const a=new FormData;a.append("BannerName",d);let B=s.bannerUrl;if(l&&l instanceof File){const h=new FormData;h.append("file",l),B=(y=(await $.post("https://api.localtour.space/api/File/link",h)).data)==null?void 0:y.data}if(a.append("BannerUrl",B),!/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/.test(s.id))throw new Error("Invalid banner ID format");try{const h=localStorage.getItem("accessToken");if(!(await fetch(`https://api.localtour.space/api/Banner/Update?bannerId=${s.id}`,{method:"PUT",headers:{Authorization:`Bearer ${h}`},body:a})).ok)throw new Error("Failed to update banner");alert("Banner updated successfully!"),c(),i()}catch(h){console.error("Error updating banner:",h),alert("Failed to update banner")}finally{x(!1)}};return e.jsxs(v,{open:p,onClose:i,children:[e.jsx(I,{children:"Edit Banner"}),e.jsxs(D,{children:[e.jsx(A,{label:"Banner Name",fullWidth:!0,value:d,onChange:a=>o(a.target.value),margin:"normal"}),e.jsxs(m,{variant:"outlined",component:"label",children:["Upload New Banner",e.jsx("input",{type:"file",hidden:!0,onChange:g})]}),l&&e.jsxs("p",{children:["Selected file: ",l.name]})]}),e.jsxs(T,{children:[e.jsx(m,{onClick:i,color:"inherit",children:"Cancel"}),e.jsx(m,{onClick:n,variant:"contained",color:"primary",disabled:f,children:f?e.jsx(N,{size:24}):"Save"})]})]})},W=()=>{const[p,i]=r.useState([]),[s,c]=r.useState(!0),[d,o]=r.useState(!1),[l,u]=r.useState(null),[f,x]=r.useState(null),[g,n]=r.useState(!1),a=async()=>{c(!0);try{const t=localStorage.getItem("userId"),j=localStorage.getItem("accessToken"),w=await fetch(`https://api.localtour.space/api/Banner/GetByAuthor?UserId=${t}`,{method:"GET",headers:{Authorization:`Bearer ${j}`}});if(!w.ok)throw new Error("Failed to fetch banners");const U=await w.json();i(U)}catch(t){console.error("Error fetching banners:",t)}finally{c(!1)}};r.useEffect(()=>{a()},[]);const B=()=>{a()},S=async t=>{if(window.confirm("Are you sure you want to delete this banner?"))try{const j=localStorage.getItem("accessToken");if(!(await fetch(`https://api.localtour.space/api/Banner?id=${t}`,{method:"DELETE",headers:{Authorization:`Bearer ${j}`}})).ok)throw new Error("Failed to delete banner");alert("Banner deleted successfully!"),a()}catch(j){console.error("Error deleting banner:",j),alert("Failed to delete banner")}},y=t=>{u({...t}),x({...t}),n(!0)},h=()=>{a(),n(!1)},F=()=>{u(f),n(!1)};return s?e.jsx("p",{children:"Loading banners..."}):e.jsxs(z,{children:[e.jsxs(C,{display:"flex",alignItems:"center",mb:5,children:[e.jsx(k,{variant:"h4",flexGrow:1,children:"Banner"}),e.jsx(m,{variant:"contained",color:"inherit",startIcon:e.jsx(b,{icon:"mingcute:add-line"}),onClick:()=>o(!0),children:"New Banner"})]}),e.jsx("div",{style:{display:"flex",gap:"1rem",flexWrap:"wrap"},children:p.map(t=>e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"16px",width:"250px"},children:[e.jsx("img",{src:t.bannerUrl,alt:t.bannerName,style:{width:"100%",borderRadius:"8px"}}),e.jsx("h3",{style:{fontSize:"1.2rem",margin:"8px 0"},children:t.bannerName}),e.jsxs(C,{display:"flex",justifyContent:"space-between",mt:2,children:[e.jsx(E,{onClick:()=>y(t),color:"primary",children:e.jsx(b,{icon:"eva:edit-2-outline"})}),e.jsx(E,{onClick:()=>S(t.id),color:"error",children:e.jsx(b,{icon:"eva:trash-2-outline"})})]})]},t.id))}),e.jsx(P,{open:d,onClose:()=>o(!1),onBannerCreated:B}),e.jsx(O,{open:g,onClose:F,banner:l,onBannerUpdated:h})]})};function K(){return e.jsxs(e.Fragment,{children:[e.jsx(G,{children:e.jsxs("title",{children:[" ",`Banner - ${L.appName}`]})}),e.jsx(W,{})]})}export{K as default};
